define("lounge/common",["backbone","underscore"],function(a,b){"use strict";var c,d=function(a){c=a},e=function(){return c},f=a.View.extend({updateDom:function(a,c){var d=e();d&&d.initialized?d.updateDom(a,c):b.isFunction(a)&&a.call(c)},resize:function(){var a=e();a&&a.initialized&&a.resize()}}),g=f.extend({initialize:function(a){this.session=a.session,this.showZero=a.showZero||!1,this.max=a.max},render:function(){var a=this.session.get("notificationCount")||0;return this.max&&(a=Math.min(a,this.max)),this.$el.html("<span>"+a+"</span>"),a>0||this.showZero?this.$el.show():this.$el.hide(),this}});return{setLounge:d,getLounge:e,LoungeSubView:f,NotificationCountView:g}}),define("lounge/load",["jquery","lounge/views","lounge/tracking","initializer"],function(a,b,c,d){"use strict";return{init:function(){var e=d.getEmbeddedData,f=e("threadData");if(f.code)return f;a.extend(f.response,e("forumData"));var g=new b.Lounge({jsonData:f,el:document.body});c.init(g)}}}),define("lounge/menu-handler",["jquery","common/bus"],function(a,b){"use strict";return{init:function(){function c(){a(".dropdown").removeClass("open")}a("html").on("click",c),a("body").delegate("[data-toggle]","click",function(b){b.stopPropagation(),b.preventDefault();var d=a(b.currentTarget),e=d.closest("."+d.attr("data-toggle")),f="disabled"!==e.attr("data-dropdown")&&!e.hasClass("open");e.attr("data-dropdown","enabled"),c(),f&&e.addClass("open")}),b.on("window.click",c)}}}),define("lounge/mixins",["underscore","jquery","lounge/common","common/utils","common/api","common/urls","common/templates","common/corefuncs"],function(a,b,c,d,e,f,g,h){"use strict";var i=d.preventDefaultHandler,j={_getShortUrl:function(b){var c=this,d=this._shareUrl(),f=d,g=a.extend({url:d,source:"disqus_embed_next"},this.model.relatedIds());e.call("shortener/create.json",{method:"POST",data:g,timeout:1e3*5,success:function(a){var b=a.code,c=a.response;0===b&&(f=c.url)},complete:function(){b.call(c,f)}})},_shareWaitPopup:function(a){return window.open(f.loading,"_blank",a||"width=550,height=520")},share:function(a){this.sharers[a].call(this)},sharers:{twitter:function(){var a="https://twitter.com/intent/tweet",b=this._shareWaitPopup();this._getShortUrl(function(c){b.location=h.serialize(a,{url:c,text:this.model.twitterText(c)})})},facebook:function(){var a="https://www.facebook.com/sharer.php",b=this._shareWaitPopup("width=655,height=352");this._getShortUrl(function(c){b.location=h.serialize(a,{u:c})})}}},k=c.LoungeSubView.extend({className:"alert",events:{"click [data-action=dismiss]":"dismiss"},initialize:function(b){a.extend(this,b)},render:function(){var a=this,b=a.$el;return b.html(g.render("alert",{message:a.message,safe:a.safe})),b.attr("class",a.className),a.type&&b.addClass(a.type),a},dismiss:function(a){a&&a.preventDefault&&a.preventDefault(),this.remove(),this.trigger("dismiss")}}),l={alert:function(b,c){c?a.isString(c)&&(c={type:c}):c={},this.dismissAlert();var d=this._alert=new k(a.extend({message:b},c));return this.updateDom(function(){d.render(),this._alertSelector?this.$el.find(this._alertSelector).prepend(d.el):this.el.parentNode.insertBefore(d.el,this.el)},this),d},dismissAlert:function(){this._alert&&this._alert.dismiss()},setAlertSelector:function(a){this._alertSelector=a}},m={toggleFollow:i(function(a){var d=a&&b(a.target).closest("a[data-user]").attr("data-user"),e=this.collection&&d?this.collection.get(d):this.user,f=c.getLounge(),g=f.session;return g.isRegistered()?(e.get("isFollowing")?this.unfollow(e):this.follow(e),void 0):(this.trigger("authenticating"),this.listenToOnce(g,"identify",function(){this.follow(e)}),void f.authenticate("disqusDotcom"))}),unfollow:function(a){a.unfollow(),c.getLounge().trigger("uiAction:unfollowUser",a)},follow:function(a){a.follow(),c.getLounge().trigger("uiAction:followUser",a)}},n=function(){function a(){return this.collapseTarget&&this.collapseTarget.length||(this.collapseTarget=this.collapseTargetSelector?this[this.collapseScope].find(this.collapseTargetSelector):this[this.collapseScope]),this.collapseTarget}function b(){var b=this;if(b.isCollapseAllowed){var c=a.call(b);c&&c.length&&b.updateDom(function(){c.height(b.collapsedHeight),e.call(b)})}}function c(a){var b=this;if(b.collapseTarget&&b.collapseTarget.length){var c=b.collapseTarget;b.updateDom(function(){c.css("height","auto"),c.css("maxHeight","none"),f.call(b)}),a||(b.isCollapseAllowed=!1)}}function d(){return this.seeMoreButton&&this.seeMoreButton.length||(this.seeMoreButton=a.call(this).siblings("[data-action=see-more]")),this.seeMoreButton}function e(){var a=this;d.call(this).removeClass("hidden").on("click",function(){a.expand()})}function f(){d.call(this).addClass("hidden").off("click")}return function(a){var d=this;d.isCollapseAllowed=!0,d.collapsedHeight=a.collapsedHeight,d.collapseTargetSelector=a.collapseTargetSelector,d.collapseScope=a.collapseScope||"$el",d.collapse=b,d.expand=c}}();return{ShareMixin:j,AlertView:k,AlertMixin:l,FollowButtonMixin:m,asCollapsible:n}}),define("lounge/realtime",["jquery","underscore","backbone","common/utils","common/urls","common/corefuncs","common/logger"],function(a,b,c,d,e,f,g){"use strict";function h(){n.apply(this,arguments),this.reqCounter=0,this.marker=0,this.interval=1,this._boundOnError=b.bind(this.onError,this),this._boundOnLoad=b.bind(this.onLoad,this),this._boundOnProgress=b.bind(this.onProgress,this)}function i(){n.apply(this,arguments),this.handshakeSuccess=null,this.interval=1,this._boundOnOpen=b.bind(this.onOpen,this),this._boundError=b.bind(this.onError,this),this._boundClose=b.bind(this.onClose,this),this._boundMessage=b.compose(b.bind(this.onMessage,this),function(a){return JSON.parse(a.data)})}var j=2,k=120,l=function(){},m=function(){throw new Error("Pipe class cannot be used directly.")},n=function(a,c){this.channel=a,this.since=c,this.connection=null,this.paused=!1,this._msgBuffer=[],this._boundOpen=b.bind(this.open,this)};b.extend(n.prototype,c.Events,{getUrl:function(a){var c={};return this.since&&(c.since=this.since),b.extend(c,a),f.serialize(this.baseUrl+this.channel,c)},onMessage:function(a){var b=a.message_type,c=a.firehose_id;this.lastEventId=c,g.log("RT: new message:",b,c);var d={type:b,data:a.message_body,lastEventId:c};this.trigger(b,d)},_msgToBuffer:function(){this._msgBuffer.push(b.toArray(arguments))},pause:function(a){this.paused||(this.paused=!0,this._trigger=this.trigger,this.trigger=a===!1?l:this._msgToBuffer,g.log("RT: paused, buffered: %s",a!==!1))},resume:function(){if(this.paused){this.paused=!1,this.trigger=this._trigger,g.log("RT: resumed, buffered messages: %s",this._msgBuffer.length);for(var a;a=this._msgBuffer.shift();)this.trigger.apply(this,a)}},open:m,close:function(){var a=this.connection;return a?(this.connection=null,a):!1}}),b.extend(h.prototype,n.prototype,{baseUrl:e.realertime+"/api/2/",onError:function(){this.connection&&(this.connection=null,this.trigger("error",this),this.interval<=k&&(this.interval*=j),d.sendStat("rt_streampipe_error"),g.logError("RT: Connection error, backing off %s secs",this.interval),b.delay(this._boundOpen,1e3*this.interval))},onLoad:function(){this.connection&&(this.connection=null,this.since=null,this.trigger("success",this),d.sendStat("rt_streampipe_close"),b.defer(this._boundOpen))},onProgress:function(){if(this.connection){var a,b=this.connection.responseText,c=0;if(b&&!(this.marker>=b.length)){a=b.slice(this.marker).split("\n");for(var d,e,f,h=a.length,i=0;h>i;i++)if(d=a[i],c+=d.length+1,e=d.replace(/^\s+|\s+$/g,"")){try{f=JSON.parse(e)}catch(j){if(i===h-1){c-=d.length+1;break}g.log("RT: unable to parse: ",e,d);continue}this.onMessage(f)}else g.log("RT: ignoring empty row...");c>0&&(this.marker+=c-1)}}},open:function(){this.close();var a=this.connection=d.CORS.request("GET",this.getUrl({bust:++this.reqCounter}),this._boundOnLoad,this._boundOnError);if(!a)return d.sendStat("rt_streampipe_cors_unavail"),void g.log("RT: Cannot use any cross-domain request"+" tool with StreamPipe. Bailing out.");a.onprogress=this._boundOnProgress,this.connection=a,this.marker=0;try{a.send()}catch(b){this.connection=null,d.sendStat("rt_streampipe_cors_fail"),g.log("RT: Attempt to send a CORS request failed.")}},close:function(){var a=n.prototype.close.apply(this);return a&&a.abort()}}),b.extend(i.prototype,n.prototype,{baseUrl:("https:"===window.location.protocol?"wss:":"ws:")+e.realertime+"/ws/2/",onOpen:function(){g.log("RT: [Socket] Connection established."),this.handshakeSuccess=!0,this.since=null},onError:function(){if(this.connection){if(this.connection=null,!this.handshakeSuccess)return g.log("RT: [Socket] Error before open, bailing out."),d.sendStat("rt_socketpipe_fail"),this.trigger("fail"),void 0;this.trigger("error"),this.interval<=k&&(this.interval*=j),d.sendStat("rt_socketpipe_error"),g.logError("RT: Connection error, backing off %s secs",this.interval),b.delay(this._boundOpen,1e3*this.interval)}},onClose:function(a){if(this.connection){if(!a.wasClean)return d.sendStat("rt_socketpipe_unclean_close"),this.onError(),void 0;this.connection=null,d.sendStat("rt_socketpipe_clean_close"),g.log("RT: [Socket] Connection closed. Restarting..."),this.trigger("close"),this.open()}},open:function(){this.close();var a=this.connection=new window.WebSocket(this.getUrl());a.onopen=this._boundOnOpen,a.onerror=this._boundError,a.onmessage=this._boundMessage,a.onclose=this._boundClose},close:function(){var a=n.prototype.close.apply(this);return a&&a.close()}});var o={_wsSupported:window.WebSocket&&2===WebSocket.CLOSING,initialize:function(a,c,d,e){this.close(),this._initArgs=[a,c,d,e];var f=this._wsSupported,g=f?i:h,j=this.pipe=new g(a,c);b.chain(d).pairs().each(function(a){j.on(a[0],a[1],e)}),f&&j.on("fail",function(){this._wsSupported=!1,j.off(),this.initialize.apply(this,this._initArgs)},this),j.open()},pause:function(a){this.pipe&&this.pipe.pause(a)},resume:function(){this.pipe&&this.pipe.resume()},close:function(){this.pipe&&(this.pipe.close(),this.pipe=null)}};return a(window).on("unload",b.bind(o.close,o)),{Pipe:n,StreamPipe:h,SocketPipe:i,Manager:o}}),define("lounge/tracking",["underscore","common/intelligence","common/juggler","common/jester","common/urls"],function(a,b,c,d,e){"use strict";function f(f,i){var j=c.client("juggler",!0),k=new b.Intelligence,l=i.initialData,m=i.switches;a.isObject(l)&&!a.isEmpty(l)&&(i.session.once("identify",function(){var b=this,d=b.user.id;if(d&&(j.overwrite({user_id:d}),m.enabled("dark_jester")&&c.client("jester",!0).overwrite({user_id:d})),m.enabled("juggler_thread_onReady")){var e={thread_slug:l.thread.slug,user_type:b.user.get("user_type")||"anon",referrer:f.document.referrer,theme:"next"},g=l.forum.settings;g&&a.has(g,"organicDiscoveryEnabled")&&a.extend(e,{organic_enabled:g.organicDiscoveryEnabled,promoted_enabled:g.promotedDiscoveryEnabled,max_enabled:g.discoveryMax,thumbnails_enabled:g.discoveryThumbnailsEnabled}),j.emit("init_embed",e),m.enabled("dark_jester")&&c.client("jester",!0).emit("init_embed",e),k.init({version:"next",forum:l.forum.id,features:l.features,session:b.user}),i.session.on("change:id",function(a){k.setSession(a),k.trackEvent(a.id?"login":"logout")})}}),j.load({disable:!m.enabled("juggler_enabled"),url:e.juggler+"/event.js",disableSSL:m.enabled("next_disable_ssl_juggler"),thread:l.thread.id,forum:l.forum.id,forum_id:l.forum.pk}),m.enabled("dark_jester")&&c.client("jester",!0).load(a.extend(j.copySettings(),{url:e.jester+"/event.js"})),i.on({inViewport:function(){k.trackEvent("view_embed"),d.client.emit({verb:"view",object_type:"application",object_id:"embed",zone:h[i.currentSection]}),i.off("inViewport")},"uiAction:createPost":function(a){i.session.user.id||k.setSession("guest"),null!=a.get("parent")?k.trackEvent("post_comment_reply"):k.trackEvent("post_comment")},"uiCallback:postCreated":function(a){var b={object_type:"comment",object_id:a.id,verb:"post",zone:h[i.currentSection]};a.has("parent")&&(b.target_type="comment",b.target_id=a.get("parent")),d.client.emit(b)},"uiAction:seeMore":function(){d.client.emit({verb:"open",object_type:"section",object_id:"next-page",zone:h[i.currentSection]})},"uiAction:postUpvote":function(a){k.trackEvent("like_comment"),d.client.emit({verb:"like",object_type:"comment",object_id:a.id,zone:h[i.currentSection]})},"uiAction:postUnvote":function(a){d.client.emit({verb:"unlike",object_type:"comment",object_id:a.id,zone:h[i.currentSection]})},"uiAction:postDownvote":function(a){k.trackEvent("dislike_comment"),d.client.emit({verb:"dislike",object_type:"comment",object_id:a.id,zone:h[i.currentSection]})},"uiAction:upvotersCardShow":function(){k.trackEvent("upvoters_card_shown")},"uiAction:showProfileFromUpvotes":function(){k.trackEvent("upvoters_profile_click")},"uiAction:threadUnlike":function(){d.client.emit({verb:"unlike",object_type:"thread",zone:h[i.currentSection]})},"uiAction:threadLike":function(){k.trackEvent("like_thread"),d.client.emit({verb:"like",object_type:"thread",zone:h[i.currentSection]})},"uiAction:postShare":function(a,b){k.trackEvent("share_comment_"+b),d.client.emit({verb:"share",object_type:"comment",object_id:a.id,target_type:"service",target_id:b,zone:h[i.currentSection]})},"uiAction:threadShare":function(a){k.trackEvent("share_thread_"+a),d.client.emit({verb:"share",object_type:"thread",target_type:"service",target_id:a,zone:h[i.currentSection]})},"uiAction:navigate":function(a){g[a]&&k.trackEvent("open_"+g[a]),h[a]&&d.client.emit({verb:"open",object_type:"zone",object_id:h[a],zone:h[i.currentSection]})},"uiAction:followUser":function(a){k.trackEvent("follow_user"),d.client.emit({verb:"follow",object_type:"user",object_id:a.id,zone:h[i.currentSection]})},"uiAction:unfollowUser":function(a){d.client.emit({verb:"stop-following",object_type:"user",object_id:a.id,zone:h[i.currentSection]})},"uiAction:openLogin":function(a){k.trackEvent("open_login_"+a),d.client.emit({verb:"open",object_type:"login",object_id:a,zone:h[i.currentSection]})},"uiAction:finishRegistrationEmbed":function(){k.trackEvent("finish_registration_embed")},"uiAction:finishRegistrationWindow":function(){k.trackEvent("finish_registration_window")},"uiAction:finishAccountComplete":function(){k.trackEvent("finish_account_complete")},"uiAction:onboardAlertShow":function(){d.client.emit({section:"onboard_alert",verb:"view",object_type:"alert",zone:h[i.currentSection]})},"uiAction:onboardOpen":function(){d.client.emit({section:"onboard_alert",verb:"open",object_type:"zone",object_id:"embed.onboard",zone:h[i.currentSection]})},"uiAction:onboardAlertDismiss":function(){d.client.emit({section:"onboard_alert",verb:"close",object_type:"alert",zone:h[i.currentSection]})}}))}var g={community:"community",dashboard:"mydisqus",network:"mydisqus_network"},h={community:"community",conversation:"thread",dashboard:"my-notifications",network:"my-activity-feed"};return{init:function(a){f(window,a)}}}),define("lounge/views",["jquery","underscore","backbone","handlebars","moment","modernizr","common/config","common/defines","common/models","common/collections","common/utils","common/bus","common/api","common/strings","common/urls","common/jester","common/views/mixins","common/templates","common/keys","common/corefuncs","common/logger","host/urls","lounge/common","lounge/menu-handler","lounge/mixins","lounge/realtime","lounge/views/posts","lounge/views/posts/collection","lounge/views/dashboard","lounge/views/community","lounge/views/media","lounge/views/onboard-alert","lounge/views/notification-menu","lounge/views/highlighted-post","lounge/views/realtime","initializer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J){"use strict";function K(a){var b=a&&a.match(/discovery\-([\w\-]+)/);return b&&b[1]}var L=w.LoungeSubView,M=n.get,N=k.preventDefaultHandler,O=c.View.extend({events:{"click [data-action^=auth\\:]":"handleAuth","click [data-action=verify-email]":"verifyEmail","click [data-action=audiencesync]":"audienceSync","click [data-action=profile]":"handleShowProfile","click [data-action=onboard]":"handleShowOnboarding","click [data-action=sort]":"handleSort","click [data-action=close-thread]":"closeThread","click [data-action=open-thread]":"openThread","click [data-action=debug]":"renderDebugInfo","click [data-action=repair]":"repairThread","click [data-action=toggle-media]":"toggleMedia","click a":b.wrap(k.logLinkClick,function(b,c){var d=!this.isLinkAffiliatorEnabled()||!a(c.currentTarget).is("[rel=nofollow]");return b(c,d)})},MEDIA_PERSISTED_WIDTHS:[320,480,600,800],MAX_MEDIA_HEIGHT:480,initialize:function(c){w.setLounge(this),c=c||{};var d=c.jsonData||{};this.initialData=d.response||{},this.profileWindowName=b.globalUniqueId("disqus_"),k.extract(d,"response.forum.id")&&(o.moderate=k.updateURL(o.moderate,{hostname:d.response.forum.id+"."})),i.Session.setDefaults(this.initialData.session),this.session=i.Session.get(),this.bindSessionEvents(),this.forum=new i.Forum,this.forum.set(this.initialData.forum),this.thread=new i.Thread(this.initialData.thread,{forum:this.forum,postCursor:d.cursor,moderators:(this.initialData.thread||{}).moderators,order:d.order}),this.postsView=new B.PostCollectionView({posts:this.thread.posts,thread:this.thread,lounge:this,session:this.session,el:this.el}),this.switches=new j.SwitchCollection(g.switches,{parse:!0}),this.states={realtimeIndicatorsCreated:!1,streamingPaused:!1,inViewport:!1,nearViewport:!1},J.timings.loungeStart=a.now(),this.forum.get("settings").backplaneEnabled&&this.enableBackplane();var e=b.bind(this.bootstrap,this);k.isIframed(window)?this.listenTo(l,"init",e):b.defer(e),this.setAlertSelector("#layout")},initOnboardAlert:function(){var a=this.onboardAlert=new F.OnboardAlert({session:this.session});this.proxyViewEvents(this.onboardAlert),this.listenTo(this.session,"change:id",function(){a.setInitialCookie(),a.render().$el.appendTo("#onboard")}),this.listenTo(l,{"onboard.complete":b.bind(a.remove,a),"onboardAlert.show":function(){a.render().$el.appendTo("#onboard")}}),this.listenToOnce(this,"uiCallback:postCreated",function(){if(a.shouldPopup()){a.setPopupCookie();var b=this.session.user.isEditable(this.session)?"complete-profile":"follow";this.showOnboarding(b)}}),this.listenTo(l,"onboard.profileUpdated",this.updateSessionUser)},updateSessionUser:function(){this.updateUserFromSession()||this.session.user.fetch({reset:!0})},updateUserFromSession:function(){var a=this.session.user,b=f.sessionstorage&&sessionStorage.getItem("onboard.profileUpdated");if(!b)return!1;try{var c=JSON.parse(b);a.set(c)}catch(d){return!1}finally{sessionStorage.removeItem("onboard.profileUpdated")}return!0},enableBackplane:function(){this.backplaneCredentialsReady=!1,this.events["click [data-action=logout]"]=function(a){return this.backplaneCredentialsReady?(a.preventDefault(),l.sendHostMessage("backplane.invalidate",{redirectUrl:o.logout}),void 0):!0},this.listenTo(this.session,"identify",function(){this.backplaneCredentialsReady&&!this.session.isRegistered()&&(l.sendHostMessage("backplane.invalidate"),this.backplaneCredentialsReady=!1,m.headers({Authorization:null}))}),this.listenTo(l,"login",function(a){null!==a.backplane&&(this.setBackplaneHeaders(a.backplane),this.fetchSession())}),l.sendHostMessage("loadBackplane")},setBackplaneHeaders:function(a){var b="Backplane "+JSON.stringify({provider:"janrain",message_id_url:a.messageUrl,channel_name:a.channel,forum_id:this.forum.id});this.backplaneCredentialsReady=!0,m.headers({Authorization:b})},bootstrap:function(c){var d=this,e={};d.config=c=c||k.getConfigFromHash(window),this.discoveryOverride=K(c.parentWindowHash),c.apiKey&&(e["X-Disqus-Publisher-API-Key"]=c.apiKey),c.remoteAuthS3&&(e["X-Disqus-Remote-Auth"]=c.remoteAuthS3),b.isEmpty(e)||m.headers(e),c.anchorColor&&!function(){var a=k.escapeColor(c.anchorColor);k.addStylesheetRules([[".publisher-anchor-color a",["color",a,!0]],["a.publisher-anchor-color",["color",a,!0]],[".publisher-anchor-hover a:hover",["color",a,!0]],["a.publisher-anchor-hover:hover",["color",a,!0]],[".active .publisher-nav-color:after",["background",a,!0]],[".media-preview .active.publisher-border-color",["border-color",a,!0]],[".publisher-color",["color",a,!1]],[".publisher-color:hover",["color",a,!1]],[".publisher-background-color",["background-color",a,!1]],[".publisher-border-color",["border-color",a,!1]]])}(),this.isMobile=k.isPhone(window),k.injectBaseElement(c.referrer),c.referrer&&(d.thread.currentUrl=c.referrer),c.width&&(document.body.style.width=c.width+"px");var f=this.getPermalinkOptions(c.parentWindowHash);f&&l.once("embed.rendered",b.bind(d.scrollToPost,d,f.postId,f.options)),c.sso&&(r.globals.sso=c.sso,d.session.set("sso",c.sso)),this.position=c.initialPosition?c.initialPosition:k.calculatePositionFullscreen(),p.client.set({product:"embed",thread:this.initialData.thread.id,forum:this.initialData.forum.id,forum_id:this.initialData.forum.pk}),d.updateModeratorText(),d.initUI(),d.bindBusListeners(),d.initHighlightedPost();var g=J.timings;g.hostStart=c.timestamp||g.initStart,d.listenToOnce(d.postsView,"render:start",function(){g.renderStart=a.now()}),d.listenToOnce(d.postsView,"render:end",d.sendTelemetry),g.bootstrapStart=a.now(),d.postsView.bootstrap(this.initialData,f),d.initSession(),d.listenTo(d.thread,"create",function(a){l.sendHostMessage("posts.create",a.toJSON())}),d.initialized=!0,this.initLinkAffiliator()},sendTelemetry:function(){var b=g.lounge.telemetry_sample_rate;if(b&&!(Math.random()>1/b)){var c=a.now(),d=J.timings,e={frame:d.initStart-d.hostStart,asset:d.downloadEnd-d.initStart,render:c-d.renderStart,total:c-d.hostStart-(d.renderStart-d.bootstrapStart)};(new Image).src=t.serialize(o.jester+"/telemetry/lounge.gif",e)}},initUI:function(){this.applyPublisherClasses(),d.lounge.templates(),this.renderLayout(),this.currentSection="conversation",this.bindUIUpdateHandlers(),this.initDeferredViews(),this.postsView.once("render:end",function(){var a=k.getPageHeight();l.sendHostMessage("mainViewRendered",{height:a}),this._lastHeight=a,this.initRealtime()},this),b.defer(b.bind(this.initUIComponents,this))},initUIComponents:function(){this.findClosestThumbnailSize(),this.renderForm(),this.updatePostCount(),this.initCommunity(),this.initUserMenu(),this.initThreadVotes(),this.initThreadShareMenu(),this.initThreadSubscribe(),this.renderStreamingToggle(),this.initOnboardAlert(),this.bindProfileUIListeners(this.session)},initHighlightedPost:function(){var a=this.thread.get("highlightedPost");a&&this.thread.posts.add(a);var b=this.highlightedPostView=new H.HighlightedPostView({thread:this.thread,session:this.session,switches:this.switches});this.updateDom(function(){this.$("#highlighted-post").html(b.render().el)},this)},bindUIUpdateHandlers:function(){var a=this,b=a.thread,c=a.session;a.listenTo(b,{"change:likes":a.updateThreadVotes,"change:userScore":a.updateThreadUserScore,"change:posts":a.updatePostCount}),a.listenTo(b.queue,"add reset",a.toggleRealtimeNotifications),a.postsView.bindUIUpdateHandlers(),a.listenTo(c,"change:id",a.updateThreadSessionData),a.initNotificationMenu(),a.listenTo(c,"change:id",a.initDashboard),a.listenTo(a,"scrollOffViewport",function(){this.states.realtimeIndicatorsCreated&&"conversation"===this.currentSection&&l.sendHostMessage("indicator:hide")}),a.listenTo(a,"scroll",a.handleRealtimeScroll),a.listenTo(a,"scroll",function(a){this.position=a,"conversation"===this.currentSection&&(this.conversationPosition=a)}),a.listenTo(a.postsView,"render:end",a.toggleRealtimeNotifications)},initDeferredViews:function(){var a=this;a.deferredViews=[],a.unsortedDeferredViews=[],a.listenTo(a,"scroll",a.processDeferredViews),a.listenTo(a,"domReflow",function(){this.invalidateDeferredViewOffsets(),this.processDeferredViews()}),a.listenTo(l,"window.resize",a.processDeferredViews)},initSession:function(){!this.switches.enabled("next_lazy_embed")||this.states.inViewport?this.fetchSession():this.listenToOnce(this,"inViewport",this.fetchSession)},bindBusListeners:b.once(function(){this.listenTo(l,{"window.hashchange":function(a){if(this.discoveryOverride=K(a),this.discoveryOverride)return this.fetchSession();var b=this.getPermalinkOptions(a);b&&this.scrollToPost(b.postId,b.options)},"window.scroll":function(a){this.trigger("scroll",a)},"window.inViewport":function(){this.states.inViewport=!0,this.trigger("inViewport")},"window.nearViewport":function(){this.states.nearViewport=!0,this.trigger("nearViewport")},"window.scrollOffViewport":function(){this.states.inViewport=!1,this.states.nearViewport=!1,this.trigger("scrollOffViewport")},"window.resize":this.resize,"indicator:click":this.handleRealtimeClick,"!auth:success":function(a){a&&(a.sessionId&&m.headers({"X-Sessionid":a.sessionId}),a.message&&this.alert(a.message,{type:"info"}),a.logEvent&&this.trigger("uiAction:"+a.logEvent)),this.fetchSession()},"!audiencesync:grant":function(){this.session.set("audienceSyncVerified",!0)}})}),isLinkAffiliatorEnabled:function(){return this.switches.enabled("enable_link_affiliation")&&k.extract(this,"initialData.forum.settings.linkAffiliationEnabled")&&!this.isHttps()&&this.isPublisherIdValid()},isPublisherIdValid:function(){var a=k.extract(this,"initialData.forum.pk");return b.isNumber(a)},initLinkAffiliator:function(){if(this.isLinkAffiliatorEnabled()&&!this.initLinkAffiliatorCalled){this.initLinkAffiliatorCalled=!0;var a=k.extract(this,"initialData.forum.pk"),c=new W({el:document.body});l.once("affiliationOptions",function(a){a&&b.isNumber(a.timeout)&&c.trigger("options.timeout",a.timeout)}),l.sendHostMessage("loadLinkAffiliator",{clientUrl:o.linkAffiliatorClient,apiUrl:o.linkAffiliatorAPI,key:s.viglinkAPI,id:a})}},bindSessionEvents:b.once(function(){this.listenTo(this.session,"change:isReadOnly",function(){this.session.get("isReadOnly")&&this.alert(M("The Disqus comment system is temporarily in maintenance mode. "+"You can still read comments during this time, however posting "+"comments and other actions are temporarily delayed."))}),this.listenTo(this.session,"identify change:audienceSyncVerified",function(){this.session.get("audienceSyncVerified")&&l.sendHostMessage("session.identify",this.session.user.id)}),this.listenTo(this.session,"change:discoveryVariant",this.initDiscovery)}),fetchSession:function(){var a={thread:this.thread};return this.switches.enabled("discovery_next:override")&&this.discoveryOverride&&(a.discovery=this.discoveryOverride),this.session.fetch(a)},initRealtimeIndicators:function(){if(!this.switches.enabled("disable_realtime_indicators")&&!this.states.realtimeIndicatorsCreated){var a={contents:r.render("realtimeIndicator",{orientation:"north"})},b={contents:r.render("realtimeIndicator",{orientation:"south"})};l.sendHostMessage("indicator:init",{north:a,south:b}),this.states.realtimeIndicatorsCreated=!0}},insertStreamingComments:b.throttle(function(){var a=this.thread.queue;a.drain(),b.each(a.counters.replies,function(b,c){a.drain(c)})},1e3),updateModeratorText:function(){var a=this.forum.get("settings");a.moderatorText&&(n.translations.Mod=a.moderatorText)},handleRealtimeScroll:function(a){if(this.states.inViewport&&this.states.realtimeIndicatorsCreated&&"conversation"===this.currentSection){var c=b.union([this.queueView],b.values(this.postsView.subViews)),d=0,e=0;b.each(c,function(b){if(b&&!b.getDirection&&(b=b.queueView),b&&!(b.options.count<=0)){var c=b.getDirection(a);1===c?d+=b.options.count:c===-1&&(e+=b.options.count)}});var f,g;g={type:"north"},d>0?(f="indicator:show",g.content=r.render("realtimeIndicatorText",{num:d,orientation:"north"})):f="indicator:hide",l.sendHostMessage(f,g),g={type:"south"},e>0?(g.content=r.render("realtimeIndicatorText",{num:e,orientation:"south"}),f="indicator:show"):f="indicator:hide",l.sendHostMessage(f,g)}},handleRealtimeClick:function(a){var c=this;l.sendHostMessage("indicator:hide",{type:a});var d,e,f,g=b.union([c],b.toArray(c.postsView.subViews));g=b.filter(g,function(b){if(b=b.queueView,!b||b.options.count<=0)return!1;var d="north"===a?1:-1;return b.getDirection(c.position)!==d?!1:!0}),g=b.sortBy(g,function(a){return a===c?0:a.offset.top}),d="north"===a?b.last(g):b.first(g),e=d.queueView,d===c?(f=0,e.handleDrain()):(f=d.offset.top-100,e.handleDrain()),w.getLounge().once("domReflow",b.bind(l.sendHostMessage,l,"scrollTo",{top:f}))},toggleRealtimeNotifications:function(){var c=this,d=c.thread.queue;c.updateDom(function(){if(b.defer(function(){l.sendHostMessage("fakeScroll")}),!d.length)return void a("[data-role=realtime-notification]").hide();if(c.thread.get("hasStreaming"))return void c.insertStreamingComments();if(d.counters.comments){var e=c.queueView||new I.QueuedPostView({model:c.thread,el:c.$el.find("button[data-role=realtime-notification]")});c.queueView=e,e.setCount(d.counters.comments),e.render()}b.each(d.counters.replies,function(a,b){var d=c.thread.posts.get(b);if(d){var e=c.postsView.getPostView(d.cid);if(e){var f=e.queueView;f||(f=new I.QueuedReplyView({thread:c.thread,postView:e,model:d,el:e.$el.find("[data-role=realtime-notification\\:"+b+"] a")}),e.queueView=f),f.setCount(a),f.render()}}})})},renderDebugInfo:N(function(){if(this.session.user.get("isGlobalAdmin")){for(var a=[],b=0,c=this.switches.models.length;c>b;b++)this.switches.models[b].attributes.enabled&&a.push(this.switches.models[b].id);var d=new U({Shortname:this.thread.get("forum"),"Thread ID":this.thread.get("id"),"Thread slug":this.thread.get("slug"),"Anchor color":k.escapeColor(this.config.anchorColor),Switches:a.join(", ")});d.render(),this.updateDom(function(){var a=document.body;a.insertBefore(d.el,a.firstChild)})}}),repairThread:N(function(){this.session.user.get("isGlobalAdmin")&&m.call("internal/threads/repair.json",{method:"GET",data:{thread:this.thread.get("id")},success:b.bind(this.alert,this,"Thread repair has been queued. Refresh in a few seconds."),error:b.bind(this.alert,this,"An error occurred while repairing thread. Please try again.","error")})}),getPermalinkOptions:function(a){var b=a&&a.match(/(comment|reply|edit)\-([0-9]+)/);if(b)return{postId:b[2],options:{highlight:!0,openReply:"reply"===b[1],openEdit:"edit"===b[1]}}},scrollToPost:function(a,c){c=c||{};var d=this;"conversation"!==d.currentSection&&(c.force=!0),d.mainNav.navTo("conversation");var e=d.$el.find("#post-"+a);return e.length?(c.highlight&&(d.$el.find(".post-content.target").removeClass("target"),e.find(".post-content").first().addClass("target")),c.openReply&&d.postsView.openReply(a),c.openEdit&&d.postsView.openEdit(a),l.sendHostMessage("scrollTo",{top:e.offset().top+(c.padding||0),force:c.force||null}),void 0):(i.Post.fetchContext(a,d.thread,{requestedByPermalink:!0}).done(function(){l.once("embed.resized",b.bind(d.scrollToPost,d,a,c))}),void 0)},updateThreadSessionData:function(a){if(a){a.get("thread")&&this.thread.set(a.get("thread"));var c=a.get("votes");c&&"object"==typeof c&&b.each(c,function(a,b){var c=this.postsView.posts.get(b);c&&c.set("userScore",a)},this)}},initDashboard:function(){var b=a("#main-nav [data-nav=dashboard]");return this.session.isAnonymous()?b.hide():(b.show(),this.notificationCount=new w.NotificationCountView({el:b.find("[data-role=notification-count]")[0],session:this.session,max:99}),this.notificationCount.render(),this.listenTo(this.session,"change:notificationCount",function(){this.session.get("notificationCount")<=0?this.notificationCount.remove():this.notificationCount.render()}),this.dashboard=new C.DashboardView({el:"#dashboard",session:this.session,notifications:this.notifications}),this.dashboard.render(),void 0)},initCommunity:function(){this.community=new D.CommunityView({el:document.getElementById("community"),forum:this.forum,session:this.session})},initNotificationMenu:function(){var a=this.notificationMenu=new G.NotificationMenuView({el:this.$el.find("[data-role=notification-menu]")[0],session:this.session});a.render(),this.listenTo(this.session,"change:id",b.bind(a.render,a)),this.listenTo(this.session,"change:notificationCount",b.bind(a.render,a))},initUserMenu:function(){var a=this.userMenu=new S({el:this.$el.find("[data-role=logout]")[0],session:this.session,thread:this.thread,referrerUrl:this.config.referrer});
this.listenTo(this.thread,"change:isClosed",this.render),a.render()},initThreadShareMenu:function(){this.threadShareMenu=new P({el:a("#thread-share-menu")[0],model:this.thread})},hasSponsoredPostInTrophyPosition:function(){if(this.highlightedPostView){var a=this.highlightedPostView.getPost();return a&&a.get("isSponsored")}},initDiscovery:function(a,c){function e(a){var b=document.createElement("link");b.rel="stylesheet",b.href=a,document.getElementsByTagName("head")[0].appendChild(b)}var f=this;if(!f.states.initDiscoveryCalled){if(f.states.initDiscoveryCalled=!0,!c)return void u.log("Discovery seems not enabled. Check Gargoyle switches or forum settings.");e("//a.disquscdn.com/next/styles/discovery.409f6987e867ba2cca31e592ba783df2.css"),require(["//a.disquscdn.com/next/discovery.194681e85a56dddf777aec16d8fbb8a1.js"],function(){require(["discovery"],function(e){c.topPlacementEnabled&&f.hasSponsoredPostInTrophyPosition()&&(c.topPlacementEnabled=!1),d.discovery.templates();var g=e.init(b.extend({},c,{sourceThread:f.initialData.thread,sourceForum:f.initialData.forum,containerId:"discovery",session:a,sourceThreadUrl:f.thread.currentUrl||document.referrer,position:f.getPosition()}));f.listenTo(g,"resize",f.updateDom)})})}},isHttps:function(){return"https:"===window.location.protocol},isRealtimeEnabled:function(){var a=e.unix(this.initialData.lastModified);return!this.thread.get("isClosed")&&(this.switches.enabled("realtime_for_oldies")||e().diff(a,"days")<=7)},realtimeHandlers:{Post:function(a){var b=a.data,c=this.thread;if(!this.thread.get("hasStreaming")||!this.states.streamingPaused){if(!b.id)return void u.logError("RT: no post ID");if(!b.author||!b.author.id)return void u.logError("RT: no author or author ID");if(!b.author.name)return void u.logError("RT: no author name or email hash");if(!b.post||!b.post.message)return void u.logError("RT: no post message");if(c.posts.get(b.id)||c.queue.get(b.id))return void u.log("RT: duplicate: ",b.id);if("approved"!==b.type)return void u.log("RT: unnaproved: ",b.id);if(b.type===b.type_prev)return void u.log("RT: Post change message, ignoring for now ",b.id);this.thread.incrementPostCount(1);var d=b.post.parent_post.id;if(d="0"!==d?d:null,d&&!c.posts.get(d)&&!c.queue.get(d))return void u.log("RT: parent is not on this page: ",b.id);var e=b.author.id,f=c.users.get(e);f||(f=new i.UniqueModel(i.User,{id:e,name:b.author.name,isAnonymous:"0"===b.author.id}),b.author.avatar&&f.set("avatar",{cache:b.author.avatar,permalink:b.author.avatar}),c.users.add(f)),c.queue.add({id:b.id,userId:f.get("id"),parentId:d,message:b.post.message,createdAt:b.date})}},Vote:function(a){var b=a.data;if(b.id&&b.vote){var c=this.thread,d=c.posts.get(b.vote.recipient_post_id);if(d){u.log("RT: Vote for post ",d.id);var e=d.votes.get(b.id);e||(u.log("RT: Creating new vote with id ",b.id),e=new i.Vote({id:b.id}),d.votes.add(e));var f=d._vote(b.vote.vote,e.get("score"));0!==f&&e.set("score",f)}}},ThreadVote:function(a){var b=a.data,c=this.thread;if(b.id&&b.vote&&(!this.session.user.id||b.vote.voter_id!==this.session.user.id)){var d=c.votes.get(b.id);d||(d=new i.ThreadVote({id:b.id}),c.votes.add(d));var e=c._vote(b.vote.vote,d.get("score"));0!==e&&d.set("score",e)}},typing:function(a){var c=a.data,d=this.thread,e=c.typing,f=c.post;if(c.thread===d.id&&f){var g=d.posts.get(f);g&&(g.usersTyping.count()<=0&&!e||g.usersTyping.add(i.TypingUser.make(b.extend({client_context:a.lastEventId},c))))}}},initRealtime:function(){var a=z.Manager;if(!a.pipe&&this.isRealtimeEnabled()){this.initRealtimeIndicators();var b;this.switches.enabled("aggressive_embed_cache")&&(b=this.initialData.lastModified),a.initialize("thread/"+this.thread.id,b,this.realtimeHandlers,this);var c=0;this.listenTo(m,"call",function(b){"POST"!==b.method||b.secure||(c++,a.pause())}),this.listenTo(m,"complete",function(){0>=c||--c||a.resume()})}},updateDom:function(){var a=b.debounce(function(){this.resize(),this.trigger("domReflow")},0);return function(b,c){b&&b.call(c),a.call(this)}}(),initThreadVotes:b.debounce(function(){var c,d=this;d.threadVotes&&d.threadVotes.remove(),d.threadVotes=c=new Q({thread:d.thread,session:d.session}),d.listenTo(c,{"vote:like":b.bind(d.trigger,d,"uiAction:threadLike"),"vote:unlike":b.bind(d.trigger,d,"uiAction:threadUnlike")}),c.render(),this.updateDom(function(){a("#thread-votes").append(c.el)})},200),initThreadSubscribe:function(){this.threadSubscribeButton=new R({session:this.session,thread:this.thread,el:a("#thread-subscribe-button")[0]})},renderStreamingToggle:function(){var b=this;if(b.thread.get("hasStreaming")){var c=a(r.render("realtimeToggleButton"));a(c).on("click",N(function(){b.toggleStreamingRealtime()})),b.updateDom(function(){a("#realtime-toggle").empty(),a("#realtime-toggle").append(c[0])})}},toggleStreamingRealtime:function(){var b=a("#realtime-toggle a.btn");this.states.streamingPaused?(this.states.streamingPaused=!1,b.addClass("pause")):(this.states.streamingPaused=!0,b.removeClass("pause"))},updateThreadVotes:function(){a("#thread-votes [data-role=like-count]").text(this.thread.get("likes"))},updateThreadUserScore:function(){var b=this.thread.get("userScore"),c=a("#thread-votes [data-role=vote-button]");c.removeClass("upvoted").removeClass("downvoted"),b>0?c.addClass("upvoted"):0>b&&c.addClass("downvoted")},updatePostCount:function(){var a=this;this.postCountContainer=this.postCountContainer||this.$("a[data-role=post-count]"),this.postCountContainer.html(r.render("postCount",{count:a.thread.get("posts")}))},swapMain:function(a){var c=this,d=this.$el.find("#main-nav [data-nav=conversation]").parent("li");"conversation"!==a?d.attr("data-dropdown","disabled"):b.defer(function(){d.attr("data-dropdown","enabled")}),c.updateDom(function(){c.states.realtimeIndicatorsCreated&&"conversation"!==a&&l.sendHostMessage("indicator:hide");var d=c[a];d&&!d.isRendered&&(c.freeze(!0),c.listenToOnce(d,"render:all",b.bind(c.freeze,c,!1)),d.show()),c.$el.find("[data-role=main]").hide(),c.$el.find("[data-role=main]#"+a).show(),c.prevSection=c.currentSection,c.currentSection=a}),c.trigger("uiAction:navigate",a)},setupNavigation:function(){var a=this;a.mainNav=new V({el:a.$("#main-nav")}),a.listenTo(a.mainNav,"nav",function(a){this.swapMain(a),this.updateDom()})},renderLayout:function(){var b=this;b.addFeatureDetectionClasses(),x.init();var c=a(r.render("layout",{thread:b.thread.toJSON(),forum:b.forum.toJSON(),order:b.thread.posts.getOrder()}));c.appendTo(b.$el),b.setupNavigation(),b.postsView.renderLayout(),b.updateDom()},addFeatureDetectionClasses:function(){var b=a(document.documentElement);this.isMobile&&b.addClass("mobile"),k.useOpacityTransitions(window)&&b.addClass("use-opacity-transitions")},renderForm:function(){if(this.thread.get("isClosed"))return void this.alert(M("Comments for this thread are now closed."));if(!this.session.get("canReply"))return void this.session.once("change:id",this.renderForm,this);var b=this.form=new A.PostReplyView({thread:this.thread,session:this.session});b.render(),this.updateDom(function(){b.prependTo(a("#form")),b.resize()},this)},showOnboarding:function(a){this.showOnboardApp({threadId:this.thread.get("id"),forumId:this.forum.get("id"),forumPk:k.extract(this,"initialData.forum.pk").toString(),session:this.session,activeSection:a,isFullscreen:this.isFullscreen})},handleShowOnboarding:N(function(b){var c=a(b.target).attr("data-section");this.showOnboarding(c)}),handleShowProfile:N(function(b){var c=a(b.currentTarget).attr("data-user");this.showProfile(c)}),handleSort:N(function(b){var c=a(b.currentTarget).attr("data-sort");this.$el.find('[data-role="post-sort"]').replaceWith(r.render("postSort",{order:c})),this.thread.posts.setOrder(c),this.thread.posts.fetch({reset:!0}),k.cookies.create("disqus.order",c),this.postsView.handleSort()}),closeThread:N(function(){this.thread.close({success:b.bind(l.sendHostMessage,l,"reset"),error:b.bind(this.alert,this,"An error occurred while closing thread. Please try again.","error")})}),openThread:N(function(){this.thread.open({success:b.bind(l.sendHostMessage,l,"reset"),error:b.bind(this.alert,this,"An error occurred while opening thread. Please try again.","error")})}),findClosestThumbnailSize:function(){var a=document.body.offsetWidth;if(this.loadedThumbnailWidth)return this.loadedThumbnailWidth;var c=this.MEDIA_PERSISTED_WIDTHS,d=c.length;this.loadedThumbnailWidth=b.find(c,function(b,e){return e+1===d||Math.abs(c[e+1]-a)>Math.abs(c[e]-a)})},createDeferredViewsForImages:function(){var b=this;a("img[data-src]").each(function(c,d){var e=a(d),f=new T({el:d,url:e.attr("data-src"),relatedPost:e.attr("data-post")});e.removeAttr("data-src"),b.trackDeferredView(f)})},trackDeferredView:function(a){if(null===a.getOffset())return void this.unsortedDeferredViews.push(a);var c=b.sortedIndex(this.deferredViews,a,function(a){var b=a.getOffset();return b?b.visibleTop:null});this.deferredViews[c]!==a&&this.deferredViews.splice(c,0,a)},invalidateDeferredViewOffsets:function(){b.invoke(this.deferredViews,"invalidateOffset"),this.unsortedDeferredViews=this.unsortedDeferredViews.concat(this.deferredViews),this.deferredViews=[]},trackUnsortedDeferredViews:function(){var a=this.unsortedDeferredViews;this.unsortedDeferredViews=[],b.each(a,this.trackDeferredView,this)},getPosition:function(){return this.position},processDeferredViews:function(){this.createDeferredViewsForImages(),this.trackUnsortedDeferredViews();var a=this.deferredViews.length;if(a){var c=this.getPosition(),d=c.pageOffset+c.height-c.frameOffset.top;if(!(0>d)){for(var e=0;a>e;++e){var f=this.deferredViews[e];if(!f.isAboveOffset(d))break;f.options.relatedPost&&this.postsView.listenTo(f,"load error",b.bind(this.postsView.onDeferredViewReady,this.postsView,f.options.relatedPost)),f.trigger("viewport:enter")}this.deferredViews=this.deferredViews.slice(e)}}},showProfile:function(b){f.sessionstorage&&sessionStorage.setItem("profile.session",JSON.stringify(this.session.user.toJSON())),a(document).trigger("mouseout");var c={threadId:this.thread.get("id"),forumId:this.forum.get("id"),forumPk:k.extract(this,"initialData.forum.pk").toString()};if(h.browser.mobile){var d={user:{id:b},fullscreen:!0};k.windowOpen(v.get("profile",{f:this.forum.get("id")},d))}else c.userId=b,l.sendHostMessage("profile.show",c)},resize:function(){var a=k.getPageHeight();this._lastHeight!==a&&(this._frozen&&this._lastHeight&&this._lastHeight>a||(this._lastHeight=a,l.sendHostMessage("resize",{height:a})))},freeze:function(a){this._frozen=!!a,this._frozen===!1&&this.resize()},windowOpen:function(a,b,c){k.windowOpen(a,"_blank",{width:b,height:c})},authenticate:function(a){var c=this.authServices[a];if(!c)return void u.log("Unknown authentication service: "+a);if(b.isFunction(c))return c.call(this);w.getLounge().trigger("uiAction:openLogin",a);var d={forum:this.thread.forum.get("id")};"https:"===window.location.protocol&&(d.redirect_secure=1),b.extend(d,c.params),this.windowOpen(t.serialize(c.url,d),c.width,c.height)},handleAuth:N(function(a){this.authenticate(k.extractService(a.target,"auth"))}),authServices:{disqus:{url:o.login,width:460,height:355},disqusDotcom:{url:o.dotcomLogin,width:478,height:590,params:{next:o.login}},twitter:{url:o.oauth.twitter,width:650,height:680},facebook:{url:o.oauth.facebook,width:550,height:300},google:{url:o.oauth.google,width:650,height:440},sso:function(){var a=parseInt(this.config.sso.width||"800",10),c=parseInt(this.config.sso.height||"500",10),d=window.open(this.config.sso.url,"_blank","width="+a+",height="+c);!function e(){k.isWindowClosed(d)?l.sendHostMessage("reload"):b.delay(e,500)}()}},verifyEmail:N(function(){var a=t.serialize(o.verifyEmail,{f:this.forum.id});window.open(a,"_blank","width=460,height=355")}),getAudienceSyncUrl:b.memoize(function(){var a={client_id:this.config.apiKey,response_type:"audiencesync",forum_id:this.forum.id};return"https:"===window.location.protocol&&(a.ssl=1),t.serialize(o.authorize,a)}),audienceSync:N(function(){this.windowOpen(this.getAudienceSyncUrl(),460,355)}),toggleMedia:N(function(){var a=E.settings,b=!a.get("collapsed");a.set("collapsed",b)})});b.extend(O.prototype,y.ShareMixin),b.extend(O.prototype,y.AlertMixin),k.mixin(O,q.UiActionEventProxy),k.mixin(O,q.OnboardHelper),q.appliesPublisherClasses.call(O.prototype);var P=L.extend({events:{"click [data-action=share\\:twitter]":"_onShare","click [data-action=share\\:facebook]":"_onShare"},_onShare:N(function(a){var b=k.extractService(a.target,"share");b&&this.sharers[b]&&(w.getLounge().trigger("uiAction:threadShare",b),this.share(b))}),_shareUrl:function(){return this.model.url()}});b.extend(P.prototype,y.ShareMixin);var Q=L.extend({className:"thread-likes",initialize:function(a){b.extend(this,a)},events:{"click [data-action=upvote]":"upvote"},render:function(){var a=this,b=a.$el;return b.html(r.render("threadVotes",{thread:a.thread.toJSON(),user:a.session.toJSON()})),a.thread.get("userScore")>0?b.addClass("upvoted"):b.removeClass("upvoted"),b.attr("data-role","vote-button"),b},upvote:N(function(){this.vote(1)}),vote:function(a){var c,d=this.thread.get("userScore")===a;this.trigger(d?"vote:unlike":"vote:like"),this.thread.vote(d?0:a),d||(c=this.$el.find(".dropdown"),b.defer(function(){c.addClass("open")}))},remove:function(){this.off(),c.View.prototype.remove.call(this)}}),R=L.extend({events:{"click [data-action=subscribe]":"subscribe","keydown #thread-subscribe-email":"subscribeKeypress"},initialize:function(a){this.thread=a.thread,this.session=a.session,this.listenTo(this.thread,"change:userSubscription",this.updateStatus),this.updateStatus(),this._boundDocumentClickHandler=b.bind(this._documentClickHandler,this)},updateStatus:function(){this.thread.get("userSubscription")?this.$el.addClass("subscribed"):this.$el.removeClass("subscribed")},subscribe:N(function(){var a=this.thread.get("userSubscription");this.session.isAnonymous()&&!a?this.showForm():this.thread.subscribe(!a)}),showForm:function(){var c=this;this._unbindDocumentClickHandler(),b.defer(function(){a(document.body).on("click",c._boundDocumentClickHandler)}),c.$el.addClass("show-form").find("input")[0].focus()},_documentClickHandler:function(a){"thread-subscribe-email"!==a.target.id&&this.hideForm()},_unbindDocumentClickHandler:function(){a(document.body).off("click",this._boundDocumentClickHandler)},hideForm:function(){this._unbindDocumentClickHandler(),this.$el.removeClass("show-form").find("input")[0].blur()},subscribeKeypress:function(a){var b=this.$el.find("input");if(b.removeClass("alert error"),"Esc"===a.key||27===a.keyCode)return void this.hideForm();if("Enter"===a.key||13===a.keyCode){var c=a.target.value;if(!k.validateEmail(c))return b.addClass("alert error"),void 0;this.hideForm(),this.thread.subscribe(!0,c)}}}),S=L.extend({initialize:function(a){b.extend(this,a),this.listenTo(this.session,"change:id",this.render),this.listenTo(E.settings,"change:collapsed",this.onMediaCollapseChange)},render:function(){var a=r.render("userMenu",{user:this.session.toJSON(),thread:this.thread.toJSON(),feedbackUrl:this.getSurveyMonkeyUrl(),sso:this.session.get("sso")});this.updateDom(function(){this.$el.html(a),this.onMediaCollapseChange()},this)},onMediaCollapseChange:function(){E.settings.get("collapsed")?this.$el.addClass("media-collapsed"):this.$el.removeClass("media-collapsed")},getSurveyMonkeyUrl:function(){var a,b="https://www.surveymonkey.com/s/5RBPTTZ",c=this.referrerUrl,d=this.session.user.id;a=d?[d,c]:[c];var e="?c="+encodeURIComponent(a.join(";"));return b+e}}),T=L.extend(b.extend({},q.IsVisibleViewMixin,{topEdgeOffset:function(){return-w.getLounge().getPosition().height},initialize:function(){this.hasLoaded=null,this.once("viewport:enter",this.loadImage,this)},loadImage:function(){var a=this;if(!a.hasLoaded){var b=function(b){return function(){a.trigger(b),a.$el.off(".deferredMediaView")}};a.$el.on("load.deferredMediaView",b("load")),a.$el.on("error.deferredMediaView",b("error")),a.$el.attr("src",a.options.url),a.hasLoaded=!0}}})),U=L.extend({tagName:"ul",className:"debug",initialize:function(a){this.values=a},render:function(){return this.$el.empty(),b.each(this.values,function(a,b){var c=document.createElement("li");c.innerHTML="<strong>"+b+"</strong>"+": "+a,this.$el.append(c)},this),this}}),V=c.View.extend({events:{"click [data-nav]":"_navTo"},initialize:function(){this.prevDestination=this.activeNav()},_navTo:function(b){b.preventDefault();var c=a(b.target);c=c.is("[data-nav]")?c:c.closest("[data-nav]");var d=c.attr("data-nav");this.navTo(d)},navTo:function(a){if(this.prevDestination!==a){this.prevDestination=a;var b=this.$el.find("[data-nav="+a+"]").parent();b.siblings("li").removeClass("active"),b.addClass("active"),this.trigger("nav",a)}},activeNav:function(){return null!=this.prevDestination?this.prevDestination:this.$el.find(".active [data-nav]").attr("data-nav")},clear:function(){this.$el.find("li").removeClass("active"),this.prevDestination=null}}),W=c.View.extend({events:{"click [rel=nofollow]":"sendLinkForInspection"},initialize:function(){this.link=null,this.busy=!1,this.timeoutId=null,this.timeout=1e3,this.token=1,this.listenTo(this,"option.timeout",function(a){this.timeout=a})},setLink:function(b){this.link=b,this.$link=a(this.link)},onAffiliatorResponse:function(a){a=a||{},a.token===this.token&&(l.off("affiliateLink",this.onAffilatorResponse),a.url&&(this.link.href=a.url),this.undelegateEvents(),this.$link.triggerClick())},sendLinkForInspection:function(a){if(a.currentTarget===this.link)return void a.preventDefault();if("_blank"!==a.currentTarget.getAttribute("target")){var c=a.ctrlKey||a.metaKey||a.altKey||a.shiftKey,d=a.which&&1===a.which||0===a.button;if(c||!d)return!0;this.busy&&(l.off("affiliateLink"),this.timeoutId&&window.clearTimeout&&(window.clearTimeout(this.timeoutId),this.timeoutId=null),this.token++),this.busy=!0,this.setLink(a.currentTarget),a.preventDefault(),this.listenTo(l,"affiliateLink",this.onAffiliatorResponse),l.sendHostMessage("affiliateLink",{token:this.token,url:this.link.href});var e=b.bind(function(a){this.onAffiliatorResponse({token:a})},this,this.token);this.timeoutId=b.delay(e,this.timeout)}}});return k.mixin(O,q.ProfileHtmlHelpers),{Lounge:O,UserMenuView:S,ThreadVotesView:Q,ThreadSubscribeButton:R,DeferredMediaView:T,OutboundLinkHandler:W,DebugInfoView:U}}),define("lounge/views/uploads",["jquery","underscore","backbone","modernizr","common/api","common/utils","common/models","common/strings","common/templates","common/corefuncs","lounge/common"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=h.get,m=k.LoungeSubView,n=function(a){if(!a)throw new Error("Cannot instantinate MediaStore without a valid storageKey!");this._storageKey=a,this._store=d.localstorage?window.localStorage:f.hashStorage};b.extend(n.prototype,{getItems:function(){var a=this._store.getItem(this._storageKey);return a&&JSON.parse(a)||{}},clear:function(){this._store.removeItem(this._storageKey)},getItem:function(a){return this.getItems()[a]},setItem:function(a,b){var c=this.getItems();return c[a]=b,this._store.setItem(this._storageKey,JSON.stringify(c)),b},removeItem:function(a){var b=this.getItems();return a in b?(delete b[a],this._store.setItem(this._storageKey,JSON.stringify(b)),!0):!1}});var o=m.extend({events:function(){var a={"click [data-action=attach]":"_attachMedia"};return window.FormData&&b.extend(a,{dragover:"_dragOn",dragenter:"_dragOn",dragleave:"_dragOff",dragexit:"_dragOff",drop:"_drop"}),a},initialize:function(a){this.parent=a.parent,this.urls=a.urls},setElement:function(){var a=m.prototype.setElement.apply(this,arguments);return this.$dragPlaceholder=this.$el.find("[data-role=drag-drop-placeholder]"),this.$mediaSelector&&this.$mediaSelector.off(),this.$mediaSelector=this.$el.find("input[type=file][data-role=media-upload]"),this.$mediaSelector.on("change",b.bind(this._selectorChange,this)),a},_toggleDragPlaceholder:b.throttle(function(a){a?this.$dragPlaceholder.show():this.$dragPlaceholder.hide()},50),_selectorChange:function(a){this.uploadMedia(a.target.files),a.target.files&&d.localstorage&&!window.localStorage.getItem("usedDragDrop")&&this.trigger("uploader:alert",l("Did you know you can drag and drop images too? Try it now: drag images below."),{},function(){window.localStorage.setItem("usedDragDrop","1")})},_dragOn:function(a){a.stop(),this._toggleDragPlaceholder(!0),this.trigger("uploader:dragEnter")},_dragOff:function(a){a.stop(),this._toggleDragPlaceholder(!1)},_drop:function(a){a.stop(),window.localStorage.setItem("usedDragDrop","1"),this._toggleDragPlaceholder(!1),this.uploadMedia(a.originalEvent.dataTransfer.files)},_attachMedia:function(a){a.stop(),this.$mediaSelector.click()},_uploadMediaModern:function(a){for(var b=this,c=new FormData,d=0,e=a[d];e;e=a[++d])e.type.match(/^image\//)&&c.append("attachment",e);c.append("json","true"),this.parent&&c.append("id",this.parent.id);var g=f.CORS.request("POST",this.urls.add,function(){if(void 0===g.readyState||4===g.readyState&&200===g.status){var a=JSON.parse(g.responseText);a.success?b.trigger("uploader:addMedia",a.media):b.trigger("uploader:alert",a.message,"error")}},function(){var a=l("Unfortunately your image upload failed. Please verify "+"that your image is under 2MB. If you continue seeing "+"this error, please try again later.");413===g.status&&(a=l("Sorry, but the file you submitted is larger than 2 MB. Please make it smaller and try again.")),b.trigger("uploader:alert",a,"error")});g.withCredentials=!0,g.send(c)},_uploadMediaLegacy:function(){var c=this,d=document.createElement("iframe"),e=document.createElement("form"),f=this.$mediaSelector[0];a(f).off();var g=a(f.cloneNode(!0));if(f.parentNode.replaceChild(g[0],f),g.on("change",b.bind(this._selectorChange,this)),this.$mediaSelector=g,d.style.display="none",d.name="uploadFrame"+ +new Date,e.style.display="none",e.target=d.name,e.action=this.urls.add,e.method="post",e.appendChild(d),e.appendChild(f),this.parent){var h=document.createElement("input");h.type="hidden",h.name="id",h.value=this.parent.id,e.appendChild(h)}e.enctype="multipart/form-data",e.encoding="multipart/form-data";var i=function(b){var d=b.originalEvent,f=JSON.parse(d.data);"upload"===f.name&&(a(e).remove(),a(window).off("message",i),f.data.success?c.trigger("uploader:addMedia",f.data.media):c.trigger("uploader:alert",f.data.message,"error"))};a(window).on("message",i),this.updateDom(function(){this.$el.append(e),e.submit()},this)},uploadMedia:function(a){var b=window.FormData?"Modern":"Legacy";return this.uploadMedia=this["_uploadMedia"+b],this.uploadMedia(a)}}),p=m.extend({events:{"click [data-action=detach]":"onDetach"},initialize:function(){this.urls=this.options.urls;var a=this.options.mediaStorageKey;this.mediaStore=a&&new n(a),this.collection=new c.Collection,this.mediaStore&&this.collection.reset(b.values(this.mediaStore.getItems())),this.listenTo(this.collection,{add:this.onAdd,remove:this.onRemove,reset:this.onReset})},setElement:function(){var a=m.prototype.setElement.apply(this,arguments);return this.collection&&this.collection.each(this._addElement,this),a},hasVisible:function(){return!!this.collection.length},onDetach:function(b){b.stop();var c=a(b.target).closest("li"),d=c.attr("data-media-id"),e=this.collection.where({location:d});this.collection.remove(e,{$el:c})},_addElement:function(b){var c=a(i.render("legacyMediaUpload",b.toJSON()));c.attr("data-media-id",b.get("location")),this.updateDom(function(){this.$el.append(c)},this)},onAdd:function(a){this.mediaStore&&this.mediaStore.setItem(a.get("location"),a),this._addElement(a)},onRemove:function(a,b,c){c.$el&&this.updateDom(function(){c.$el.remove()});var d=this.mediaStore&&this.mediaStore.getItem(a.get("location"));if(d){var e={media:JSON.stringify(d)};this.parent&&(e.id=this.parent.id);var f=new Image;f.src=j.serialize(this.urls.remove,e,!0),this.mediaStore.removeItem(d.location)}},onReset:function(){this.updateDom(function(){this.$el.empty()},this),this.mediaStore&&this.mediaStore.clear()}}),q=m.extend({initialize:function(){this._urlsCache={},this.collection=new c.Collection([],{model:g.RichMedia,comparator:function(a){return a.get("index")}}),this.listenTo(this.collection,{add:this.onAdd,"change:id change:beingEdited":this.onAdd,remove:this.onRemove,reset:this.onReset,sort:this.onSort})},hasVisible:function(){return this.collection.any(function(a){return a.$el})},onAdd:function(c,d,e){if(!c.get("thumbnailUrl"))return!1;if(b.contains(g.Media.WEBPAGE_TYPES,c.get("mediaType")))return!1;if(!e.force){if(c.$el)return;if(c.get("beingEdited")&&!e.isPasteEvent)return}var f=a(i.render("mediaUpload",{media:c.toJSON(),backupUrl:e.backupUrl}));c.$el=f,this.updateDom(function(){this.$el.append(f)},this)},onRemove:function(a){a.$el&&this.updateDom(function(){a.$el.remove(),a.$el=null})},onReset:function(a,c){b.each(c.previousModels,this.onRemove,this),a.each(function(d){this.onAdd(d,a,b.extend(c,{force:!0}))},this)},onSort:function(a){var b=a.chain().filter(function(a){return!!a.$el}).pluck("$el").value();this.$el.empty(),this.$el.append(b)},addMedia:function(a,c){var d=this,f=a.url,h=d._urlsCache[f];return h?(h.set(a,c),c=b.extend({merge:!0,sort:!1,backupUrl:f},c),d.collection.add(h,c),d.collection.sort(),void 0):((!a.beingEdited||c.isPasteEvent)&&(h=new g.RichMedia(a),d.collection.add(h,b.extend({merge:!0,backupUrl:f},c)),d._urlsCache[f]=h,(!h.get("beingEdited")||c.isPasteEvent)&&e.call("media/details.json",{method:"POST",data:{url:f},success:function(a){d._urlsCache[f].set(a.response,b.extend({backupUrl:f,sort:!1},c)),d.collection.sort()}})),void 0)},updateFromText:function(a,c,d){if(!a)return void this.collection.reset();var e=f.bleachFindUrls(a);e=b.uniq(e,!1,function(a){return a.url});var g={};b.each(e,function(e){g[e.url]=!0,e.beingEdited=e.index<c&&c<=e.endIndex||"."===a[e.endIndex],this.addMedia(e,b.extend({backupUrl:e.url},d))},this);var h=this.collection.pluck("url");g=b.keys(g);var i=b.difference(h,g);this.collection.remove(this.collection.filter(function(a){return b.contains(i,a.get("url"))}))}}),r=m.extend({initialize:function(){var a=this.options;this.parent=a.parent,this.legacyView=new p({mediaStorageKey:a.mediaStorageKey,urls:a.urls,parent:this.parent}),this.legacy=this.legacyView.collection,this.richView=new q({}),this.rich=this.richView.collection,this.listenTo(this.legacy,"all",this._updateEmpty),this.listenTo(this.rich,"all",this._updateEmpty)},setElement:function(){var a=m.prototype.setElement.apply(this,arguments);return this.legacyView&&(this.legacyView.setElement(this.$el.find("[data-role=media-legacy-list]")[0]),this.richView.setElement(this.$el.find("[data-role=media-rich-list]")[0]),this.rich.reset()),a},clear:function(){this.legacy.reset(),this.rich.reset()},_updateEmpty:function(){this.updateDom(function(){this.legacyView.hasVisible()||this.richView.hasVisible()?this.$el.removeClass("empty"):this.$el.addClass("empty")},this)}});return{MediaStore:n,MediaUploaderView:o,MediaUploadsLegacySubView:p,MediaUploadsRichSubView:q,MediaUploadsView:r}}),define("lounge/views/cards",["jquery","underscore","backbone","lounge/common","lounge/mixins","common/utils","common/collections","common/templates","common/bus","common/urls","common/views/mixins"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=f.preventDefaultHandler,m=d.LoungeSubView.extend({events:{mouseenter:"enter",mouseleave:"leave"},initialize:function(){this._id=b.uniqueId(),this._rendered=!1,this._hoverState="out",this._visible=!1,this._enterTimeout=null,this._leaveTimeout=null,m.open={},this.events=this.events||{},this.events["click [data-action=profile]"]="handleShowProfile",this.listenTo(this,"authenticating",this.keepOpen)},render:function(){this.hide(),a("body").append(this.el)},target:function(a){a.on("mouseenter",b.bind(this.enter,this,a)),a.on("mouseleave",b.bind(this.leave,this))},enter:function(a){var c=this;a&&(c.$target=a),c._leaveTimeout&&clearTimeout(c._leaveTimeout),"in"!==c._hoverState&&(c._hoverState="in",c._enterTimeout=b.delay(function(){"in"===c._hoverState&&c.show(),c._enterTimeout=null},m.DELAY_ENTER),m.open[this.uid]=this)},leave:function(){var a=this;a._enterTimeout&&clearTimeout(a._enterTimeout),"out"!==a._hoverState&&(a._hoverState="out",a._leaveTimeout=b.delay(function(){"out"===a._hoverState&&a.hide(),a._leaveTimeout=null},m.DELAY_LEAVE),m.open[this.uid]&&delete m.open[this.uid])},show:function(){var a=this;a._rendered||(a._rendered=!0,a.render()),a.moveTo(a.$target),a.$el.show(),a._visible=!0},moveTo:function(a){if(a){var b=m.POSITION_OFFSET,c=a.offset(),e=this.$el,f=e.dim(),g=d.getLounge().getPosition();c.top-=b,c.top+f.height+g.frameOffset.top<=g.pageOffset+g.height?e.css("top",c.top):e.css("top",c.top-f.height+2*b),e.css("left",c.left+b)}},hide:function(){this._keepOpen||(this.$el.hide(),this._visible=!1)},keepOpen:function(){this._keepOpen=!0,this.setupKeepOpenCanceler()},setupKeepOpenCanceler:function(){var c=this,d=function(){"out"===c._hoverState&&(c.stopListening(i,"window.click",d),a("body").off("click",d),c._keepOpen=!1,c.hide())};b.delay(function(){c.listenTo(i,"window.click",d),a("body").on("click",d)},100)},isVisible:function(){return this._visible},handleShowProfile:l(function(b){var c=a(b.currentTarget).attr("data-user");d.getLounge().showProfile(c),this.hide()})},{open:{},instances:{},DELAY_ENTER:350,DELAY_LEAVE:175,POSITION_OFFSET:20,exitAll:function(){b.invoke(m.open,"leave")},create:function(a,b,c,d){var e=m.instances[c];e||(m.instances[c]=e={});var f=e[a];return f||(f=new d(b),e[a]=f),b.targetElement&&f.target(b.targetElement),f}});!function(){a(document).on("mouseout",b.debounce(function(a){var b=a.relatedTarget||a.toElement;b&&"HTML"!==b.nodeName||m.exitAll()},10))}();var n=m.extend({className:"tooltip-outer",events:b.defaults({"click [data-action=toggleFollow]":"toggleFollow"},m.prototype.events),initialize:function(a){var c=this;m.prototype.initialize.call(c,a),c.session=a.session,c.user=a.user,c._fetched=!1,c.listenTo(c.user,{"change:numPosts change:numLikesReceived":b.debounce(function(){c.updateCounters()}),"change:isFollowing":c.updateActions}),c.listenTo(c.session,"change:id",function(){this._rendered&&this.render()})},serialize:function(){return{user:this.user.toJSON({session:this.session}),showFollowButton:this.user.has("isFollowing")||this.session.isAnonymous()}},render:function(){this.$el.html(h.render("hovercard",this.serialize())),m.prototype.render.call(this)},updateCounters:function(){this.$el.find("[data-role=counters]").html(h.render("hovercardCounters",this.serialize()))},updateActions:function(){this.$el.find("[data-role=actions]").html(h.render("hovercardActions",this.serialize()))},show:function(){this._fetched||(this._fetched=!0,this.user.fetch()),m.prototype.show.call(this)}},{create:function(a){var b=a.user;return m.create(b.id,a,"ProfileCard",n)}});b.extend(n.prototype,e.FollowButtonMixin);var o=m.extend({className:"context-card tooltip-outer",initialize:function(a){var b=this;m.prototype.initialize.call(b,a),b.post=a.post},render:function(){var a=this.post.toJSON();a.excerpt=b.truncate(b.escape(b.strip(a.message),40,"...")),this.$el.html(h.render("contextCard",{post:a})),m.prototype.render.call(this)}},{create:function(a){var b=a.post;return m.create(b.id,a,"ContextCard",o)}}),p=m.extend({className:"tooltip-outer upvoters-outer",initialize:function(a){var b=this;m.prototype.initialize.call(b,a),b._fetched=!1,b._loading=!1,b._rendered=!1;var c=a.model;b.model=c,b.session=a.session,b.likes=c.get("likes"),b.hadLikes=!!b.likes,b.users=new g.UpvotersUserCollection([],{postId:c.get("id"),threadId:c.get("thread")}),b.listenTo(b.users,"reset",b.show),b.listenTo(b.model,"change:userScore",b.updateUserSet)},updateUserSet:function(){var a=this.session.user,b=this.likes,c=!1;if(this.likes=this.model.get("likes"),this.model.get("userScore")>0)if(this.session.isAnonymous()||this.users.add(a),this.likes&&!b)this._rendered=!1,this.show();else{var d=this.likes-1-this.users.length;c=this.session.isAnonymous()?!!d:!0,this.addUser()
}else this.users.remove(a),this.removeUser(),this.likes||this.hide();this.moveTo(this.$target,c)},addUser:function(){var a=this,c=a.session.user;a.session.isAnonymous()?a.updateGuestVotes():a.$listEl&&a.$listEl.length&&(a.$listEl.prepend(h.render("upvoter",b.extend({highlight:!0},c.toJSON()))),a.stopHighlightUsername())},removeUser:function(){var a=this,b=a.session.user;if(a.session.isAnonymous())a.updateGuestVotes();else{var c=a.$el.find("[data-user="+b.get("id")+"]");c.length&&c.remove()}},stopHighlightUsername:b.debounce(function(){var a=this.$el.find(".highlight");a.removeClass("highlight")},1100),updateGuestVotes:function(){var a=this,b=a.$el.find("[data-role=guest]"),c={guestCount:this.likes-this.users.length,guestAvatarUrl:j.avatar.generic,highlight:b.length,users:{length:a.users.length}},d=h.render("guestUpvoter",c);b.length?(b.replaceWith(d),a.stopHighlightUsername()):a.$listEl&&a.$listEl.length&&a.$listEl.append(d)},render:function(){delete this.pointEl,this.$el.html(h.render("upvoters",{users:this.users.toJSON(),guestCount:this.likes-this.users.length,guestAvatarUrl:j.avatar.generic,isLoading:this._loading,highlight:!1})),m.prototype.render.call(this),this.$listEl=this.$el.find(".upvoters ul")},show:function(){var a=d.getLounge(),b=this;if(b.likes&&!b.isVisible()&&(b.hadLikes||(b._fetched=!0,b._loading=!1),b._fetched?b._loading&&(b._rendered=!1,b._loading=!1,b.hide()):(b.users.fetch({reset:!0}),b._fetched=!0,b._loading=!0),b._fetched&&!b._loading)){var c=this.session.user;this.model.get("userScore")>0&&!this.session.isAnonymous()&&!this.users.contains(c)&&this.users.add(c),m.prototype.show.call(this),this.scrollMeasure&&this.scrollMeasure.dim().height>this.$el.dim().height&&this.$el.addClass("has-scroll"),a.trigger("uiAction:upvotersCardShow")}},showPoint:function(a){var c=["tl","bl"];this.pointEl||(this.pointEl=this.$el.find(".tooltip-point"),this.pointEl.removeClass("hidden")),b.each(c,function(a){this.pointEl.removeClass("point-position-"+a)},this),this.pointEl.addClass("point-position-"+a)},moveTo:function(a,b){if(a){var c=m.POSITION_OFFSET,e=a.offset(),f=this.$el,g=f.dim(),h=d.getLounge().getPosition(),i=h.frameOffset.height;b&&(g.height+=f.find("li.user").dim().height+10),e.top-g.height-c>=0&&e.top-g.height+h.frameOffset.top>=h.pageOffset?(f.css({bottom:i-e.top+c,top:"inherit"}),this.showPoint("bl")):(f.css({bottom:"inherit",top:e.top+2*c}),this.showPoint("tl")),f.css("left",e.left-c)}},handleShowProfile:l(function(a){m.prototype.handleShowProfile.call(this,a),d.getLounge().trigger("uiAction:showProfileFromUpvotes")})},{create:function(a){return m.create(a.postId,a,"UpvotersCard",p)}});return f.mixin(p,k.LocalScroll,{scrollMeasureSelector:"[data-role=content]"}),{HoverCard:m,ProfileCard:n,ContextCard:o,UpvotersCard:p}}),define("lounge/views/community",["underscore","backbone","moment","when","common/time","common/templates","common/collections","lounge/common","lounge/mixins"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=h.LoungeSubView,k=j.extend({tagName:"ol",className:"loading",initialize:function(){this.listenTo(this.collection,"reset",this.render)},render:function(){return this.updateDom(function(){this.$el.removeClass("loading"),this.$el.empty(),this.collection.each(function(a){var b=e.assureTzOffset(a.get("createdAt")),d=f.render("topThread",{id:a.id,title:a.get("title"),url:a.get("link"),numPosts:a.get("posts"),numLikes:a.get("likes"),timeAgo:c(b,e.ISO_8601).fromNow()});this.$el.append(d)},this),this.trigger("render")},this),this.attachPosts(),this},attachPosts:function(){this.collection.each(function(a){this.renderPost(a)},this)},renderPost:function(b){var c=b.get("topPost");if(c){var d=a.escape(a.strip(c.message));d=a.truncate(d,160,"&hellip;");var e=f.render("topThreadPost",{message:d,author:c.author});this.updateDom(function(){this.$el.find("[data-role=thread-"+b.id+"] [data-role=top-thread-post]").html(e)},this)}}}),l=j.extend({tagName:"ol",className:"loading",events:{"click [data-action=toggleFollow]":"toggleFollow"},initialize:function(){this.listenTo(this.collection,"reset",function(){h.getLounge().thread.users.add(this.collection.models,{merge:!0}),this.render()}),this.listenTo(this.collection,"change:isFollowing",this.render),this.listenTo(this,"render",this.manageHeight),this.session=h.getLounge().session,this.listenTo(this.session,"change:id",this.render),this.profileRowHeight=75},render:function(){return this.updateDom(function(){this.$el.removeClass("loading"),this.$el.empty(),this.collection.each(function(a){if(!a.get("isPrivate")){var b=f.render("topUser",{sessionId:this.session.user.id,buttonAsLink:!0,user:a.toJSON({session:this.session})});this.$el.append(b)}},this),this.trigger("render")},this),this},manageHeight:function(){this.el.scrollHeight-this.collapsedHeight>=this.profileRowHeight&&this.collapse()}});a.extend(l.prototype,i.FollowButtonMixin),i.asCollapsible.call(l.prototype,{collapsedHeight:297});var m=b.View.extend({initialize:function(a){var b=this;b.forum=a.forum,b.session=a.session,b.topThreads=new k({id:"top-threads",collection:new g.TopThreadCollection(null,{forum:b.forum.id,limit:10})}),b.topUsers=new l({id:"top-users",collection:new g.TopUserCollection(null,{forum:b.forum.id,limit:20})});var c=d.defer(),e=d.defer();b.topUsers.once("render",c.resolver.resolve),b.topThreads.once("render",e.resolver.resolve),d.join(c.promise,e.promise).then(function(){b.isRendered=!0,b.trigger("render:all")}),b.fetched=!1,b.render()},render:function(){return this.$el.html(f.render("community",{forum:this.forum.toJSON()})),this.$el.find("[data-role=top-threads]").append(this.topThreads.el),this.$el.find("[data-role=top-users]").prepend(this.topUsers.el),this},show:function(){this.fetched||(this.topThreads.collection.fetch({reset:!0}),this.topUsers.collection.fetch({reset:!0}),this.fetched=!0)}});return{CommunityView:m,TopThreadCollectionView:k,TopUserCollectionView:l}}),define("lounge/views/dashboard",["jquery","underscore","backbone","common/models","common/collections","common/utils","common/templates","lounge/common"],function(a,b,c,d,e,f,g,h){"use strict";var i=h.LoungeSubView,j=f.preventDefaultHandler,k=i.extend({events:{"click [data-action=more]":j(function(){this.trigger("fire")})},setBusy:function(){this.$el.find("[data-action=more]").addClass("busy").removeAttr("disabled")},setReady:function(){this.$el.find("[data-action=more]").removeClass("busy").removeAttr("disabled"),this.updateDom(function(){var a=this.collection.cursor,b=a&&a.hasNext;b?this.$el.show():this.$el.hide()},this)}}),l=i.extend({initialize:function(a){this.notifications=a.notifications,this.listenTo(this.notifications,{reset:this.resetNotifications,"add:many":this.addNotifications,"reset add:many":this.markNotificationsAsRead}),this._fetched=!1,this.moreButton=new k({collection:this.notifications}),this.listenTo(this.moreButton,"fire",this.loadMore)},render:function(){return this.renderLayout()},renderLayout:function(){return this.updateDom(function(){this.$el.html(g.render("notifications")),this.moreButton.setElement(this.$el.find("[data-role=more-notifications]")),this.$el.addClass("loading")},this),this},resetNotifications:function(a){var b=this.$el.find("[data-role=no-notifications]");b.hide(),this.$el.removeClass("loading"),0===a.size()?b.show():(b.hide(),this.addNotifications.apply(this,arguments))},addNotifications:b.decorate(c.collectionAddNormalizer(e.NotificationCollection,d.Notification),function(c){var d=b.map(c,function(b){var c=a(g.render("notification",{notification:b.toJSON()}));return c[0]});return this.updateDom(function(){this.$el.find("[data-role=entries]").append(d)},this),this.moreButton.setReady(),this.notifications.markRead(),this}),show:function(){this._fetched||(this.notifications.fetch({reset:!0}),this._fetched=!0)},loadMore:function(){this.moreButton.setBusy(),this.notifications.more()}}),m=i.extend({initialize:function(){this.posts=new e.PostActivityCollection,this.listenTo(this.posts,{reset:this.resetActivity,"add:many":this.addActivity}),this._fetched=!1,this.moreButton=new k({collection:this.posts}),this.listenTo(this.moreButton,"fire",this.loadMore)},render:function(){return this.renderLayout()},renderLayout:function(){return this.updateDom(function(){this.$el.html(g.render("networkActivity")),this.moreButton.setElement(this.$el.find("[data-role=more-activity]")),this.$el.addClass("loading")},this),this},resetActivity:function(a){var b=this.$el.find("[data-role=no-activity]");b.hide(),this.$el.removeClass("loading"),0===a.size()?b.show():(b.hide(),this.addActivity.apply(this,arguments))},addActivity:b.decorate(c.collectionAddNormalizer(e.PostActivityCollection,d.Post),function(e){var f=new c.Collection;b.each(e,function(a){var c=f.get(a.get("thread").id)||new d.Thread(b.extend(a.get("thread"),{forum:a.get("forum")}));c.posts.add(a),f.add(c)});var h=f.map(function(b){var c=a(g.render("networkActivityThreadEntry",{thread:b.toJSON()})),d=b.posts.map(function(b){return a(g.render("networkActivityPostEntry",{post:b.toJSON()}))[0]});return c.find("[data-role=posts]").append(d),c[0]});return this.updateDom(function(){this.$el.find("[data-role=entries]").append(h),this.trigger("render:activity")},this),this.moreButton.setReady(),this}),show:function(){this._fetched||(this.posts.fetch({reset:!0}),this._fetched=!0)},loadMore:function(){this.moreButton.setBusy(),this.posts.more()}}),n=i.extend({events:{"click [data-action=network]":"showNetwork","click [data-action=notifications]":"showNotifications"},initialize:function(a){var c=this;c.network=new m,c.notifications=new l({notifications:a.session.notifications}),c.notificationCount=new h.NotificationCountView({session:a.session,showZero:!0}),c._views={network:c.network,notifications:c.notifications},c.listenTo(c.network,"render:activity",b.bind(c.trigger,c,"render:all"))},render:function(){this.updateDom(function(){this.$el.html(g.render("dashboard"))},this),this._tabs={network:this.$el.find("[data-role=network-tab]"),notifications:this.$el.find("[data-role=notifications-tab]")},this.network.setElement(this.$el.find("[data-role=network]")),this.notifications.setElement(this.$el.find("[data-role=notifications]")),this.notificationCount.setElement(this.$el.find("[data-role=notification-count]")),this.network.render(),this.notifications.render(),this.notificationCount.render()},show:function(){this.setActiveTab("notifications")},setActiveTab:function(a){var c=h.getLounge();c.freeze(!0),b.chain(this._tabs).invoke("removeClass","active"),this._tabs[a].addClass("active"),b.chain(this._views).pluck("$el").invoke("hide");var d=this._views[a];this.updateDom(function(){d.$el.show(),c.freeze(!1)},this),d.show&&d.show()},showNetwork:j(function(){this.setActiveTab("network"),h.getLounge().trigger("uiAction:navigate","network")}),showNotifications:j(function(){this.setActiveTab("notifications"),h.getLounge().trigger("uiAction:navigate","dashboard")})});return{DashboardView:n,PaginateButtonView:k,NetworkActivityCollectionView:m,NotificationCollectionView:l}}),define("lounge/views/highlighted-post",["underscore","jquery","common/bus","common/config","common/utils","common/jester","common/models","common/templates","common/views/mixins","lounge/common","lounge/views/post"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=e.preventDefaultHandler,m=j.LoungeSubView.extend({initialize:function(b){a.extend(this,a.pick(b,["thread","session","switches"])),this.listenTo(this.thread,"change:highlightedPost",this.render)},template:"highlightedPost",itemViewContainer:".post-list",getPost:function(){var a=this.getHighlightedPost();return a||(a=this.getSponsoredPost()),a},getHighlightedPost:function(){var a=this.thread.get("highlightedPost");if(a&&(a instanceof g.Post||(a=new g.UniqueModel(g.Post,a)),!a.get("isDeleted")&&a.get("isHighlighted")))return a},getSponsoredPost:function(){var b,c=a.find(n,function(a,c){return b=c+"_ad",this.switches.enabled(b)},this);if(c){var e=c.postData;return e.message=h.render(c.messageTemplate),e=new g.Post(e),Math.random()<d.lounge.makerstudios_ad_sample_fraction?e:this.switches.enabled(b+"_force")?e:void 0}},render:function(){var b=this.getPost();if(!b)return this.$el.hide(),this;var c=b.getParent();c&&!c.author&&g.Post.fetchContext(c.id,this.thread).done(a.bind(this.render,this));var d=b.get("isSponsored")?o:k,e=new d({model:b,thread:this.thread,session:this.session,excludeAnchor:!0}).stopListening(b.usersTyping).render();return e.$el.addClass("highlighted"),this.updateDom(function(){this.$el.html(h.render(this.template)),this.$(this.itemViewContainer).append(e.el),this.$el.show()},this),this}}),n={makerstudios:{postData:{isSponsored:!0,author:{about:"Maker is a talent-first, technology driven media company and the #1 producer and distributor of online content reaching millennials in the U.S",badge:"Verified Account",id:"96525794",isAnonymous:!1,isPrimary:!0,isPrivate:!1,joinedAt:"2014-02-26T22:29:48",location:"LA",name:"Maker Studios",numFollowers:0,numFollowing:0,numLikesReceived:0,numPosts:0,profileUrl:"http://disqus.com/makerstudios/",rep:1.231755,reputation:1.231755,url:"http://www.makerstudios.com/?utm_source=disqus&utm_medium=test",username:"makerstudios",avatar:{small:{permalink:"http://disqus.com/api/users/avatars/makerstudios.jpg",cache:"//a.disquscdn.com/uploads/users/9652/5794/avatar32.jpg?1393453855"},isCustom:!1,permalink:"http://disqus.com/api/users/avatars/makerstudios.jpg",cache:"//a.disquscdn.com/uploads/users/9652/5794/avatar92.jpg?1393453855",large:{permalink:"http://disqus.com/api/users/avatars/makerstudios.jpg",cache:"//a.disquscdn.com/uploads/users/9652/5794/avatar92.jpg?1393453855"}}},id:"1272217209",message:""},messageTemplate:"makerstudiosad"}},o=k.extend({events:a.extend({},k.prototype.events,{"click [data-action=play-video]":l(function(a){var c=this.$("[data-role=video-container]");this.updateDom(function(){c.html(h.render(b(a.currentTarget).attr("data-template")))}),this.report("click")}),mouseenter:function(){this.report("hover")}}),initialize:function(){this.topEdgeOffset=null,this.listenTo(c,"window.scroll",this.checkVisibility),k.prototype.initialize.apply(this,arguments)},checkVisibility:function(a){this.invalidateOffset(),this.isVisible(a)&&(this.report("view"),this.stopListening(c,"window.scroll",this.checkVisibility))},report:function(a){f.client.emit({verb:a,object_type:"advertisement",object_id:"maker_studios_fantastic_four_video",zone:"sponsored_comment"})},render:function(){var a=k.prototype.render.apply(this,arguments);return this.$el.addClass("sponsored"),this.report("load"),a},initProfileCard:function(){}});return a.extend(o.prototype,i.IsVisibleViewMixin),{HighlightedPostView:m}}),define("lounge/views/log-visibility",["underscore","lounge/common","common/views/mixins","common/jester"],function(a,b,c,d){"use strict";var e=b.LoungeSubView.extend(a.extend({initialize:function(){this.listenTo(this,"viewport:enter",this.logEnter)},logEnter:function(){d.client.emit(this.options.params)}},c.IsVisibleViewMixin));return e}),define("lounge/views/media",["jquery","underscore","backbone","modernizr","common/utils","common/models","common/strings","common/urls","common/templates","common/views/mixins","common/corefuncs","lounge/common"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=g.get,n=e.preventDefaultHandler,o=l.LoungeSubView,p=300,q=function(a){var b=a.getItem("disqus.collapse-media");return b="true"===b?!0:"false"===b?!1:null,null===b&&(b=e.isMobile(window)?!0:!1),b},r=d.localstorage?window.localStorage:e.hashStorage,s=new c.Model({collapsed:q(r)}).on("change:collapsed",function(a,b){r.setItem("disqus.collapse-media",b)}),t={settings:s},u=function(a){if(!a)return"";a="http://"+a.replace(/^([a-z+.-]+:)?\/+/i,"");var b=document.createElement("a");b.href=a;var c=b.hostname.replace(/^www\d*\./i,"");return c=c.toLowerCase()},v=function(a,b,c,d){a[b.get(c)?"addClass":"removeClass"](d)},w=o.extend({tagName:"span",events:{"click [data-action=expand-collapse-media]":"handleToggle"},initialize:function(a){this.media=this.options.media;var b=a.$link;this.linkText=b.text(),this.linkHref=b.attr("href"),this.linkDomain=u(this.linkHref);var c=this.isUserText(b);this.hasGenericMessage=!1,c?this.mediaLinkText=this.linkText:this.media.get("title")?this.mediaLinkText=e.niceTruncate(this.media.get("title"),60):(this.hasGenericMessage=!0,this.mediaLinkText=this.model.get("providerExpandMessage")),this.listenTo(this.model,"change:deferred",this.render),this.listenTo(this.model,"change:activated",this.onChangeActivated)},isUserText:function(a){if("A"!==a[0].nodeName)return!1;var b=(a.text()||"").toLowerCase();if(!b)return!1;if(0===b.indexOf("http")||0===b.indexOf("www"))return!1;b=b.replace(/\.\.\.$/,"");var c=(a.attr("href")||"").toLowerCase();return c.indexOf(b)===-1},render:function(){var a=this.mediaLinkText;this.hasGenericMessage&&this.model.get("activated")&&(a=this.model.get("providerCollapseMessage")),this.updateDom(function(){this.$el.html(i.render("postMediaInlineLink",{model:this.model.toJSON(),text:this.linkText,href:this.linkHref,mediaLinkText:a,domain:this.linkDomain}))},this)},onChangeActivated:function(){this.hasGenericMessage&&this.render()},handleToggle:function(a){this.model.get("deferred")||(this.model.set("activated",!this.model.get("activated")),a&&a.preventDefault&&a.preventDefault())}}),x=c.Model.extend({defaults:{deferred:!0,showButtons:!0,activated:!1,kind:"image",postId:"",deferredHeight:0,providerExpandMessage:"",providerCollapseMessage:"",providerIcon:"icon-proceed"}}),y=o.extend(b.defaults({events:{"click [data-action=expand]":"handleExpand","click [data-action=contract]":"handleContract","click [data-action=force-load]":"handleForceLoad"},initialize:function(){this.media=this.options.media,this.$linkEl=null,this.setupMode(),this.listenTo(this.model,"change:activated",this.applyState),this.listenTo(this.model,"change:deferredHeight",this.onChangeDeferredHeight),this.listenTo(this.model,"change:showButtons",this.updateElementClass),this.listenTo(this.model,"change:deferred",this.render),this.listenTo(t.settings,"change:collapsed",this.setupMode)},topEdgeOffset:function(){return-l.getLounge().getPosition().height},getMediaDimensions:function(){return{width:null,height:null}},getAvailableWidth:function(){return this.$el.parent().width()||l.getLounge().loadedThumbnailWidth},updateDeferredHeight:function(){this.model.set("deferredHeight",this.calculateDeferredHeight())},calculateDeferredHeight:function(){var a=this.getMediaDimensions(),b=a.width,c=a.height;if(!b||!c)return c;var d=this.getAvailableWidth(),e=d*c/b;return e},convertToButton:function(a){this.model.set("showButtons",!1),this.linkSubview&&this.linkSubview.remove(),this.linkSubview=new w({model:this.model,media:this.media,$link:a}),a.replaceWith(this.linkSubview.$el),this.linkSubview.render()},applyContentNodeHeight:function(a){this.contentNode.height(a||"auto")},shouldAutoplay:function(){return!this.model.get("deferred")},generateContentHtml:function(){return this.media.get("html")},createContentNode:function(b){return a(b)},insertContentNode:function(a){this.contentNode.html(a)},bindUpdateDomToLoadError:function(){var a=b.bind(function(){this.off("load error",a),this.updateDom()},this);this.on("load error",a)},prepareElementEvents:function(){},displayContent:function(){this.updateDom(function(){this.bindUpdateDomToLoadError(),this.updateDeferredHeight();var a=this.generateContentHtml(),b=this.createContentNode(a);this.prepareElementEvents(b),this.insertContentNode(b),this.applyContentNodeHeight(null)},this)},configureDeferred:function(){this.model.get("deferred")&&!this.model.get("activated")&&(this.once("viewport:enter",this.enterViewport),l.getLounge().trackDeferredView(this)),this.listenToOnce(l.getLounge().postsView,"render:end",this.updateDeferredHeight)},configureContentFromActivated:function(){this.updateDom(function(){this.model.get("activated")?this.displayContent():this.displayPlaceholder()},this)},displayPlaceholder:function(){this.contentNode.html(i.render("postMediaPlaceholder",{model:this.model.toJSON()}))},updateElementClass:function(){var a=this.$el,b=this.model;v(a,b,"deferred","media-mode-deferred"),v(a,b,"activated","media-activated"),v(a,b,"showButtons","media-show-buttons")},applyState:function(){this.configureDeferred(),this.configureContentFromActivated(),this.updateElementClass()},render:function(){this.$el.html(i.render("postMedia",{model:this.model.toJSON(),media:this.media.toJSON()})),this.contentNode=this.$el.find("[data-role=content-placeholder]"),this.applyState(),this.updateDom()},remove:function(){this.linkSubview&&this.linkSubview.remove(),o.prototype.remove.apply(this,arguments)},enterViewport:function(){this.model.get("deferred")&&this.model.set("activated",!0)},setupMode:function(){this.model.set("activated",!1);var a=t.settings.get("collapsed");a?this.model.set("deferred",!1):this.model.set("deferred",!0)},onChangeDeferredHeight:function(){this.model.get("deferred")&&!this.model.get("activated")&&this.applyContentNodeHeight(this.model.get("deferredHeight"))},handleExpand:n(function(){this.model.set("activated",!0)}),handleContract:n(function(){this.model.set("activated",!1)}),handleForceLoad:n(function(){this.model.get("deferred")&&this.model.set("activated",!0)})},j.IsVisibleViewMixin)),z=y.extend({getMediaDimensions:function(){return{width:this.media.get("htmlWidth"),height:this.media.get("htmlHeight")}},_findIframe:function(a){return a.is("iframe")?a:a.find("iframe")},configureContentFromActivated:function(){y.prototype.configureContentFromActivated.apply(this,arguments),this.model.get("activated")||this.$el.removeClass("media-loading")},createContentNode:function(){var a=y.prototype.createContentNode.apply(this,arguments);return a.attr({width:"100%",height:this.model.get("deferredHeight"),"data-post":this.model.get("postId")}),a},insertContentNode:function(a){this.loaderNode=this.$el.find("[data-role=content-loader]"),this.loaderHeight=this.model.get("deferredHeight")||p,this.loaderNode.height(this.loaderHeight),this.$el.addClass("media-loading"),y.prototype.insertContentNode.call(this,a)},prepareElementEvents:function(a){var c=this._findIframe(a);c.one("load",b.bind(this.finishLoad,this,c))},finishLoad:function(a){this.updateDom(function(){this.$el.removeClass("media-loading"),a.height(this.loaderHeight),this.trigger("load")},this)}}),A=z.extend({getMediaDimensions:function(){return{width:null,height:this.media.get("htmlHeight")}},createContentNode:function(){var a=z.prototype.createContentNode.apply(this,arguments),b=a.attr("src");return this.shouldAutoplay()&&b&&(b=k.serialize(b,{auto_play:!0}),a.attr("src",b)),a}}),B=z.extend({createContentNode:function(){var a=z.prototype.createContentNode.apply(this,arguments),b=a.attr("src");return this.shouldAutoplay()&&b&&(b=k.serialize(b,{autoplay:1}),a.attr("src",b)),a}}),C=y.extend({createContentNode:function(b){return a("<iframe>").attr({frameBorder:0,scrolling:"no",width:"100%",height:this.model.get("deferredHeight"),"data-post":this.model.get("postId"),"data-src":b,src:'javascript:window.frameElement.getAttribute("data-src");'})},insertContentNode:function(a){y.prototype.insertContentNode.apply(this,arguments);var b=this.model.get("deferredHeight")||p;a.height(b)}}),D=y.extend({insertContentNode:function(){y.prototype.insertContentNode.apply(this,arguments),this.finishLoad()},finishLoad:function(){var a=this,c=0,d=150,e=20,f=function(){a.updateDom(),++c,e>c?b.delay(f,d):a.trigger("load")};f()}}),E=D.extend({generateContentHtml:function(){var a=l.getLounge(),b=document.documentElement.lang;b=b&&b.substring(0,2);var c=this.media.get("url");return this.media.get("resolvedUrl").indexOf("/status")!==-1&&(c=this.media.get("resolvedUrl")),i.render("postMediaTwitterContent",{url:c,theme:a.config.colorScheme,linkColor:e.escapeColor(a.config.anchorColor),language:b})}}),F=y.extend({getMediaDimensions:function(){return{width:this.media.get("thumbnailWidth"),height:this.media.get("thumbnailHeight")}},getImageUrl:function(){return this.media.get("resolvedUrl")||this.media.get("url")||this.media.get("thumbnailUrl")},getImageThumbnailUrl:function(){var a=this.media.get("thumbnailUrl");return u(a)===u(h.media)&&(a=k.serialize(a,{w:l.getLounge().loadedThumbnailWidth,h:this.model.get("deferredHeight")})),a},generateContentHtml:function(){return i.render("postMediaImage",{model:this.model.toJSON(),media:this.media.toJSON(),thumbnailUrl:this.getImageThumbnailUrl(),imageUrl:this.getImageUrl(),postId:this.model.get("postId")})},prepareElementEvents:function(a){var b=this,c=a.find("img"),d=function(a){return function(){b.trigger(a),c.off(".richMediaView")}};c.on("load.richMediaView",d("load")),c.on("error.richMediaView",d("error"))},calculateDeferredHeight:function(){var a=y.prototype.calculateDeferredHeight.apply(this,arguments),b=this.getMediaDimensions().height;return Math.min(b,a)||null}}),G=F.extend({getImageThumbnailUrl:function(){return this.media.get("metadata").imageUrl||F.prototype.getImageThumbnailUrl.call(this)}}),H=z.extend({topEdgeOffset:function(){return 0},createContentNode:function(){var a=z.prototype.createContentNode.apply(this,arguments),b=a.attr("src");return this.shouldAutoplay()&&b&&(b=k.serialize(b,{audio:1}),a.attr("src",b)),a}}),I=function(a,c){var d={PLAY_HIDE:{kind:"html",providerExpandMessage:m("Play"),providerCollapseMessage:m("Hide")},VIEW_HIDE:{kind:"html",providerExpandMessage:m("View"),providerCollapseMessage:m("Hide")},VIEW_IMAGE:{kind:"image",providerIcon:"icon-images",providerExpandMessage:m("View"),providerCollapseMessage:m("Hide")}},e=function(a,c){return b.extend(d[a],{providerIcon:c})},g=null,h=null,i=f.Media.MEDIA_TYPES;switch(a.get("mediaType")){case i.IMAGE:case i.IMAGE_UPLOAD:g=d.VIEW_IMAGE;break;case i.FACEBOOK_PHOTO:h=G,g=d.VIEW_IMAGE;break;case i.VIMEO_VIDEO:case i.YOUTUBE_VIDEO:h=B,g=e("PLAY_HIDE","icon-video");break;case i.TWITTER_STATUS:h=E,g=e("VIEW_HIDE","icon-twitter");break;case i.VINE_VIDEO:h=H,g=e("PLAY_HIDE","icon-video");break;case i.FACEBOOK_VIDEO:g=e("VIEW_HIDE","icon-video");break;case i.SOUNDCLOUD_SOUND:h=A,g=e("PLAY_HIDE","icon-music");break;case i.GOOGLE_MAP:g=e("VIEW_HIDE","icon-map");break;default:return null}if(null===h)switch(g.kind){case"webpage":return null;case"html":h=z;break;case"image":h=F}var j=new x(b.extend(g,{postId:c})),k=new h({model:j,media:a,relatedPost:c});return k};return b.extend(t,{getCollapseDefault:q,getDomain:u,RichMediaLinkView:w,RichMediaViewModel:x,RichMediaView:y,IframeRichMediaView:z,SoundCloudRichMediaView:A,AutoplayVideoRichMediaView:B,SourcelessIframeRichMediaView:C,DynamicHeightRichMediaView:D,TwitterRichMediaView:E,ImageRichMediaView:F,FacebookPhotoRichMediaView:G,VineRichMediaView:H,instantiateRichMediaView:I})}),define("lounge/views/notification-menu",["common/templates","lounge/common"],function(a,b){"use strict";var c=b.LoungeSubView.extend({initialize:function(a){this.session=a.session},render:function(){var b=a.render("notificationMenu",{user:this.session.toJSON()});return this.updateDom(function(){this.$el.html(b)},this),this.applyReadState(),this},applyReadState:function(){var a=this.session.get("notificationCount")||0;a>0?this.$el.addClass("unread"):this.$el.removeClass("unread")}});return{NotificationMenuView:c}}),define("lounge/views/onboard-alert",["backbone","moment","common/config","common/collections","common/utils","common/templates","common/time"],function(a,b,c,d,e,f,g){"use strict";var h=a.View.extend({switches:new d.SwitchCollection(c.switches,{parse:!0}),events:{"click [data-action=close]":"handleClose"},initialize:function(a){this.session=a.session},render:function(){return this.session.isRegistered()&&this.shouldShow()&&(this.$el.html(f.render("onboard",{displayedSection:this.session.user.isEditable(this.session)?"complete-profile":"follow"})),this.trigger("uiAction:onboardAlertShow")),this},shouldShow:function(){var a=this.getCookie();return a?a===h.COOKIE_NEW_USER||a===h.COOKIE_POPUP:!1},shouldPopup:function(){var a=this.getCookie();return a?a===h.COOKIE_NEW_USER:!1},getCookie:function(){return e.cookies.read(h.COOKIE_NAME)},setInitialCookie:function(){this.joinedRecently(this.session.user)&&e.cookies.create(h.COOKIE_NAME,h.COOKIE_NEW_USER,{expiresIn:30*24*60*60*1e3})},setPopupCookie:function(){this.shouldPopup()&&e.cookies.create(h.COOKIE_NAME,h.COOKIE_POPUP,{expiresIn:30*24*60*60*1e3})},joinedRecently:function(a){var c=a.get("joinedAt");if(!c)return!1;var d=g.assureTzOffset(a.get("joinedAt"));return b().subtract(10,"seconds").isBefore(d)},eraseCookie:function(){e.cookies.erase(h.COOKIE_NAME)},handleClose:function(a){a.preventDefault(),this.remove(),this.trigger("uiAction:onboardAlertDismiss")},remove:function(){this.eraseCookie(),this.session=null,a.View.prototype.remove.call(this)}},{COOKIE_NAME:"disqus.onboarding",COOKIE_NEW_USER:"newUser",COOKIE_POPUP:"popup"});return{OnboardAlert:h}}),define("lounge/views/post",["jquery","underscore","backbone","common/strings","common/templates","common/urls","common/utils","lounge/common","lounge/mixins","lounge/views/cards","lounge/views/media","lounge/views/log-visibility"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=g.preventDefaultHandler,n=d.get,o=h.LoungeSubView.extend({tagName:"li",className:"post",actions:{upvote:m(function(){this.handleVote(1)}),downvote:m(function(){this.handleVote(-1)}),reply:"handleReply",flag:"handleFlag",edit:"handleEdit","delete":"handleDelete",spam:"handleSpam",blacklist:"handleBlacklist",highlight:"handleHighlight",unhighlight:"handleUnhighlight",collapse:"handleCollapse",reveal:"handleReveal","share:twitter":"_onShare","share:facebook":"_onShare","downvote-tooltip-link":"handleDownvoteTooltipLink"},events:{"click > [data-role=post-content] [data-action]":function(c){var d=this,e=a(c.currentTarget).attr("data-action"),f=d.actions[e];return f?(b.isFunction(f)?f:d[f]).call(d,c):void 0},"mouseout [data-action=downvote]":"handleDownvoteMouseout"},initialize:function(a){this.thread=a.thread,this.session=a.session,this.created=!!a.created,this.listenTo(this.model,{"change:isDeleted spam":this.removeAsDeleted,"change:message":this.stopLoading,"change:points":this.updateVotePoints,"change:userScore":this.updateActiveUserVote,"change:isFlaggedByUser":this.updateUserFlagged,"change:isHighlighted":function(a,b){this.$el.toggleClass("highlighted",b),this.redraw()},change:function(){var a=this.model.changedAttributes();(a.id||a.message)&&this.redraw()}}),this.listenTo(this.model.usersTyping,"add remove reset change",this.updateTypingCount),this.listenTo(this.session,"change:id",function(){this.updateFooter(),this.updateMenu(),this.updateSessionClass()}),this.reply=null,this.edit=null,this.parent=a.parent,this.trackPosition=!1,this.offset={top:-1,height:-1},this.dim={height:-1,width:-1},this.listenTo(h.getLounge(),"domReflow",function(){if(!this.trackPosition||!this.visible)return this.offset={top:-1,height:-1},this.dim={height:-1,width:-1},void 0;var a=this.contentNode;this.offset=a.offset(),this.dim=a.dim()}),this.model.get("isHighlighted")&&this.$el.addClass("highlighted"),this.isCollapseAllowed=!0,this.haveSubscribedToRichMediaEvents=!1},createTypingUserView:function(){var a=this.$el.find("[data-role=realtime-notification\\:"+this.model.id+"] .realtime-replies");this.typingUserView=new(require("lounge/views/posts").TypingUserView)({parentView:this,model:this.model,el:a})},updateTypingCount:function(){this.typingUserView||this.createTypingUserView(),this.typingUserView.render()},stopLoading:function(){this.contentNode.find(".loading").removeClass("loading")},updateRelativeTime:function(){this.contentNode.find("[data-role=relative-time]").text(this.model.getRelativeCreatedAt())},handleDownvoteMouseout:function(){var a=h.getLounge();a.switches.enabled("hide_downvote_number")&&this.model.get("userScore")===-1&&this.contentNode.find("[data-role=downvote-tooltip]").removeClass("tooltip-disabled")},updateSessionClass:function(){var a="authored-by-session-user";
this.model.isAuthorSessionUser(this.session)?this.contentNode.addClass(a):this.contentNode.removeClass(a)},updateActiveUserVote:function(){var a=this.model,b=this.contentNode.find("[data-action=upvote]"),c=this.contentNode.find("[data-action=downvote]");c.removeClass("downvoted"),b.removeClass("upvoted"),a.get("userScore")>0?b.addClass("upvoted"):a.get("userScore")<0&&c.addClass("downvoted")},updateVotePoints:function(c){var d=this.contentNode.find("[data-role=likes], [data-role=dislikes]"),e=this.contentNode.find("[data-action=upvote], [data-action=downvote]"),f=function(a){b.delay(function(){a.addClass("update"),b.delay(function(){a.removeClass("update")},1e3)},500)};b.each(d,function(b,d){b=a(b);var g=b.html(),h=c.get(b.attr("data-role")).toString(),i=a(e[d]);g!==h&&(i.addClass("count-"+h),i.removeClass("count-"+g),b.html(h),f(b))})},updateFooter:function(){var a=this.contentNode.find("footer"),b=h.getLounge(),c=e.render("postFooter",{post:this.model.toJSON({session:this.session,thread:this.thread}),session:this.session.toJSON(),hideDownvoteNumber:b.switches.enabled("hide_downvote_number")});this.updateDom(function(){a.html(c),this.initUpvotersCard()},this)},updateMenu:function(){var a=this.contentNode.find("[data-role=menu]"),b=e.render("postMenu",{session:this.session.toJSON(),post:this.model.toJSON()});this.updateDom(function(){a.replaceWith(b)})},updateUserFlagged:function(){this.model.get("isFlaggedByUser")?this.contentNode.addClass("user-reported"):this.contentNode.removeClass("user-reported")},getMessageContent:function(){return this.messageContent&&this.messageContent.length||(this.messageContent=this.contentNode.find("[data-role=message-content]")),this.messageContent},manageMessageHeight:function(a){var b=this,c=b.getMessageContent(),d=1.5*b.collapsedHeight,e=c&&c.length&&c.height()||0;e+=a||0,e>d&&!b.$el.hasClass("collapsed")?b.collapse():b.expand(!0)},preventCollapsing:function(a){a.get("deferred")||(this.expand(),this.isCollapseAllowed=!1)},markSeen:function(){function a(e){var f,g;return e?c.dim.height<=0||c.dim.width<=0?!1:(f=c.offset.top+e.frameOffset.top,g=f>e.pageOffset,(g=g&&f+c.dim.height<=e.pageOffset+e.height)?(c.contentNode.addClass("seen"),b.delay(function(){c.contentNode.removeClass("seen"),c.contentNode.removeClass("new")},1e4),c.trackPosition=!1,c.stopListening(d,"scroll",a),!0):!1):!1}var c=this,d=h.getLounge();a(d.position)||c.listenTo(d,"scroll",a)},renderRichMedia:function(c,d){var e=this.$el.find("[data-role=message]"),f={};e.find("a").each(function(b,c){var d=c.href;f[d]||(f[d]=a(c))});var h=this.model.cid;this.richMediaViews=c.chain().map(function(a){return k.instantiateRichMediaView(a,h)}).without(null).map(function(b){this.listenTo(b.model,"change:activated",this.preventCollapsing),b.render();var c=b.media.get("url"),e=g.bleachFindUrls(c);e.length&&(c=e[0].url);var h=f[c];if(h){var i=o.getHighestAncestor(h);i.after(b.$el),b.convertToButton(h)}else a("<li>").append(b.$el).appendTo(d);return b},this).value(),!this.haveSubscribedToRichMediaEvents&&this.richMediaViews.length&&(this.listenTo(k.settings,"change:collapsed",function(a,c){if(c)this.manageMessageHeight();else{var d=b.reduce(this.richMediaViews,function(a,b){return a+(b.model.get("deferredHeight")||0)},0);this.manageMessageHeight(d)}}),this.haveSubscribedToRichMediaEvents=!0)},renderMedia:function(){var a=this.model.media;if(a&&a.length){var b=this.$el.find("[data-role=post-media-list]");this.renderRichMedia(a,b)}},getStateByline:function(){var a,b=this.model;return b.get("isHighlighted")?a={icon:"trophy",text:n("Featured by %(forum)s"),style:"default"}:b.get("isSponsored")?a={icon:"trophy",text:n("Sponsored on Disqus"),style:"default"}:b.isAuthorSessionUser(this.session)&&(b.get("isApproved")||(a={icon:"clock",text:n("Hold on, this is waiting to be approved by %(forum)s."),style:"default"})),a&&(a.text=d.interpolate(a.text,{forum:this.thread.forum.get("name")})),a},getTemplate:function(a){return a.isDeleted?"postDeleted":this.model.isAuthorSessionUser(this.session)&&!a.isApproved?"post":a.isMinimized?"postMinimized":"post"},render:function(){var a=this,b=a.$el,c=a.model.toJSON({session:this.session,thread:this.thread}),d=h.getLounge(),g=a.thread.forum.get("avatar"),i=a.model.getParent(),j=this.getTemplate(c);return b.html(e.render(j,{post:c,forumName:a.thread.forum.get("name"),session:a.session.toJSON(),thread:a.thread.toJSON(),loading:!a.model.id,created:a.created,parentPost:i&&i.toJSON(),thumbnailWidth:d.loadedThumbnailWidth,thumbnailHeight:d.MAX_MEDIA_HEIGHT,defaultAvatarUrl:g?g.large.cache:f.avatar.generic,hideDownvoteNumber:d.switches.enabled("hide_downvote_number"),stateByline:a.getStateByline()})),"postMinimized"===j||"postDeleted"===j?b.addClass("minimized"):b.removeClass("minimized"),!a.options.excludeAnchor&&a.model.id&&b.attr("id","post-"+a.model.id),a.contentNode=b.find("[data-role=post-content]"),a.childrenNode=b.find("[data-role=children]"),a.messageNode=a.contentNode.find("[data-role=message]"),a.highlightSyntax(),a.processMentions(),a.initCards(),a.renderMedia(),a.model.get("isRealtime")&&(a.trackPosition=!0,a.listenToOnce(d.postsView,"render:end",a.markSeen)),a.listenToOnce(d.postsView,"render:end",function(){a.markSeen(),a.manageMessageHeight()}),c.author&&c.author.badge&&this.attachBadgeViews(),a},attachBadgeViews:function(){var a=h.getLounge(),b={verb:"view",object_type:"verified_badge",object_id:this.model.author.id};this.$("[data-type=tracked-badge]").each(function(){var c=new l({el:this,params:b});a.trackDeferredView(c)})},highlightSyntax:function(){var a=this.contentNode.find("pre code");a.length&&a.each(function(){g.syntaxHighlighter.highlight(this)})},redraw:function(){var a=document.createDocumentFragment();this.childrenNode.children().appendTo(a),this.render(),this.updateDom(function(){this.childrenNode.append(a),h.getLounge().postsView.trigger("render:end")},this)},processMentions:function(){this.contentNode.find("[data-dsq-mention]").each(function(){a(this).addClass("mention")})},attachChild:function(a){var b=a.model;b.created||!b.id||b.get("isImmediateReply")?this.childrenNode.prepend(a.el):this.childrenNode.append(a.el)},toggleReply:function(){this.reply&&this.reply.isOpen()?this.hideReply():this.showReply(),this.contentNode.find("[data-role=reply-link]").toggleClass("active")},showReply:function(){this.reply?this.updateDom(function(){this.reply.prependTo(this.$el.find("[data-role=reply-form]")),this.reply.show(),this.reply.focus()},this):this.getReplyView()},hideReply:function(){this.reply&&this.updateDom(function(){this.reply.hide()},this)},toggleEdit:function(){return this.contentNode.find("[data-role=edit-link]").toggleClass("active"),this.edit?(this.edit.hide(),this.edit.remove(),this.edit=null,this.messageNode.show(),void 0):(this.showEdit(),void 0)},showEdit:function(){return this.session.isAnonymous()?(this.session.once("change:id",this.toggleEdit,this),void 0):(this.model.canBeEdited(this.session,this.thread)&&(this.edit||(this.edit=new(require("lounge/views/posts").PostEditView)({post:this.model,session:this.session}),this.edit.render(),this.listenTo(this.edit,"submitted cancel",this.toggleEdit),this.expand(!0),this.edit.show(),this.updateDom(function(){var a=this.messageNode;this.edit.prependTo(a.parent()),a.hide(),this.edit.resize();var b=h.getLounge();b&&b.scrollToPost(this.model.id)},this))),void 0)},removeAsDeleted:function(){this.redraw()},initCards:function(){var a=this;a.initProfileCard(),a.initContextCard(),a.initUpvotersCard()},initProfileCard:function(){if(!g.isPhone(window)){var a=this.$el.find(".hovercard");a.length&&(this.profileCard=j.ProfileCard.create({session:this.session,user:this.model.author,targetElement:a}))}},initContextCard:function(){if(!g.isPhone(window)){var a=this.parent&&this.parent.model;a&&!a.get("isDeleted")&&(this.contextCard=j.ContextCard.create({post:a,targetElement:this.$el.find("[data-role=parent-link]")}))}},initUpvotersCard:function(){if(!g.isPhone(window)){var a=this.$el.find("[data-action=upvote]");a.length&&(this.upvotersCard=j.UpvotersCard.create({session:this.session,model:this.model,postId:this.model.get("id"),targetElement:a}))}},_onShare:m(function(a){var b=g.extractService(a.target,"share");b&&(h.getLounge().trigger("uiAction:postShare",this.model,b),this.share(b))}),_shareUrl:function(){return this.thread.url()+"#comment-"+this.model.id},handleBlacklist:m(function(){if(!this.blacklist){var a=this.blacklist=new(require("lounge/views/posts").BlacklistView)({model:this.model});a.render(),this.listenTo(a,"success cancel",function(){this.blacklist.remove(),this.blacklist=null}),this.updateDom(function(){this.contentNode.find("[data-role=blacklist-form]").first().append(a.el)},this)}}),toggleCollapse:function(a){this.updateDom(function(){this.$el.toggleClass("collapsed",a)},this)},handleCollapse:m(function(){this.updateDom(function(){this.toggleCollapse()},this)}),handleHighlight:m(function(){this.model.highlight(),this.alert(e.render("highlightedSuccessMessage"),{safe:!0,type:"success"}),this.thread.set("highlightedPost",this.model);var a=h.getLounge();a&&a.scrollToPost(this.model.id,{padding:-90})}),handleUnhighlight:m(function(){this.model.unhighlight(),this.dismissAlert(),this.thread.unset("highlightedPost")}),handleVote:function(a){var b=h.getLounge(),c=this.model.get("userScore")===a;c?b.trigger("uiAction:postUnvote",this.model):1===a?b.trigger("uiAction:postUpvote",this.model):a===-1&&b.trigger("uiAction:postDownvote",this.model),this.model.vote(c?0:a)},remove:function(){this.model.off(null,null,this),this.session.off(null,null,this),c.View.prototype.remove.call(this)},getReplyView:function(){return this.reply?this.reply:(this.reply=new(require("lounge/views/posts").PostReplyView)({parentView:this,parent:this.model,thread:this.thread,session:this.options.session}),this.reply.render(),this.showReply(),this.reply)},handleDownvoteTooltipLink:function(a){a.stopPropagation()},handleReply:m(function(){this.toggleReply()}),handleFlag:m(function(){if(!this.model.get("isFlaggedByUser")){var a=n("Are you sure you want to flag this comment?");window.confirm(a)&&(this.model.report(),this.model.set("isFlaggedByUser",!0))}}),handleEdit:m(function(){this.toggleEdit()}),handleDelete:m(function(){this.model._delete()}),handleSpam:m(function(){this.model.spam()}),handleReveal:m(function(){this.model.set("isMinimized",!1),this.redraw()}),handleExpandMessage:m(function(){return this.expand()})},{getHighestAncestor:function(a){return a.closest("[data-role=message] > *")}});return b.extend(o.prototype,i.ShareMixin),b.extend(o.prototype,i.AlertMixin),i.asCollapsible.call(o.prototype,{collapsedHeight:374,collapseTargetSelector:"[data-role=message-container]",collapseScope:"contentNode"}),o}),define("lounge/views/posts",["require","jquery","underscore","backbone","md5","queuedstorage","editable","modernizr","common/api","common/defines","common/models","common/collections","common/utils","common/strings","common/bus","common/urls","common/templates","common/views/mixins","common/keys","lounge/views/media","lounge/mixins","lounge/views/uploads","lounge/views/cards","lounge/common"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";var y=n.get,z=m.preventDefaultHandler,A=x.LoungeSubView,B=350,C=function(){var a=5,b=h.localstorage?window.localStorage:m.hashStorage;return new f(b,a,"drafts.queue")}(),D=A.extend({tagName:"form",className:"reply",events:{"click input[name=author-guest]":"managePassword","click [data-action=cancel]":"hide",submit:"submitForm"},initialize:function(a){if(this.session=a.session,this.parent=a.parent,this.thread=a.thread,this.parentView=a.parentView,this.listenTo(this.session,{"change:id change:audienceSyncVerified":this.redraw}),this._isHidden=!1,this.parent&&(D.open[this.parent.cid]=this),this.thread.forum.get("settings").allowMedia){var b=this.storageKey("media"),d={add:this.thread.get("uploadAdd"),remove:this.thread.get("uploadRemove")};this.mediaUploads=new v.MediaUploadsView({mediaStorageKey:b,parent:this.parent,urls:d}),this.mediaUploader=new v.MediaUploaderView({parent:this.parent,urls:d}),this.listenTo(this.mediaUploader,{"uploader:alert":function(a,b,d){var e=this.alert(a,b);c.isFunction(d)&&this.listenToOnce(e,"dismiss",d)},"uploader:dragEnter":function(){this.$el.addClass("expanded")},"uploader:addMedia":c.bind(this.mediaUploads.legacy.add,this.mediaUploads.legacy)})}var e=c.throttle(this.updateLiveMedia,500),f=c.debounce(this.updateLiveMedia,1e3);this.updateLiveMediaRateLimited=this.canUseContentEditable?function(){e.apply(this,arguments),f.call(this,!0)}:function(){f.call(this,!0)}},storageKey:function(a){return this.thread.id?[a||"drafts","thread",this.thread.id,"parent",this.parent?this.parent.id:0].join(":"):null},updateLiveMedia:function(a){function b(){var b=d.textarea.get(),c=d.textarea.content&&d.textarea.content.selectedTextNodeOffset()||b.length;d.mediaUploads.richView.updateFromText(b,c,{isPasteEvent:a})}var d=this;d.mediaUploads&&(a?c.defer(b):b())},saveDraft:function(){null!==this.storageKey()&&C.setItem(this.storageKey(),JSON.stringify([this.textarea.get(),(new Date).getTime()]))},getDraft:function(){if(null===this.storageKey())return null;var a=C.getItem(this.storageKey());if(!a)return null;var b=JSON.parse(a);return b[1]+86400>(new Date).getTime()?b[0]:(C.removeItem(this.storageKey()),null)},restoreDraft:function(){var a=this.getDraft();a&&this.textarea.set(a)},updateAvatar:function(){this.$el.find("[data-role=user-avatar]").attr("src",this.session.user.get("avatar").cache)},expandGuestForm:function(){this.updateDom(function(){this.$el.find("[data-role=guest-details]").addClass("expanded")},this)},redraw:function(){var a=this.$el.hasClass("expanded"),c=this.el,d=this.$el.find("textarea").val();this.render(),this.$el.find("textarea").val(d),a&&this.$el.addClass("expanded"),0!==b(c).parent().length&&this.updateDom(function(){c.parentNode.replaceChild(this.el,c)},this)},getPlaceholderText:function(){return this.thread.get("posts")?y("Join the discussion…"):y("Start the discussion…")},render:function(){var a=this,b=a.$el,c=x.getLounge();return a.$el.html(q.render("form",{parent:a.parent?a.parent.toJSON():null,user:a.session.toJSON(),forumName:a.thread.forum.get("name"),audienceSyncRequired:a.session.needsAudienceSyncAuth(a.thread.forum),apiKey:c.config&&c.config.apiKey||"",allowAnonPost:a.thread.forum.get("settings").allowAnonPost,allowMedia:a.thread.forum.get("settings").allowMedia,sso:a.session.get("sso")})),a.parent?b.addClass("expanded"):b.removeClass("expanded"),a.session.user.id?b.addClass("authenticated"):b.removeClass("authenticated"),a.initTextarea(),a.mediaUploads&&(a.mediaUploads.setElement(b.find("[data-role=media-preview]")[0]),a.mediaUploader.setElement(b.find("[data-role=textarea]")[0])),b.find("input[name=author-name]").on("focus",function(){a.expandGuestForm()}),a.session.get("mustVerifyEmail")&&a._alertMustVerify(),a._isHidden&&b.addClass("hidden"),this},canUseContentEditable:function(){return h.contenteditable&&!j.browser.mobile&&!(window.opera&&window.opera.version)}(),initTextarea:function(){var a=this,b=a.getDraft()||"",d=this.canUseContentEditable?J:I,e=this.textarea=new d({value:b,placeholder:a.getPlaceholderText(),thread:this.thread});a.$("[data-role=textarea]").prepend(e.render().el),a.listenTo(e,{keychange:c.debounce(a.saveDraft,500),focus:function(){a.$el.addClass("expanded"),c.delay(c.bind(a.resize,a),200)}}),a.listenTo(e,{keychange:a.updateLiveMediaRateLimited,paste:function(b,c){c&&c.fake||a.updateLiveMedia(!0)}})},resize:function(){this.textarea.resize()},focus:function(){this.textarea.focus()},clear:function(){var a=this;a.textarea.clear(),a.$el.removeClass("expanded"),a.mediaUploads&&a.mediaUploads.clear(),c.delay(function(){a.resize()},200),a.parent?a.hide():a.setInactive(),this.storageKey()&&C.removeItem(this.storageKey())},setInactive:function(){this.$el.removeClass("expanded")},restore:function(a){var b=this;b.textarea.set(a.get("raw_message")),c.delay(function(){b.resize()},200),b.parent&&b.show()},managePassword:function(){var a=this.$el,b=a.find("input[name=author-guest]"),c=a.find("input[name=author-password]");c&&(this.updateDom(function(){c[b.is(":checked")?"hide":"show"]()}),c.val(""))},_alertMustVerify:function(a){var b=n.interpolate(y("%(forumName)s requires you to %(verifyEmail)s before posting"),{forumName:this.thread.forum.get("name"),verifyEmail:'<a href="#" data-action="verify-email">'+y("verify your email address")+"</a>"});this.alert(b,{safe:!0,type:a?"error":"warn"})},getPassword:function(){var a=this.$el.find("input[name=author-password]");return a.length?a.val():null},submitForm:z(function(){return this.dismissAlert(),this.shouldRegisterUser()?void this.registerUser():this.initiatePost()}),shouldRegisterUser:function(){return this.session.isAnonymous()&&!this.$el.find("input[name=author-guest]").is(":checked")},registerUser:function(){function a(a){var c=a.response;/The e-mail address you specified is already in use./i.test(c)?b.alert(y("The e-mail address you specified is already in use. (Do you already have an account?)"),"error"):/Unable to create user/i.test(c)?b.alert(y("That email address is already registered with a Disqus account. Log in or enter another email."),"alert"):b.alert(c,"error")}var b=this,c=new k.User({display_name:b.$el.find("input[name=author-name]").val(),email:b.$el.find("input[name=author-email]").val(),password:b.getPassword()});return c.isValid()?(c.register({error:a,success:function(){b.session._setUser(c),o.trigger("onboardAlert.show"),x.getLounge().trigger("uiAction:finishRegistrationEmbed")}}),void 0):a({response:c.validationError})},initiatePost:function(){var a=this,b={thread:a.thread.id,depth:a.parent?a.parent.get("depth")+1:0,parent:a.parent?a.parent.id:null,raw_message:a.textarea.get()};a.session.isRegistered()?b.author_id=a.session.user.id:c.extend(b,{author_name:a.$el.find("input[name=author-name]").val(),author_email:a.$el.find("input[name=author-email]").val()});var d=x.getLounge();d&&d.switches.enabled("before_comment_callback")?(o.sendHostMessage("posts.beforeCreate",{raw_message:b.raw_message}),this.listenToOnce(o,"posts.beforeCreate.response",function(a){a&&(b.raw_message=a),this.createPost(b)})):this.createPost(b)},createPost:function(a){var b=this,d=x.getLounge(),f=new k.UniqueModel(k.Post),g=f.set(a,{validate:!0});if(!g)return void b.alert(f.validationError,"error");var h=null,i=function(a,e){if(19===e.code){if(h)return h.reload();h=new F,h.render();var g=d.postsView.getPostView(f.cid);return g.el.parentNode.insertBefore(h.el,g.el),h.start(),this.listenTo(h,"submitted",function(){f.save({recaptcha_challenge_field:h.getChallenge(),recaptcha_response_field:h.getResponse()},{success:function(){h.remove()}})}),void 0}if(12===e.code&&/not have permission to post on this thread/.test(e.response)){var i=q.render("blacklistErrorMessage",{forumName:b.thread.forum.get("name")});b.alert(i,{type:"error",safe:!0})}else 12===e.code&&/verify/.test(e.response)?b._alertMustVerify(!0):c.isString(e.response)&&b.alert(e.response,"error");b.thread.posts.remove(f),b.restore(f),b.thread.incrementPostCount(-1)},j=function l(){b.thread.trigger("create",f),d.trigger("uiCallback:postCreated",f),b.stopListening(f,"error",i),b.stopListening(f,"sync",l)};return b.listenTo(f,{error:i,sync:j}),f.save(a),f.author=b.session.isRegistered()?b.session.user:new k.UniqueModel(k.User,{id:e(a.author_email),name:a.author_name,email:a.author_email}),b.thread.incrementPostCount(1),f.created=!0,b.thread.posts.add(f),b.clear(),d.trigger("uiAction:createPost",f),f},prependTo:function(a){a=a[0],a.insertBefore(this.el,a.firstChild)},remove:function(){this.updateDom(function(){this.$el.remove()},this),this.parent&&(delete D.open[this.parent.cid],this.typingStop()),d.View.prototype.remove.call(this)},toggle:function(){this.isOpen()?this.hide():this.show()},show:function(){var a=this;a._isHidden=!1,a.updateDom(function(){a.$el.removeClass("hidden")}),a.typingStart()},hide:function(){var a=this;a._isHidden=!0,a.dismissAlert(),a.updateDom(function(){a.$el.addClass("hidden")}),a.typingStop()},isOpen:function(){return!this._isHidden},syncTyping:function(a){this.typingUser&&(void 0!==a&&this.typingUser.set("typing",a),this.typingUser.sync())},typingStart:function(){var a=this.parent;if(a){var b=x.getLounge();b.isRealtimeEnabled()&&(this.typingUser||(this.typingUser=k.TypingUser.make({user:this.session.user.id,post:a.id,thread:this.thread.id,forum:this.thread.forum.id}),a.usersTyping.add(this.typingUser)),this.syncTyping(!0))}},typingStop:function(){this.syncTyping(!1)}});c.extend(D.prototype,u.AlertMixin),D.open=D.open||{};var E=A.extend({tagName:"form",className:"edit",events:{submit:"submitForm","click [data-action=cancel]":"cancel"},initialize:function(a){this.post=a.post,this.session=a.session},show:function(){},hide:function(){},cancel:function(){this.trigger("cancel")},render:function(){var a=this.post.toJSON();this.$el.html(q.render("edit",{post:a,user:this.session.toJSON()}));var b=this.textarea=new I({value:a.raw_message});this.$("[data-role=textarea]").prepend(b.render().el)},prependTo:function(a){a=a[0],a.insertBefore(this.el,a.firstChild)},resize:function(){this.textarea.resize()},submitForm:function(a){a&&a.preventDefault()&&a.preventDefault();var b=this,c={raw_message:this.textarea.get()},d=b.post.validate(c);return void 0!==d?alert(d):(b.trigger("submitted"),b.post.save(c,{success:function(){}}),void 0)},remove:function(){this.updateDom(function(){this.$el.remove()},this)}}),F=A.extend({tagName:"form",className:"hidden",events:{submit:function(a){a.preventDefault(),this.trigger("submitted")}},render:function(){return this.$el.html(q.render("captcha"))},start:function(){var b=this;a(["recaptcha"],function(a){b.Recaptcha=a,b.updateDom(function(){a.create(s.recaptcha,b.el,{theme:"custom",custom_theme_widget:"recaptcha_widget"}),b.$el.removeClass("hidden")})})},getChallenge:function(){return this.Recaptcha.get_challenge()},getResponse:function(){return this.Recaptcha.get_response()},reload:function(){this.Recaptcha.reload()}}),G=d.View.extend({render:function(){var a,b=this.options.parentView.reply,c=b&&b.typingUser,d=this.model.usersTyping.count(c&&c.id);return 0>=d?void this.$el.hide():(1===d?a=y("One other person is typing…"):(a=y("%(num)s other people are typing…"),a=n.interpolate(a,{num:d})),this.$el.text(a),this.$el.show(),void 0)}}),H=A.extend({tagName:"form",className:"moderate",events:{submit:function(a){a&&a.preventDefault()&&a.preventDefault(),this.submit()},"click [data-action=cancel]":"cancel"},initialize:function(){var a=this;a.loading=!1,a.model.get("ipAddress")||(a.loading=!0,a.listenToOnce(a.model,"change:ipAddress",function(){a.loading=!1,a.render(),a.updateDom()}),a.model.fetch())},render:function(){var a=this,b=a.$el;return b.html(q.render("blacklist",{post:a.model.toJSON()})),a.loading?b.addClass("loading"):b.removeClass("loading"),a},cancel:function(a){a&&a.preventDefault()&&a.preventDefault(),this.trigger("cancel")},submit:function(){var a={},b=this;b.$el.find("input").each(function(){this.checked&&(a[this.name]=this.value)}),c.isEmpty(a)||(a.forum=b.model.get("forum"),i.call("blacklists/add.json",{method:"POST",data:a,success:function(){b.trigger("success")}}))}}),I=A.extend({events:{"keyup    [data-role=editable]":"handleKeyUp","paste    [data-role=editable]":"handlePaste","focusin  [data-role=editable]":"handleFocusIn","resize   [data-role=editable]":"handleResize"},initialize:function(a){a=a||{},this.value=a.value,this.placeholder=a.placeholder,this.debouncedResize=c.debounce(c.bind(this.updateDom,this,function(){}),300)},render:function(){var a=this.$input=b("<textarea>").attr({"class":"textarea",placeholder:this.placeholder,"data-role":"editable"}).val(this.value).appendTo(this.el);return a.autoresize({maxHeight:B}),this},resize:function(){this.$input.trigger("paste",{fake:!0})},get:function(){return this.$input.val()},set:function(a){this.$input.val(a)},clear:function(){this.set("")},focus:function(){this.el.focus()},handleKeyUp:function(){this.trigger("keychange")},handlePaste:function(){this.trigger("paste keychange"),this.$input.trigger("resize")},handleFocusIn:function(){this.trigger("focus")},handleResize:function(){this.debouncedResize()}}),J=I.extend({events:function(){return c.extend({},I.prototype.events,{"keydown  [data-role=editable]":"handleKeyDown","focusout [data-role=editable]":"handleFocusOut","click .placeholder":"handlePlaceholderClick"})},initialize:function(a){I.prototype.initialize.call(this,a),a=a||{},this.thread=a.thread,this.mentionsCache=new l.UserCollection,this.suggestions=new K({thread:a.thread,mentions:this.mentionsCache}),this.listenTo(this.suggestions,"select",this.insertMention),this.reset(),this.$input=null},reset:function(){this.anchorNode=null,this.anchorOffset=null,this.anchorLength=0,this.suggestions.clear()},render:function(){var a=this.$input=b("<div>").attr({"class":"textarea",tabIndex:this.el.tabIndex,role:"textbox","aria-multiline":"true",contenteditable:"true","data-role":"editable"}).css({overflow:"auto","max-height":B+"px"}).appendTo(this.$el);this.$el.append(this.suggestions.el),this.content=new g(a[0],!0,{getHtmlElements:c.bind(this.getHtmlElements,this)}),this.set(this.value),this.suggestions.render();var d=this.placeholder;return d&&(a.attr("aria-label",d),this.$placeholder=b('<span class="placeholder">'+d+"</span>"),this.content.text()||this.setPlaceholder()),this},getHtmlElements:function(a){if(!a)return a;var b=[a],d=this.getMentionNodes(a);return c.each(d,function(a,d){for(var e=0;e<b.length;e++){var f,g=b[e],h=e;if(c.isString(g)){for(;(f=g.indexOf(d))>-1;)f>0&&b.splice(e++,0,g.substring(0,f)),b.splice(e++,0,a.cloneNode(!0)),g=g.substring(f+d.length);g&&g!==b[h]&&b.splice(e++,0,g),h!==e&&b.splice(e,1)}}}),b=c.map(b,function(a){return c.isString(a)?document.createTextNode(a):a})},getMentionNodes:function(a){var b=J.MENTIONS_RE_GROUPED,c={};b.lastIndex=0;for(var d=b.exec(a);d;){var e=d[1],f=this.thread.users.find(function(a){return a.get("username")===e});if(f){var g=J.getMentionDom(f),h=d[0];c[h]=g,this.updateCache(f,f.cid)}d=b.exec(a)}return c},setPlaceholder:function(){this.$el.prepend(this.$placeholder)},handleKeyDown:function(a){switch(a.keyCode){case 9:this.suggestions.active&&(this.suggestions.select(),a.preventDefault(),a.stopPropagation());break;case 10:case 13:case 38:case 40:this.suggestions.active&&(a.preventDefault(),a.stopPropagation())}},handleKeyUp:function(a){switch(I.prototype.handleKeyUp.call(this),a.preventDefault(),a.stopPropagation(),this.checkExistingMentions(),a.keyCode){case 50:if(!a.shiftKey)return;this.start(a);break;case 10:case 13:this.suggestions.select();break;case 27:this.reset(a);break;case 38:this.suggestions.move("up");break;case 40:this.suggestions.move("down");break;default:this.throttledSuggest(a)}},handlePlaceholderClick:function(){this.$input.focus()},handleFocusIn:function(){I.prototype.handleFocusIn.call(this),this.$placeholder.remove()},handleFocusOut:function(){""===this.content.text()&&this.setPlaceholder()},start:function(){this.reset(),this.suggest()},suggest:function(){var a=this.parseSearchTerms();this.suggestions.suggest(a)},throttledSuggest:c.throttle(function(){this.suggest()},250),insertMention:function(a){var b=this.thread.users.get(a);this.selectSearchString(b),this.updateCache(b,a);var d=J.getMentionDom(b);this.content.insertNode(d);var e=this.$el.find("span[data-cid]");c.each(e,function(a){a.contentEditable!==!1&&(a.contentEditable=!1)})},updateCache:function(a,b){this.mentionsCache.get(b)||this.mentionsCache.add(a)},selectSearchString:function(){this.content.selectNodeText(this.anchorNode,this.anchorOffset-1,this.anchorOffset+this.anchorLength)},get:function(){function a(a){return c(a,!0)?b.mentionToText(a):null}var b=this,c=J.isMention;return this.content.text(a)},set:function(a){this.content.setText(a),this.resize()},clear:function(){I.prototype.clear.call(this),this.setPlaceholder(),c.defer(function(a){a.updateDom(function(){a.$input.blur()})},this)},parseSearchTerms:function(){var a=this.content.selectedTextNode(),b=a?a.nodeValue:"",c=g.normalizeSpace;if(b){var d=this.content.selectedTextNodeOffset(a),e=g.normalizeSpace(b.slice(0,d).split("").reverse().join("")),f=e.indexOf("@");if(f===-1)return null;this.anchorNode=a,this.anchorOffset=d-f,this.anchorLength=f;var h=c(b.slice(this.anchorOffset-1,d)).match(J.MENTIONS_RE);return h?h[0].slice(1).split(" "):0===f?[""]:void 0}},checkExistingMentions:function(){var a=g.normalizeSpace,d=this.$el.find("span"),e=c.filter(d,J.isMention),f=this.mentionsCache,h={};c.each(e,function(d){var e=b(d).attr("data-cid"),g=c.reduce(this.content.getTextNodes(d),function(b,c){return b+a(c.nodeValue)},""),i=f.get(e);i&&i.get("name")!==g?(this.mentionsCache.remove(i),this.content.removeNode(d),this.content.insertHTML(" "),this.reset()):h[e]=d},this),f.each(function(a){h[a.cid]||f.remove(a)})},mentionToText:function(a){var c=b(a).attr("data-cid"),d=this.mentionsCache.get(c),e=a.innerText||a.textContent;return d&&d.get("username")&&(e=d.get("username")),["@",e,":","disqus"].join("")}},{MENTIONS_RE:new RegExp("@\\w+\\s?(?:\\w+\\s?){0,5}(?:\\w+)?$"),MENTIONS_RE_GROUPED:/@([\d\w]+)\s?(\:\s?(\w+))?/gi,isMention:function(a,c){var d;do{if(d=b(a),d.hasClass("mention")&&d.attr("data-cid"))return!0;a=a.parentElement}while(c&&a);return!1},getMentionDom:function(a){var b=document.createDocumentFragment(),c=document.createElement("span"),d=document.createElement("span"),e=document.createTextNode(a.get("name")||a.get("username"));return c.setAttribute("contenteditable",!0),d.setAttribute("contenteditable",!1),d.setAttribute("data-cid",a.cid),d.className="mention",d.appendChild(e),c.appendChild(d),b.appendChild(c),b.appendChild(document.createTextNode(" ")),b}}),K=d.View.extend({events:{"click li":"handleClick"},initialize:function(a){this.active=!1,this.thread=a.thread,this.mentionsCache=a.mentions,this.userHtmlCache={}},suggest:function(a){var b=this.findMatches(a);return b&&b.length?(this.renderUsers(b),this.active=!0,this.$el.show(),void 0):void this.clear()},render:function(){this.$el.html(q.render("suggestions")),this.active||this.$el.hide()},renderUsers:function(a){var d=c.reduce(a,function(a,c){var d=this.userHtmlCache[c.cid];return void 0===d&&(this.userHtmlCache[c.cid]=d=b(this.renderSingleUser(c))),a.appendChild(d[0]),a},document.createDocumentFragment(),this);this.$(".header").siblings().remove().end().after(d).siblings().removeClass("active").first().addClass("active")},renderSingleUser:function(a){var b=a.toJSON();return b.cid=a.cid,q.render("suggestedUser",b)},clear:function(){this.active=!1,this.$el.hide()},handleClick:function(a){var c=b(a.currentTarget);this.select(c.attr("data-cid"))},findMatches:function(a){if(a&&a.length){var b,c=new RegExp(a.join(" ").replace(/[^\w\s]/,""),"i"),d=K.MAX_SUGGESTIONS,e=this.thread.users,f=[],g=0,h=1===a.length&&""===a[0]?function(){return!0}:function(a){return c.test(a.get("name"))||c.test(b.get("username"))};for(g=0;g<e.models.length&&f.length<d;g++)b=e.models[g],b.get("isAnonymous")||this.mentionsCache.get(b.cid)||h(b)&&f.push(b);return f}},select:function(a){this.active&&(a||(a=this.$el.find(".active").attr("data-cid")),this.trigger("select",a),this.clear())},move:function(a){if(this.active){var b=this.$el.find(".active"),c="up"===a?"prev":"next",d=b[c]();d.length&&d.attr("data-cid")&&(b.removeClass("active"),d.addClass("active"))}}},{MAX_SUGGESTIONS:5});return{PostReplyView:D,PostEditView:E,TypingUserView:G,CaptchaView:F,BlacklistView:H,TextareaView:I,ContentEditableView:J,SuggestionView:K}}),define("lounge/views/posts/collection",["jquery","underscore","backbone","moment","common/bus","common/models","lounge/common","lounge/views/posts","lounge/views/post"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=g.LoungeSubView,k=j.extend({STREAMING_MAX_VISIBLE:250,events:{"click [data-action=more-posts]":"handleLoadMore"},initialize:function(a){this.lounge=a.lounge,this.thread=a.thread,this.posts=a.posts,this.postsToAppend=[],this.postsToPrepend=[],this.session=a.session,this.subViews={},this.state={nextPassTimeoutId:null,renderedPosts:[],clearDomAfterRender:!1,totalPostsProcessed:0,totalElapsedTime:0},this.listenTo(this.posts,{reset:this.redrawPosts,add:this.addPosts,remove:this.removePost}),this.listenTo(this.thread,"change:highlightedPost",this.handleHasHighlightedState),this.listenTo(this.posts,"reset add",this.toggleNoPosts),this.listenTo(this.posts,"reset add",this.enableTimestampUpdates),this.listenTo(this,"render:end",this.toggleLoadMorePosts),this.listenTo(this,"render:end",this.handleHasHighlightedState)
},handleHasHighlightedState:function(){this.$el.toggleClass("has-highlighted-post",this.thread.has("highlightedPost"))},getPostView:function(a){return this.subViews[a]},bootstrap:function(a,c){this.permalinkOptions=c,this.posts.reset(a.posts),b.invoke(this.subViews,"manageMessageHeight")},bindUIUpdateHandlers:function(){var c=this,d=a(window),e=a(document.body),f=e.width(),g=b.debounce(function(){var a=e.width();f!==a&&c.subViews&&(f=a,b.each(c.subViews,function(a){a.manageMessageHeight()}))},50);d.on("resize",g)},updateTimestamps:function(){return!this.subViews||b.size(this.subViews)<1?!1:(b.invoke(this.subViews,"updateRelativeTime"),!0)},enableTimestampUpdates:function(){var a=this,c=1e3*60;if(!a.timestampUpdateTimer){var d=function(){return a.updateTimestamps()?(a.timestampUpdateTimer=b.delay(d,c),void 0):(a.timestampUpdateTimer=null,void 0)};a.timestampUpdateTimer=b.delay(d,c)}},openReply:function(a){var b=this.posts.get(a);if(b){var c=this.subViews[b.cid];c.showReply()}},openEdit:function(a){var b=this.posts.get(a);if(b){var c=this.subViews[b.cid];c.showEdit()}},toggleLoadMorePosts:function(){var a=this.$el.find("#posts [data-role=more]");this.updateDom(function(){var b=this.posts.hasNext();b?a.show():a.hide()},this)},handleLoadMore:function(b){b.preventDefault();var c=this,d=a(b.currentTarget);d.addClass("busy"),c.posts.more({success:function(){c.once("render:end",function(){d.removeClass("busy")})},error:function(){d.removeClass("busy")}}),this.lounge.trigger("uiAction:seeMore"),e.sendHostMessage("posts.paginate")},renderLayout:a.noop,toggleNoPosts:function(){this.updateDom(function(){var b=this.posts.models;b.length?a("#no-posts").hide():a("#no-posts").show()},this)},handleSort:function(){a("#posts [data-role=more]").hide(),a("#no-posts").hide(),a("#post-list").addClass("loading").empty()},redrawPosts:function(){var a=this;a.subViews={},a.once("render:end",function(){b.each(h.PostReplyView.open,function(b,c){var d=a.subViews[c];if(d){var e=d.getReplyView();e.textarea.set(b.textarea.get()),b.isOpen()?e.show():e.hide()}})}),a.posts.setPageFor&&a.permalinkOptions&&a.permalinkOptions.postId&&a.posts.setPageFor(a.permalinkOptions.postId,{silent:!0}),a.addPosts(a.posts,{clearDom:!0})},postsShouldBePrepended:function(a){var b=a.length&&a[0];return!!b&&(b.created||!b.id||b.get("isRealtime")||b.requestedByPermalink)},hasQueuedPosts:function(){return this.postsToAppend.length||this.postsToPrepend.length},addPosts:b.decorate(c.collectionAddNormalizer(c.Collection,f.Post),function(a,c,d){var e=this;if(d.clearDom&&(e.postsToAppend=[],e.postsToPrepend=[],e.postsShouldClearDom=!0),e.postsShouldBePrepended(a)){var f=[];b.each(a,function(a){var b=a.get("parent");b&&e.posts.get(b)?e.postsToPrepend.push(a):f.push(a)}),e.postsToPrepend=f.concat(e.postsToPrepend)}else e.postsToAppend=e.postsToAppend.concat(a);e.state.nextPassTimeoutId||(e.state.nextPassTimeoutId=window.requestAnimationFrame(function(){e.trigger("render:start"),e.addPostsIncremental()}))}),onDeferredViewReady:function(a){var b=this.subViews;b.hasOwnProperty(a)&&b[a].manageMessageHeight(),this.updateDom()},removePost:function(a){if(this.hasQueuedPosts())return this.once("render:end",b.bind(this.removePost,this,a)),void 0;var c=this.subViews[a.cid];c&&(c.remove(),delete this.subViews[a.cid])},addPostsIncremental:function(a){this.state.nextPassTimeoutId=null,this.discardRenderProgressIfClearDomRequested();var b=this.getPostModelsForThePass();b.length&&this.renderPass(b,a),this.finishPass(b),this.scheduleNextPass()},discardRenderProgressIfClearDomRequested:function(){this.postsShouldClearDom&&(this.state.clearDomAfterRender=!0,this.postsShouldClearDom=!1,this.state.renderedPosts=[])},getPostModelsForThePass:function(){return this.postsToAppend.length?this.postsToAppend:this.postsToPrepend},renderPass:function(a,b){for(var c=k.TARGET_PROCESS_TIME,d=b||this.calculatePostsForNextRun(c)||k.MINIMUM_POSTS_PER_RUN;d>0;){var e=a.splice(0,d),f=this.timedRenderPosts(e);if(null===f)break;c-=f,d=this.calculatePostsForNextRun(c)}},timedRenderPosts:function(a){if(!a.length)return null;var c=+new Date;Array.prototype.push.apply(this.state.renderedPosts,b.map(a,this.createPostView,this));var d=+new Date-c;return 0>d&&(d=0),this.state.totalElapsedTime+=d,this.state.totalPostsProcessed+=a.length,d||null},createPostView:function(a){var b,c=a.get("parent");c&&(c=this.posts.get(c),b=c&&this.getPostView(c.cid));var d=new i({parent:b,model:a,thread:this.thread,session:this.session,created:a.created});return this.subViews[a.cid]=d,d.render(),d},calculatePostsForNextRun:function(a){return 0>=a?0:this.state.totalElapsedTime<=0?this.state.totalPostsProcessed:Math.floor(a*this.state.totalPostsProcessed/this.state.totalElapsedTime)},finishPass:function(b){b.length||this.updateDom(function(){if(this.$postList=a("#post-list"),this.state.clearDomAfterRender&&(this.$postList.empty(),this.state.clearDomAfterRender=!1),this.state.renderedPosts.length){this.removeOldPostsIfRealtime(),this.enablePostTracking(this.state.renderedPosts);var c=b===this.postsToAppend;this.insertPostElements(this.state.renderedPosts,c),this.state.renderedPosts=[]}this.$postList.removeClass("loading"),this.postsToPrepend.length||this.postsToAppend.length||this.trigger("render:end")},this)},removeOldPostsIfRealtime:function(){var a=b.any(this.state.renderedPosts,function(a){return a.model.get("isRealtime")});a&&this.removeOldPosts()},removeOldPosts:function(){if(this.lounge.switches&&this.lounge.switches.enabled("next_realtime_cap")){var a=b.size(this.subViews)-this.STREAMING_MAX_VISIBLE;if(!(0>=a))for(var c,e=this.posts.sortBy(function(a){return d(a.get("createdAt")).valueOf()}),f=0,g=0;f<e.length&&a>=g;f++)c=this.getPostView(e[f].cid),c&&0===c.childrenNode.children().length&&(this.posts.remove(e[f]),g+=1)}},enablePostTracking:function(a){b.each(a,function(a){a.visible=!0})},insertPostElements:function(a,c){var d=b.groupBy(a,function(a){return!!a.parent});b.each(d[!0],function(a){a.parent.attachChild(a)});var e=b.pluck(d[!1],"$el");c?this.$postList.append(e):this.$postList.prepend(e)},scheduleNextPass:function(){if(this.postsToPrepend.length||this.postsToAppend.length){var a=this.calculatePostsForNextRun(k.TARGET_FIRST_ATTEMPT_TIME);a=Math.max(a,k.MINIMUM_POSTS_PER_RUN),this.state.nextPassTimeoutId=window.requestAnimationFrame(b.bind(this.addPostsIncremental,this,a))}}});return k.TARGET_PROCESS_TIME=30,k.TARGET_FIRST_ATTEMPT_TIME=Math.floor(.8*k.TARGET_PROCESS_TIME),k.MINIMUM_POSTS_PER_RUN=2,{PostCollectionView:k}}),define("lounge/views/realtime",["underscore","backbone","common/templates","common/utils","lounge/common"],function(a,b,c,d,e){"use strict";var f=d.preventDefaultHandler,g=b.View.extend({events:{click:"handleDrain"},getDirection:function(a){if(this.offset&&this.dim){var b=a.pageOffset,c=b+a.height,d=this.offset.top+a.frameOffset.top,e=d+this.dim.height;return b>e?1:d>c?-1:0}},setCount:function(a){this.options.count=a},render:function(){var b=this;return 0===b.options.count?void b.$el.hide():(b.$el.html(c.render("realtimeCommentNotification",{comments:b.options.count})),b.listenTo(e.getLounge(),"domReflow",a.throttle(function(){0!==b.options.count&&(this.offset=b.$el.offset(),this.dim=b.$el.dim())},400)),b.$el.show(),void 0)},handleDrain:f(function(){this.model.queue.drain(),this.setCount(this.model.queue.counters.comments),this.render()})}),h=g.extend({events:{click:"handleDrain"},getDirection:function(a){if(this.options.postView.visible){this.offset=this.options.postView.offset,this.dim=this.options.postView.dim;var b=g.prototype.getDirection.call(this,a);return delete this.offset,delete this.dim,b}},render:function(){var b=this,d=b.options.postView;return 0===b.options.count?(b.$el.hide(),d.trackPosition=!1,void 0):(d.trackPosition=!0,b.$el.html(c.render("realtimeReplyNotification",{replies:b.options.count})),b.$el.show(),a.delay(function(){b.$el.addClass("reveal")},13),void 0)},handleDrain:f(function(){var a=this.model.id,b=this.options.postView,c=this.options.thread.queue;c.drain(a),this.setCount(c.counters.replies[a]),b.trackPosition=!1,this.render()})});return{QueuedPostView:g,QueuedReplyView:h}}),this.Handlebars=this.Handlebars||{},this.Handlebars.lounge=this.Handlebars.lounge||{},this.Handlebars.lounge.templates=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e="";return e+="\n\n",d=c["if"].call(a,a&&a.sessionUserId,{hash:{},inverse:Ie.noop,fn:Ie.program(2,g,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function g(a,b){var d,e="";return e+='\n<div class="follow-btn-wrap">\n',d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isSession),{hash:{},inverse:Ie.program(6,j,b),fn:Ie.program(3,h,b),data:b}),(d||0===d)&&(e+=d),e+="\n</div>\n"}function h(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isEditable),{hash:{},inverse:Ie.noop,fn:Ie.program(4,i,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n\n"}function i(a,b){var d="";return d+='\n<a href="#" data-action="edit-profile" target="_blank" class="btn follow-btn edit-profile">'+He(c.gettext.call(a,"Edit profile",{hash:{},data:b}))+"</a>\n"}function j(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isPrivate),{hash:{},inverse:Ie.program(9,l,b),fn:Ie.program(7,k,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function k(a,b){var d="";return d+='\n<span class="btn follow-btn private">\n<i aria-hidden="true" class="icon-lock"></i>\n<span class="btn-text">'+He(c.gettext.call(a,"Private",{hash:{},data:b}))+"</span>\n</span>\n"}function l(a,b){var d,e="";return e+='\n<a href="'+He((d=a&&a.user,d=null==d||d===!1?d:d.profileUrl,typeof d===Je?d.apply(a):d))+'" class="btn follow-btn ',d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isFollowing),{hash:{},inverse:Ie.noop,fn:Ie.program(10,m,b),data:b}),(d||0===d)&&(e+=d),e+='" data-action="follow-user" data-user="'+He((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'">\n<span class="btn-text following-text">'+He(c.gettext.call(a,"Following",{hash:{},data:b}))+'</span>\n<span class="btn-text follow-text">'+He(c.gettext.call(a,"Follow",{hash:{},data:b}))+'</span>\n<i aria-hidden="true" class="icon-plus"></i> \n<i aria-hidden="true" class="icon-checkmark"></i>\n</a>\n'}function m(){return"following"}function n(a,b){var d,e="";return e+='\n<a class="close" data-action="dismiss">×</a>\n',d=c["if"].call(a,a&&a.safe,{hash:{},inverse:Ie.program(15,p,b),fn:Ie.program(13,o,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function o(a,b){var d="";return d+="\n<span>"+He(c.html.call(a,a&&a.message,{hash:{},data:b}))+"</span>\n"}function p(a){var b,c="";return c+="\n<span>"+He((b=a&&a.message,typeof b===Je?b.apply(a):b))+"</span>\n"}function q(a,b){var d,e="";return e+="\n<h5>"+He(c.gettext.call(a,"Add to blacklist",{hash:{},data:b}))+"</h5>\n\n",d=c["if"].call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:Ie.noop,fn:Ie.program(18,r,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<label><input type="checkbox" name="email" value="'+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.email,typeof d===Je?d.apply(a):d))+'"> '+He(c.gettext.call(a,"Email",{hash:{},data:b}))+": "+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.email,typeof d===Je?d.apply(a):d))+'</label>\n\n<label><input type="checkbox" name="ip" value="'+He((d=a&&a.post,d=null==d||d===!1?d:d.ipAddress,typeof d===Je?d.apply(a):d))+'"> '+He(c.gettext.call(a,"IP Address",{hash:{},data:b}))+": "+He((d=a&&a.post,d=null==d||d===!1?d:d.ipAddress,typeof d===Je?d.apply(a):d))+'</label>\n\n<label><input type="checkbox" name="retroactive" value="1"/> '+He(c.gettext.call(a,"Apply retroactively",{hash:{},data:b}))+'</label>\n\n<div class="actions">\n<button class="btn btn-small" type="submit">'+He(c.gettext.call(a,"Save",{hash:{},data:b}))+'</button>\n<button class="btn btn-small" data-action="cancel">'+He(c.gettext.call(a,"Cancel",{hash:{},data:b}))+"</button>\n</div>\n"}function r(a,b){var d,e="";return e+='\n<label><input type="checkbox" name="user" value="'+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'" checked="checked"/> '+He(c.gettext.call(a,"User",{hash:{},data:b}))+": "+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.username,typeof d===Je?d.apply(a):d))+"</label>\n"}function s(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"We are unable to post your comment because you have been blocked by %(forumName)s.",{hash:{forumName:a&&a.forumName},data:b}))+'\n<a target="_blank" href="http://help.disqus.com/customer/portal/articles/466223-who-deleted-or-removed-my-comment-">'+He(c.gettext.call(a,"Find out more.",{hash:{},data:b}))+"</a>\n"}function t(a,b){var d="";return d+='\n<div id="recaptcha_widget" style="" class="captcha">\n<div class="primary">\n<div class="captcha-image">\n<div id="recaptcha_image"></div>\n</div>\n\n<div class="recaptcha_only_if_incorrect_sol" style="display:none">'+He(c.gettext.call(a,"Incorrect please try again",{hash:{},data:b}))+'</div>\n\n<div class="inputs">\n<button class="btn" type="submit">'+He(c.gettext.call(a,"Submit",{hash:{},data:b}))+'</button>\n<p class="input-wrapper">\n<input type="text" id="recaptcha_response_field" name="recaptcha_response_field" placeholder="'+He(c.gettext.call(a,"Enter the words above",{hash:{},data:b}))+'"/>\n</p>\n</div>\n</div>\n<div class="secondary">\n<p><a href="javascript:Recaptcha.reload()">'+He(c.gettext.call(a,"Get another CAPTCHA",{hash:{},data:b}))+'</a></p>\n<p class="recaptcha_only_if_image"><a href="javascript:Recaptcha.switch_type(\'audio\')">'+He(c.gettext.call(a,"Get an audio CAPTCHA",{hash:{},data:b}))+'</a></p>\n<p class="recaptcha_only_if_audio"><a href="javascript:Recaptcha.switch_type(\'image\')">'+He(c.gettext.call(a,"Get an image CAPTCHA",{hash:{},data:b}))+'</a></p>\n</div>\n\n<div class="actions">\n\n</div>\n</div>\n'}function u(a){var b,c="";return c+="\n<strong>"+He((b=a&&a.name,typeof b===Je?b.apply(a):b))+"</strong>\n"}function v(a,b){var d="";return d+='\n<div>\n<div class="row">\n<h3>'+He(c.gettext.call(a,"Top Commenters on %(forum)s",{hash:{forum:c.getPartial.call(a,"communityForum",a&&a.forum,{hash:{},data:b})},data:b}))+'</h3>\n\n<div data-role="top-users">\n\n<a class="see-more hidden" title="'+He(c.gettext.call(a,"see more",{hash:{},data:b}))+'" data-action="see-more">'+He(c.gettext.call(a,"see more",{hash:{},data:b}))+'</a>\n</div>\n\n</div>\n\n<div class="row">\n<h3>'+He(c.gettext.call(a,"Top Discussions on %(forum)s",{hash:{forum:c.getPartial.call(a,"communityForum",a&&a.forum,{hash:{},data:b})},data:b}))+'</h3>\n<div data-role="top-threads"></div>\n</div>\n</div>\n'}function w(a,b){var d,e="";return e+='\n<div class="tooltip">\n<div class="notch"></div>\n\n',d=c["if"].call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:Ie.program(31,y,b),fn:Ie.program(29,x,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<img src="'+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===Je?d.apply(a):d))+'" class="user" alt="'+He(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'" />\n\n',d=c["if"].call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:Ie.program(35,A,b),fn:Ie.program(33,z,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<div class="content">\n<h3>\n',d=c.unless.call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:Ie.noop,fn:Ie.program(37,B,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n<h3>"+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.name,typeof d===Je?d.apply(a):d))+"</h3>\n\n",d=c.unless.call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:Ie.noop,fn:Ie.program(35,A,b),data:b}),(d||0===d)&&(e+=d),e+="\n</h3>\n\n<p>"+He(c.html.call(a,(d=a&&a.post,null==d||d===!1?d:d.excerpt),{hash:{},data:b}))+"</p>\n</div>\n</div>\n"}function x(){return'\n<div class="avatar">\n'}function y(a){var b,c="";return c+='\n<a href="'+He((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.profileUrl,typeof b===Je?b.apply(a):b))+'" class="avatar" data-action="profile" data-user="'+He((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.id,typeof b===Je?b.apply(a):b))+'">\n'}function z(){return"\n</div>\n"}function A(){return"\n</a>\n"}function B(a){var b,c="";return c+='\n<a href="'+He((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.profileUrl,typeof b===Je?b.apply(a):b))+'" data-action="profile" data-user="'+He((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.id,typeof b===Je?b.apply(a):b))+'">\n'}function C(a,b){var d="";return d+='\n<div>\n<ul class="my-disqus-nav">\n<li class="user-vote-count" data-role="notifications-tab">\n<a href="#" title="notifications" data-action="notifications">\n<span class="count"><span data-role="notification-count"></span> '+He(c.gettext.call(a,"new",{hash:{},data:b}))+'</span>\n<span class="label">'+He(c.gettext.call(a,"Notifications",{hash:{},data:b}))+'</span>\n</a>\n</li>\n<li class="user-comment-count active" data-role="network-tab">\n<a href="#" title="network" data-action="network">\n<span class="count">'+He(c.gettext.call(a,"Now",{hash:{},data:b}))+'</span>\n<span class="label">'+He(c.gettext.call(a,"in your network",{hash:{},data:b}))+'</span>\n</a>\n</li>\n</ul>\n\n\n<div data-role="network" data-zone="my-activity-feed"></div>\n\n\n<div data-role="notifications" data-zone="my-notifications"></div>\n</div>\n'}function D(a,b){var d="";return d+='\n<div class="textarea-wrapper" data-role="textarea">\n<div class="post-actions">\n<div class="logged-in">\n<section>\n<div class="temp-post">\n<a class="cancel" href="#" data-action="edit">\n'+He(c.gettext.call(a,"Cancel",{hash:{},data:b}))+'\n</a>\n<button class="btn" type="submit">'+He(c.gettext.call(a,"Save Edit",{hash:{},data:b}))+"</button>\n</div>\n</section>\n</div>\n</div>\n</div>\n"}function E(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isSession),{hash:{},inverse:Ie.program(50,J,b),fn:Ie.program(44,F,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function F(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isEditable),{hash:{},inverse:Ie.noop,fn:Ie.program(45,G,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function G(a,b){var d,e="";return e+='\n<a href="'+He(c.g.call(a,"urls.editProfile",{hash:{},data:b}))+'"\ntarget="_blank"\nclass="\n',d=c["if"].call(a,a&&a.buttonAsLink,{hash:{},inverse:Ie.program(48,I,b),fn:Ie.program(46,H,b),data:b}),(d||0===d)&&(e+=d),e+='">\n'+He(c.gettext.call(a,"Edit profile",{hash:{},data:b}))+"\n</a>\n"}function H(){return"\npublisher-anchor-color follow-link\n"}function I(){return"\nbtn btn-small\n"}function J(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isPrivate),{hash:{},inverse:Ie.program(53,L,b),fn:Ie.program(51,K,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function K(a,b){var d="";return d+='\n<span\nclass="btn btn-small follow-btn private">\n<i aria-hidden="true" class="icon-lock"></i>\n<span class="btn-text">\n'+He(c.gettext.call(a,"Private",{hash:{},data:b}))+"\n</span>\n</span>\n"}function L(a,b){var d,e="";return e+='\n<a href="#" class="\n',d=c["if"].call(a,a&&a.buttonAsLink,{hash:{},inverse:Ie.program(54,M,b),fn:Ie.program(46,H,b),data:b}),(d||0===d)&&(e+=d),e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isFollowing),{hash:{},inverse:Ie.noop,fn:Ie.program(10,m,b),data:b}),(d||0===d)&&(e+=d),e+='"\ndata-action="toggleFollow"\ndata-user="'+He((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'">\n<span class="btn-text following-text">'+He(c.gettext.call(a,"Following",{hash:{},data:b}))+'</span>\n<span class="btn-text follow-text">'+He(c.gettext.call(a,"Follow",{hash:{},data:b}))+'</span>\n<i aria-hidden="true" class="icon-checkmark"></i>\n</a>\n'}function M(){return"\nbtn btn-small follow-btn\n"}function N(a){var b,c="";return c+='\n<span data-user="'+He((b=a&&a.id,typeof b===Je?b.apply(a):b))+'" data-role="username">'+He((b=a&&a.name,typeof b===Je?b.apply(a):b))+"</span>\n"}function O(a,b){var d,e="";return e+='\n<div class="alert error" style="display:none" role="alert">\n<a class="close" data-action="dismiss-alert" title="'+He(c.gettext.call(a,"Dismiss",{hash:{},data:b}))+'">×</a>\n<span></span>\n</div>\n\n<div class="postbox">\n<div class="avatar">\n',d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:Ie.program(61,Q,b),fn:Ie.program(59,P,b),data:b}),(d||0===d)&&(e+=d),e+='\n</div>\n\n<div class="textarea-wrapper" data-role="textarea" dir="auto">\n<div data-role="drag-drop-placeholder" class="media-drag-hover" style="display: none">\n<div class="drag-text">\n&#11015; '+He(c.gettext.call(a,"Drag and drop your images here to upload them.",{hash:{},data:b}))+"\n</div>\n</div>\n",d=c["if"].call(a,a&&a.allowMedia,{hash:{},inverse:Ie.noop,fn:Ie.program(63,R,b),data:b}),(d||0===d)&&(e+=d),e+='\n<div class="post-actions">\n<ul class="wysiwyg">\n',d=c["if"].call(a,a&&a.allowMedia,{hash:{},inverse:Ie.noop,fn:Ie.program(65,S,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n</ul>\n\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:Ie.noop,fn:Ie.program(71,W,b),data:b}),(d||0===d)&&(e+=d),e+="\n</div>\n</div>\n\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:Ie.noop,fn:Ie.program(74,Y,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n\n",d=c["if"].call(a,a&&a.audienceSyncRequired,{hash:{},inverse:Ie.noop,fn:Ie.program(76,Z,b),data:b}),(d||0===d)&&(e+=d),e+="\n</div>\n"}function P(a){var b,c="";return c+='\n<a href="'+He((b=a&&a.user,b=null==b||b===!1?b:b.profileUrl,typeof b===Je?b.apply(a):b))+'" class="user" data-action="profile" data-user="'+He((b=a&&a.user,b=null==b||b===!1?b:b.id,typeof b===Je?b.apply(a):b))+'">\n<img data-role="user-avatar" data-user="'+He((b=a&&a.user,b=null==b||b===!1?b:b.id,typeof b===Je?b.apply(a):b))+'" src="'+He((b=a&&a.user,b=null==b||b===!1?b:b.avatar,b=null==b||b===!1?b:b.cache,typeof b===Je?b.apply(a):b))+'"/>\n</a>\n'}function Q(a){var b,c="";return c+='\n<span class="user">\n<img data-role="user-avatar" src="'+He((b=a&&a.user,b=null==b||b===!1?b:b.avatar,b=null==b||b===!1?b:b.cache,typeof b===Je?b.apply(a):b))+'"/>\n</span>\n'}function R(){var a="";return a+='\n<div class="media-preview empty" data-role="media-preview">\n<ul data-role="media-legacy-list"></ul>\n<ul data-role="media-rich-list"></ul>\n<div class="media-expanded empty" data-role="media-preview-expanded">\n\n<img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="\ndata-role="media-preview-expanded-image">\n</div>\n</div>\n'}function S(a,b){var d,e="";return e+='\n<li>\n<a href="#" tabindex="-1" data-action="attach" class="attach" title="'+He(c.gettext.call(a,"Upload Images",{hash:{},data:b}))+'"><span>'+He(c.gettext.call(a,"Attach",{hash:{},data:b}))+'</span></a>\n<input type="file" data-role="media-upload"\ntabindex="-1"\n',d=c["with"].call(a,"_window_",{hash:{},inverse:Ie.noop,fn:Ie.program(66,T,b),data:b}),(d||0===d)&&(e+=d),e+="\n>\n</li>\n"}function T(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c["typeof"].call(a,a&&a.FormData,"undefined",{hash:{},data:b}),{hash:{},inverse:Ie.program(69,V,b),fn:Ie.program(67,U,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function U(){var a="";return a+='\n\nclass="ie"\nname="attachment"\n'}function V(){return'\nclass="regular"\naccept="image/*"\n'}function W(a,b){var d,e="";return e+="\n",d=c.unless.call(a,a&&a.audienceSyncRequired,{hash:{},inverse:Ie.noop,fn:Ie.program(72,X,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function X(a,b){var d="";return d+='\n<div class="logged-in">\n<section>\n<div class="temp-post" style="text-align: right">\n<button class="btn">\n'+He(c.gettext.call(a,"Post as %(name)s",{hash:{name:c.getPartial.call(a,"formUser",a&&a.user,{hash:{},data:b})},data:b}))+"\n</button>\n</div>\n</section>\n</div>\n"}function Y(a,b){var e,f="";return f+='\n<section class="auth-section logged-out">\n<div class="connect">\n<h6>'+He(c.gettext.call(a,"Sign in with",{hash:{},data:b}))+"</h6>\n",e=Ie.invokePartial(d.loginButtons,"loginButtons",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</div>\n",e=Ie.invokePartial(d.guestForm,"guestForm",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</section>\n"}function Z(a,b){var e,f="";return f+='\n<section class="auth-section">\n',e=Ie.invokePartial(d.audienceSync,"audienceSync",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</section>\n"}function $(a,b){var d,e="";return e+='\n<ul data-role="login-menu" class="services login-buttons">\n\n',d=c["if"].call(a,(d=a&&a.sso,null==d||d===!1?d:d.url),{hash:{},inverse:Ie.noop,fn:Ie.program(79,_,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<li class="auth-disqus">\n<button type="button" data-action="auth:disqus" title="Disqus"><i class="icon-disqus"></i></button>\n</li>\n<li class="auth-facebook">\n<button type="button" data-action="auth:facebook" title="Facebook"><i class="icon-facebook-circle"></i></button>\n</li>\n<li class="auth-twitter">\n<button type="button" data-action="auth:twitter" title="Twitter"><i class="icon-twitter-circle"></i></button>\n</li>\n<li class="auth-google">\n<button type="button" data-action="auth:google" title="Google"><i class="icon-google-plus-circle"></i></button>\n</li>\n<li class="auth-signup">\n<button type="button" data-action="auth:disqus" title="Disqus">Sign up for Disqus</button>\n</li>\n</ul>\n'}function _(a,b){var d,e="";return e+='\n<li class="sso">\n<button type="button" data-action="auth:sso"\ntitle="'+He((d=a&&a.sso,d=null==d||d===!1?d:d.name,typeof d===Je?d.apply(a):d))+'"\nclass="',d=c["if"].call(a,(d=a&&a.sso,null==d||d===!1?d:d.button),{hash:{},inverse:Ie.program(82,bb,b),fn:Ie.program(80,ab,b),data:b}),(d||0===d)&&(e+=d),e+='">\n',d=c["if"].call(a,(d=a&&a.sso,null==d||d===!1?d:d.button),{hash:{},inverse:Ie.program(86,db,b),fn:Ie.program(84,cb,b),data:b}),(d||0===d)&&(e+=d),e+="\n</button>\n</li>\n"}function ab(){return"image"}function bb(){return"no-image"}function cb(a){var b,c="";return c+='\n<img alt="'+He((b=a&&a.sso,b=null==b||b===!1?b:b.name,typeof b===Je?b.apply(a):b))+'" src="'+He((b=a&&a.sso,b=null==b||b===!1?b:b.button,typeof b===Je?b.apply(a):b))+'"/>\n'}function db(a){var b,c="";return c+="\n"+He((b=a&&a.sso,b=null==b||b===!1?b:b.name,typeof b===Je?b.apply(a):b))+"\n"}function eb(a,b){var d,e="";return e+='\n<div class="guest">\n<h6 class="guest-form-title">\n',d=c["if"].call(a,a&&a.allowAnonPost,{hash:{},inverse:Ie.program(91,gb,b),fn:Ie.program(89,fb,b),data:b}),(d||0===d)&&(e+=d),e+='\n</h6>\n\n<div class="what-is-disqus help-icon">\n<div id="rules" class="tooltip show">\n<h3>'+He(c.gettext.call(a,"Disqus is a conversation network",{hash:{},data:b}))+"</h3>\n<ul>\n<li><span>"+He(c.gettext.call(a,"Disqus never moderates or censors. The rules on this community are its own.",{hash:{},data:b}))+"</span></li>\n<li><span>"+He(c.gettext.call(a,"Your email is safe with us. It's only used for moderation and optional notifications.",{hash:{},data:b}))+"</span></li>\n<li><span>"+He(c.gettext.call(a,"Don't be a jerk or do anything illegal. Everything is easier that way.",{hash:{},data:b}))+'</span></li>\n</ul>\n<p class="clearfix"><a href="http://docs.disqus.com/kb/terms-and-policies/" class="btn btn-small" target="_blank">'+He(c.gettext.call(a,"Read full terms and conditions",{hash:{},data:b}))+'</a></p>\n</div>\n</div>\n\n<p class="input-wrapper">\n<input dir="auto" type="text" placeholder="'+He(c.gettext.call(a,"Name",{hash:{},data:b}))+'" name="author-name" maxlength="30" />\n</p>\n\n<div class="guest-details ',d=c["if"].call(a,(d=a&&a.sso,null==d||d===!1?d:d.url),{hash:{},inverse:Ie.noop,fn:Ie.program(93,hb,b),data:b}),(d||0===d)&&(e+=d),e+='" data-role="guest-details">\n<p class="input-wrapper">\n<input dir="auto" type="email" placeholder="'+He(c.gettext.call(a,"Email",{hash:{},data:b}))+'" name="author-email"/>\n</p>\n\n<p class="input-wrapper">\n<input dir="auto" type="password" placeholder="'+He(c.gettext.call(a,"Password",{hash:{},data:b}))+'" name="author-password"/>\n</p>\n',d=c["if"].call(a,a&&a.allowAnonPost,{hash:{},inverse:Ie.program(97,jb,b),fn:Ie.program(95,ib,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n</div>\n</div>\n<div class="proceed">\n',d=c["if"].call(a,a&&a.allowAnonPost,{hash:{},inverse:Ie.program(101,lb,b),fn:Ie.program(99,kb,b),data:b}),(d||0===d)&&(e+=d),e+="\n</div>\n"}function fb(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"or pick a name",{hash:{},data:b}))+"\n"}function gb(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"or register with Disqus",{hash:{},data:b}))+"\n"}function hb(){return"expanded"}function ib(a,b){var d="";return d+='\n<div class="guest-checkbox">\n<label>\n<input type="checkbox" name="author-guest"/>\n'+He(c.gettext.call(a,"I'd rather post as guest",{hash:{},data:b}))+"\n</label>\n</div>\n"}function jb(){return'\n<input type="checkbox" name="author-guest" style="display:none"/>\n'}function kb(a,b){var d="";return d+='\n<button type="submit" class="btn submit" aria-label="'+He(c.gettext.call(a,"Post",{hash:{},data:b}))+'"><span class="icon-proceed"></span></button>\n<button type="submit" class="btn next" aria-label="'+He(c.gettext.call(a,"Next",{hash:{},data:b}))+'"><span class="icon-proceed"></span></button>\n'}function lb(a,b){var d="";return d+='\n<button type="submit" class="btn submit" aria-label="'+He(c.gettext.call(a,"Next",{hash:{},data:b}))+'"><span class="icon-proceed"></span></button>\n'}function mb(a,b){var d,e="";return e+='\n<div class="audiencesync">\n<h6>'+He(c.gettext.call(a,"Connect with %(forumName)s",{hash:{forumName:a&&a.forumName},data:b}))+'</h6>\n<div class="services">\n<div class="icons-container">\n<img class="icon" alt="Disqus"\nsrc="'+He("//a.disquscdn.com/next/assets/img/sync-icon.a97d408756a74d139b9d78160ddda973.png")+'">\n<img class="icon" alt="arrow to"\nsrc="'+He("//a.disquscdn.com/next/assets/img/sync-arrow.f870280459c2d762e3b56d6a8b81aff6.png")+'">\n<img class="icon" alt="'+He((d=a&&a.forumName,typeof d===Je?d.apply(a):d))+'"\nsrc="'+He(c.g.call(a,"urls.root",{hash:{},data:b}))+"/api/applications/icons/"+He((d=a&&a.apiKey,typeof d===Je?d.apply(a):d))+'.png">\n</div>\n<p>\n'+He(c.gettext.call(a,"%(forumName)s needs permission to access your account.",{hash:{forumName:a&&a.forumName},data:b}))+'\n</p>\n</div>\n<button type="button" data-action="audiencesync"\nclass="proceed btn submit">'+He(c.gettext.call(a,"Next",{hash:{},data:b}))+"</button>\n</div>\n"}function nb(a,b){var d,e="";return e+='\n<li class="publisher-border-color">\n<div class="media-box">\n<div class="media-ct">\n<div class="media-surface">\n<a href="'+He(c.any.call(a,(d=a&&a.media,null==d||d===!1?d:d.url),a&&a.backupUrl,{hash:{},data:b}))+'" target="_blank">\n<img src="'+He((d=a&&a.media,d=null==d||d===!1?d:d.thumbnailUrl,typeof d===Je?d.apply(a):d))+'" alt="',d=c["if"].call(a,(d=a&&a.media,null==d||d===!1?d:d.title),{hash:{},inverse:Ie.program(108,pb,b),fn:Ie.program(106,ob,b),data:b}),(d||0===d)&&(e+=d),e+='">\n</a>\n</div>\n</div>\n</div>\n</li>\n'}function ob(a){var b;return He((b=a&&a.media,b=null==b||b===!1?b:b.title,typeof b===Je?b.apply(a):b))}function pb(a,b){return He(c.gettext.call(a,"Media attachment",{hash:{},data:b}))}function qb(a,b){var d,e="";return e+='\n<li class="publisher-border-color" data-media-id="'+He((d=a&&a.location,typeof d===Je?d.apply(a):d))+'">\n<div class="media-box">\n<div class="media-ct">\n<div class="media-surface">\n<img src="'+He((d=a&&a.location,typeof d===Je?d.apply(a):d))+'?w=128&h=128" alt="'+He(c.gettext.call(a,"Media attachment",{hash:{},data:b}))+'">\n<a href="#" class="media-delete" data-action="detach">&#10005;</a>\n</div>\n</div>\n</div>\n</li>\n'}function rb(a,b){var d="";return d+='\n<h2 class="highlighted-comment-header">'+He(c.gettext.call(a,"Featured Comment",{hash:{},data:b}))+'</h2>\n\n<ul class="post-list"></ul>\n'
}function sb(a,b){var e,f="";return f+='\n<div class="tooltip">\n<div class="notch"></div>\n<a href="'+He((e=a&&a.user,e=null==e||e===!1?e:e.profileUrl,typeof e===Je?e.apply(a):e))+'" class="avatar" data-action="profile" data-user="'+He((e=a&&a.user,e=null==e||e===!1?e:e.id,typeof e===Je?e.apply(a):e))+'">\n<img data-user="'+He((e=a&&a.user,e=null==e||e===!1?e:e.id,typeof e===Je?e.apply(a):e))+'" data-role="user-avatar" src="'+He((e=a&&a.user,e=null==e||e===!1?e:e.avatar,e=null==e||e===!1?e:e.cache,typeof e===Je?e.apply(a):e))+'" class="user" alt="'+He(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'" />\n</a>\n<div class="content">\n<h3>\n<a href="'+He((e=a&&a.user,e=null==e||e===!1?e:e.profileUrl,typeof e===Je?e.apply(a):e))+'" data-action="profile" data-role="username" data-user="'+He((e=a&&a.user,e=null==e||e===!1?e:e.id,typeof e===Je?e.apply(a):e))+'">'+He((e=a&&a.user,e=null==e||e===!1?e:e.name,typeof e===Je?e.apply(a):e))+"</a>\n",e=c["if"].call(a,(e=a&&a.user,e=null==e||e===!1?e:e.thread,null==e||e===!1?e:e.canModerate),{hash:{},inverse:Ie.noop,fn:Ie.program(115,tb,b),data:b}),(e||0===e)&&(f+=e),f+="\n</h3>\n\n",e=c["if"].call(a,(e=a&&a.user,null==e||e===!1?e:e.about),{hash:{},inverse:Ie.noop,fn:Ie.program(117,ub,b),data:b}),(e||0===e)&&(f+=e),f+='\n\n\n<p class="stats" data-role="counters">\n',e=c.if_all.call(a,c.notNull.call(a,(e=a&&a.user,null==e||e===!1?e:e.numPosts),{hash:{},data:b}),c.notNull.call(a,(e=a&&a.user,null==e||e===!1?e:e.numLikesReceived),{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(119,vb,b),data:b}),(e||0===e)&&(f+=e),f+='\n</p>\n</div>\n<footer data-role="actions">\n',e=Ie.invokePartial(d.hovercardActions,"hovercardActions",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</footer>\n</div>\n"}function tb(a,b){var d="";return d+='<span class="badge moderator">'+He(c.gettext.call(a,"MOD",{hash:{},data:b}))+"</span>"}function ub(a,b){var d,e="";return e+='\n<p class="bio">'+He(c.truncate.call(a,(d=a&&a.user,null==d||d===!1?d:d.about),80,{hash:{},data:b}))+"</p>\n"}function vb(a,b){var e,f="";return f+="\n",e=Ie.invokePartial(d.hovercardCounters,"hovercardCounters",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function wb(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,(d=a&&a.user,null==d||d===!1?d:d.numPosts),1,{hash:{},data:b}),{hash:{},inverse:Ie.program(124,yb,b),fn:Ie.program(122,xb,b),data:b}),(d||0===d)&&(e+=d),e+='\n<span class="bullet">•</span>\n',d=c["if"].call(a,c.eq.call(a,(d=a&&a.user,null==d||d===!1?d:d.numLikesReceived),1,{hash:{},data:b}),{hash:{},inverse:Ie.program(128,Ab,b),fn:Ie.program(126,zb,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function xb(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"1 comment",{hash:{},data:b}))+"\n"}function yb(a,b){var d,e="";return e+="\n"+He(c.gettext.call(a,"%(numPosts)s comments",{hash:{numPosts:(d=a&&a.user,null==d||d===!1?d:d.numPosts)},data:b}))+"\n"}function zb(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"1 vote",{hash:{},data:b}))+"\n"}function Ab(a,b){var d,e="";return e+="\n"+He(c.gettext.call(a,"%(numLikesReceived)s votes",{hash:{numLikesReceived:(d=a&&a.user,null==d||d===!1?d:d.numLikesReceived)},data:b}))+"\n"}function Bb(a,b){var d,e="";return e+='\n<a href="'+He((d=a&&a.user,d=null==d||d===!1?d:d.profileUrl,typeof d===Je?d.apply(a):d))+'" class="full-profile" data-action="profile" data-user="'+He((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'">'+He(c.gettext.call(a,"Full profile",{hash:{},data:b}))+"</a>\n\n",d=c["if"].call(a,a&&a.showFollowButton,{hash:{},inverse:Ie.noop,fn:Ie.program(131,Cb,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n&nbsp;\n"}function Cb(a,b){var e,f="";return f+="\n\n",e=Ie.invokePartial(d.followButtonSmall,"followButtonSmall",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function Db(a,b){var e,f="";return f+='\n<div id="layout" >\n\n<div id="discovery-top"></div>\n\n<div id="onboard"></div>\n\n<div id="highlighted-post"></div>\n\n<header id="main-nav">\n',e=Ie.invokePartial(d.topNavigation,"topNavigation",a,c,d,b),(e||0===e)&&(f+=e),f+='\n</header>\n\n\n\n\n<section id="conversation" data-role="main" data-zone="thread">\n',e=Ie.invokePartial(d.mainNavigation,"mainNavigation",a,c,d,b),(e||0===e)&&(f+=e),f+='\n\n<div id="posts">\n\n<div id="form"></div>\n\n<button class="alert realtime" style="display: none" data-role="realtime-notification">\n\n</button>\n\n\n<div id="no-posts" style="display:none">'+He(c.gettext.call(a,"Be the first to comment.",{hash:{},data:b}))+'</div>\n\n<ul id="post-list" class="post-list loading">\n</ul>\n\n<div class="load-more" data-role="more" style="display:none">\n<a href="#" data-action="more-posts" class="btn">'+He(c.gettext.call(a,"Load more comments",{hash:{},data:b}))+'</a>\n</div>\n</div>\n\n</section>\n\n<section id="community" style="display:none" data-role="main" data-outbound-link="embed:community">\n\n</section>\n\n<section id="dashboard" style="display:none" data-role="main">\n\n\n<p style="line-height: 1.4">'+He(c.gettext.call(a,"Nothing for you here ... yet. But as you comment with Disqus and follow\nother Disqus users, you will start to receive notifications here, as well as a personalized\nfeed of activity by you and the people you follow. So get out there and participate in\nsome discussions!",{hash:{},data:b}))+'</p>\n</section>\n\n<section id="profile" style="display:none" data-role="main">\n</section>\n\n<div id="discovery"></div>\n\n<div id="footer">\n<ul>\n<li class="logo"><a href="http://disqus.com" title="'+He(c.gettext.call(a,"Powered by Disqus",{hash:{},data:b}))+'">'+He(c.gettext.call(a,"Powered by Disqus",{hash:{},data:b}))+'</a></li>\n<li id="thread-subscribe-button" class="email"> \n<div class="default">\n<a href="#" data-action="subscribe" title="'+He(c.gettext.call(a,"Subscribe and get email updates from this discussion",{hash:{},data:b}))+'"><i aria-hidden="true" class="icon-mail"></i><span class="clip">'+He(c.gettext.call(a,"Subscribe",{hash:{},data:b}))+'</span> <i aria-hidden="true" class="icon-checkmark"></i></a>\n</div>\n<div class="form">\n<div class="input-wrapper"><input id="thread-subscribe-email" type="email" placeholder="'+He(c.gettext.call(a,"yourname@email.com",{hash:{},data:b}))+'"/></div>\n</div>\n</li>\n<li class="install">\n<a href="https://disqus.com/websites/?utm_source='+He((e=a&&a.forum,e=null==e||e===!1?e:e.id,typeof e===Je?e.apply(a):e))+'&utm_medium=Disqus-Footer" target="_blank">\n<i aria-hidden="true" class="icon-disqus"></i>\n<span class="clip">'+He(c.gettext.call(a,"Add Disqus to your site",{hash:{},data:b}))+"</span>\n</a>\n</li>\n</ul>\n</div>\n</div>\n"}function Eb(a,b){var d,e="";return e+='\n<li data-role="post-sort" class="dropdown sorting">\n<a href="#" class="dropdown-toggle" data-nav="conversation" data-toggle="dropdown">\n',d=c["if"].call(a,c.eq.call(a,a&&a.order,"popular",{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(136,Fb,b),data:b}),(d||0===d)&&(e+=d),e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.order,"desc",{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(138,Gb,b),data:b}),(d||0===d)&&(e+=d),e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.order,"asc",{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(140,Hb,b),data:b}),(d||0===d)&&(e+=d),e+='\n<span class="caret"></span>\n</a>\n<ul class="dropdown-menu">\n<li ',d=c["if"].call(a,c.eq.call(a,a&&a.order,"popular",{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(142,Ib,b),data:b}),(d||0===d)&&(e+=d),e+='>\n<a href="#" data-action="sort" data-sort="popular">'+He(c.gettext.call(a,"Best",{hash:{},data:b}))+"</a>\n</li>\n\n<li ",d=c["if"].call(a,c.eq.call(a,a&&a.order,"desc",{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(142,Ib,b),data:b}),(d||0===d)&&(e+=d),e+='>\n<a href="#" data-action="sort" data-sort="desc">'+He(c.gettext.call(a,"Newest",{hash:{},data:b}))+"</a>\n</li>\n\n<li ",d=c["if"].call(a,c.eq.call(a,a&&a.order,"asc",{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(142,Ib,b),data:b}),(d||0===d)&&(e+=d),e+='>\n<a href="#" data-action="sort" data-sort="asc">'+He(c.gettext.call(a,"Oldest",{hash:{},data:b}))+"</a>\n</li>\n</ul>\n</li>\n"}function Fb(a,b){return He(c.gettext.call(a,"Sort by Best",{hash:{},data:b}))}function Gb(a,b){return He(c.gettext.call(a,"Sort by Newest",{hash:{},data:b}))}function Hb(a,b){return He(c.gettext.call(a,"Sort by Oldest",{hash:{},data:b}))}function Ib(){return'class="selected"'}function Jb(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.count,1,{hash:{},data:b}),{hash:{},inverse:Ie.program(145,Kb,b),fn:Ie.program(122,xb,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Kb(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"%(numPosts)s comments",{hash:{numPosts:a&&a.count},data:b}))+"\n"}function Lb(a,b){var d,e="";return e+='\n<nav class="nav nav-primary">\n<ul>\n<li class="tab-conversation active">\n\n<a href="#" data-role="post-count" class="publisher-nav-color" data-nav="conversation">\n',d=c["with"].call(a,"count",(d=a&&a.thread,null==d||d===!1?d:d.posts),{hash:{},inverse:Ie.noop,fn:Ie.program(148,Mb,b),data:b}),(d||0===d)&&(e+=d),e+='\n</a>\n</li>\n<li class="tab-community">\n<a href="#" class="publisher-nav-color" data-nav="community" id="community-tab">\n',d=c["with"].call(a,a&&a.forum,{hash:{},inverse:Ie.noop,fn:Ie.program(150,Nb,b),data:b}),(d||0===d)&&(e+=d),e+='\n</a>\n</li>\n<li class="dropdown user-menu" data-role="logout">\n<!-- rendered dynamically -->\n</li>\n<li class="notification-menu" data-role="notification-menu">\n<!-- rendered dynamically -->\n</li>\n</ul>\n</nav>\n'}function Mb(a,b){var e,f="";return f+="\n",e=Ie.invokePartial(d.postCount,"postCount",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function Nb(a,b){var e;return e=Ie.invokePartial(d.communityForum,"communityForum",a,c,d,b),e||0===e?e:""}function Ob(a,b){var d="";return d+='\n<a href="#" data-action="upvote" title="'+He(c.gettext.call(a,"Favorite this discussion",{hash:{},data:b}))+'">\n<span class="label">'+He(c.gettext.call(a,"Favorite",{hash:{},data:b}))+'</span>\n<span class="icon-star"></span>\n<span class="icon-check"></span>\n</a>\n'}function Pb(a,b){var e,f="";return f+='\n<div class="nav nav-secondary">\n<ul>\n',e=Ie.invokePartial(d.postSort,"postSort",a,c,d,b),(e||0===e)&&(f+=e),f+='\n\n<li id="thread-votes" class="favorite pull-right">\n<!-- rendered dynamically -->\n</li>\n\n<li id="thread-share-menu" class="dropdown share-menu">\n<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="'+He(c.gettext.call(a,"Share",{hash:{},data:b}))+'">\n<span class="label">'+He(c.gettext.call(a,"Share",{hash:{},data:b}))+'</span> <span class="icon-export"></span>\n</a>\n<ul class="share-menu dropdown-menu pull-right">\n<li class="share">'+He(c.gettext.call(a,"Share this discussion on",{hash:{},data:b}))+'\n<ul>\n<li class="twitter">\n<a data-action="share:twitter"\nhref="#">Twitter</a>\n</li>\n<li class="facebook">\n<a data-action="share:facebook" href="#">Facebook</a>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</div>\n'}function Qb(){return'\n<p>\nThe final leads of the Fantastic Four have been revealed.\nKate Mara, Michael B. Jordan and see who else is in the cast!\n</p>\n<div data-role="video-container">\n<a href="#" data-action="play-video" data-template="makerstudiosvideo">\n<div style="display: inline-block; width: 100%">\n<img src="http://disqus-cloudfront.s3.amazonaws.com/images/ffour.png" style="float: left; height: 54px; width: 77px; margin-right: 1em; margin-bottom: 0.5em;">\n<div style="float: left">\n<h5>Fantastic Four News - The Daily Byte</h5>\n<i class="icon-video"></i> Play video\n</div>\n</div>\n</a>\n</div>\n'}function Rb(){var a="";return a+='\n<iframe src="http://blip.tv/play/AYObljwC.html?p=1&autostart=true&utm_source=disqus&utm_medium=test" width="100%" height="443" frameborder="0" allowfullscreen></iframe>\n\n<embed type="application/x-shockwave-flash" src="http://a.blip.tv/api.swf#AYObljwC" style="display:none"></embed>\n'}function Sb(a,b){var d="";return d+='\n<div>\n<ul class="network-activity" data-role="entries"></ul>\n\n<div data-role="no-activity" style="display:none">\n'+He(c.gettext.call(a,"You have no activity.",{hash:{},data:b}))+'\n</div>\n\n<div class="load-more" data-role="more-activity" style="display:none">\n<a href="#" data-action="more" class="btn">'+He(c.gettext.call(a,"Load more activity",{hash:{},data:b}))+"</a>\n</div>\n</div>\n"}function Tb(a,b){var d,e="";return e+='\n<li class="network-activity-group">\n<h5>'+He(c.gettext.call(a,"Discussion on %(forum)s",{hash:{forum:c.getPartial.call(a,"networkForumLink",a&&a.thread,{hash:{},data:b})},data:b}))+'</h5>\n\n\n\n<h4><a href="'+He((d=a&&a.thread,d=null==d||d===!1?d:d.link,typeof d===Je?d.apply(a):d))+'">'+He(c.html.call(a,(d=a&&a.thread,null==d||d===!1?d:d.title),{hash:{},data:b}))+'</a></h4>\n\n<ul data-role="posts" class="post-list"/>\n</li>\n'}function Ub(a,b){var d,e="";return e+='\n<li class="post">\n<div class="post-content ',d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.parent),{hash:{},inverse:Ie.noop,fn:Ie.program(165,Vb,b),data:b}),(d||0===d)&&(e+=d),e+='">\n<div class="avatar">\n<img src="'+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===Je?d.apply(a):d))+'" class="source-avatar"/>\n',d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.parent),{hash:{},inverse:Ie.noop,fn:Ie.program(167,Wb,b),data:b}),(d||0===d)&&(e+=d),e+='\n</div>\n<div class="post-body">\n<header>\n',d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.parent),{hash:{},inverse:Ie.program(171,Yb,b),fn:Ie.program(169,Xb,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<span class="bullet" aria-hidden="true">•</span>\n<a href="'+He((d=a&&a.post,d=null==d||d===!1?d:d.url,typeof d===Je?d.apply(a):d))+'" class="time-ago" title="'+He((d=a&&a.post,d=null==d||d===!1?d:d.formattedCreatedAt,typeof d===Je?d.apply(a):d))+'">'+He((d=a&&a.post,d=null==d||d===!1?d:d.relativeCreatedAt,typeof d===Je?d.apply(a):d))+'</a>\n</header>\n<div class="post-message publisher-anchor-color">\n'+He(c.html.call(a,(d=a&&a.post,null==d||d===!1?d:d.message),{hash:{},data:b}))+"\n</div>\n</div>\n</div>\n</li>\n"}function Vb(){return"post-reply"}function Wb(a){var b,c="";return c+='\n<img src="'+He((b=a&&a.post,b=null==b||b===!1?b:b.parent,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.avatar,b=null==b||b===!1?b:b.cache,typeof b===Je?b.apply(a):b))+'" class="target-avatar"/>\n'}function Xb(a,b){var d,e="";return e+="\n"+He(c.gettext.call(a,"%(user)s replied to %(author)s",{hash:{user:c.getPartial.call(a,"profileLink",(d=a&&a.post,null==d||d===!1?d:d.author),{hash:{},data:b}),author:c.getPartial.call(a,"profileLink",(d=a&&a.post,d=null==d||d===!1?d:d.parent,null==d||d===!1?d:d.author),{hash:{},data:b})},data:b}))+"\n"}function Yb(a,b){var d,e="";return e+="\n\n",d=c["with"].call(a,(d=a&&a.post,null==d||d===!1?d:d.author),{hash:{},inverse:Ie.noop,fn:Ie.program(172,Zb,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Zb(a,b){var e,f="";return f+="\n",e=Ie.invokePartial(d.profileLink,"profileLink",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function $b(a){var b,c="";return c+='\n<strong><a href="'+He((b=a&&a.forum,b=null==b||b===!1?b:b.url,typeof b===Je?b.apply(a):b))+'">'+He((b=a&&a.forum,b=null==b||b===!1?b:b.name,typeof b===Je?b.apply(a):b))+"</a></strong>\n"}function _b(a,b){var d,e="";return e+='\n<span class="publisher-anchor-color">\n',d=c["if"].call(a,a&&a.isRegistered,{hash:{},inverse:Ie.program(179,bc,b),fn:Ie.program(177,ac,b),data:b}),(d||0===d)&&(e+=d),e+="\n</span>\n"}function ac(a){var b,c="";return c+='\n<a href="'+He((b=a&&a.profileUrl,typeof b===Je?b.apply(a):b))+'" data-action="profile" data-user="'+He((b=a&&a.id,typeof b===Je?b.apply(a):b))+'">'+He((b=a&&a.name,typeof b===Je?b.apply(a):b))+"</a>\n"}function bc(a){var b,c="";return c+="\n"+He((b=a&&a.name,typeof b===Je?b.apply(a):b))+"\n"}function cc(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:Ie.program(184,ec,b),fn:Ie.program(182,dc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function dc(){return'\n<a href="#" class="notification-container" data-nav="dashboard">\n<span class="notification-icon icon-comment"></span>\n<span class="notification-count" data-role="notification-count" style="display:none"></span>\n</a>\n'}function ec(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canReply),{hash:{},inverse:Ie.noop,fn:Ie.program(185,fc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function fc(){var a="";return a+='\n\n<a href="#" class="notification-container" data-action="auth:disqus">\n<span class="notification-icon icon-disqus"></span>\n'}function gc(a,b){var d="";return d+='\n<div>\n<ul class="notifications" data-role="entries"></ul>\n\n<div data-role="no-notifications" style="display:none">\n'+He(c.gettext.call(a,"You have no notifications.",{hash:{},data:b}))+'\n</div>\n\n<div class="load-more" data-role="more-notifications" style="display:none">\n<a href="#" data-action="more" class="btn">'+He(c.gettext.call(a,"Load more notifications",{hash:{},data:b}))+"</a>\n</div>\n</div>\n"}function hc(a,b){var d,e="";return e+='\n<li class="notification ',d=c.unless.call(a,(d=a&&a.notification,null==d||d===!1?d:d.isRead),{hash:{},inverse:Ie.noop,fn:Ie.program(190,ic,b),data:b}),(d||0===d)&&(e+=d),e+='">\n<div class="indicator"></div>\n\n',d=c["if"].call(a,(d=a&&a.notification,null==d||d===!1?d:d.post),{hash:{},inverse:Ie.program(194,kc,b),fn:Ie.program(192,jc,b),data:b}),(d||0===d)&&(e+=d),e+="\n</li>\n"}function ic(){return"unseen"}function jc(a,b){var d,e="";return e+='\n\n\n<div class="avatar">\n<img src="'+He((d=a&&a.notification,d=null==d||d===!1?d:d.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===Je?d.apply(a):d))+'" />\n</div>\n<p>\n'+He(c.gettext.call(a,"%(user)s has replied to you on %(article)s",{hash:{user:c.getPartial.call(a,"profileLink",(d=a&&a.notification,d=null==d||d===!1?d:d.post,null==d||d===!1?d:d.author),{hash:{},data:b}),article:c.getPartial.call(a,"postLink",(d=a&&a.notification,null==d||d===!1?d:d.post),{hash:{},data:b})},data:b}))+'\n<p class="notification-meta">'+He((d=a&&a.notification,d=null==d||d===!1?d:d.relativeCreatedAt,typeof d===Je?d.apply(a):d))+'\n<span class="bullet" aria-hidden="true">•</span> <a href="'+He((d=a&&a.notification,d=null==d||d===!1?d:d.post,d=null==d||d===!1?d:d.forum,d=null==d||d===!1?d:d.url,typeof d===Je?d.apply(a):d))+'">'+He((d=a&&a.notification,d=null==d||d===!1?d:d.post,d=null==d||d===!1?d:d.forum,d=null==d||d===!1?d:d.name,typeof d===Je?d.apply(a):d))+"</a>\n</p>\n"}function kc(a,b){var d,e="";return e+='\n\n<div class="avatar">\n<img src="https://twimg0-a.akamaihd.net/profile_images/2305121474/zcrps8sb7b8zk6ezamf5.png"/>\n</div>\n<p class="publisher-anchor-color">'+He(c.html.call(a,(d=a&&a.notification,d=null==d||d===!1?d:d.formatted,null==d||d===!1?d:d.text),{hash:{},data:b}))+'</p>\n<p class="notification-meta">\n'+He((d=a&&a.notification,d=null==d||d===!1?d:d.relativeCreatedAt,typeof d===Je?d.apply(a):d))+"\n</p>\n"}function lc(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c["typeof"].call(a,a&&a.url,"undefined",{hash:{},data:b}),{hash:{},inverse:Ie.program(199,nc,b),fn:Ie.program(197,mc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function mc(a,b){var d,e="";return e+="\n"+He(c.html.call(a,(d=a&&a.thread,null==d||d===!1?d:d.title),{hash:{},data:b}))+"\n"}function nc(a,b){var d,e="";return e+='\n<a class="publisher-anchor-color" href="'+He((d=a&&a.url,typeof d===Je?d.apply(a):d))+'">'+He(c.html.call(a,(d=a&&a.thread,null==d||d===!1?d:d.title),{hash:{},data:b}))+"</a>\n"}function oc(a,b){var d,e="";return e+='\n<div class="notice">\n<div class="notice-wrapper">\n<span class="icon icon-disqus"></span>\n<a data-action="onboard" href="#" data-section="'+He((d=a&&a.displayedSection,typeof d===Je?d.apply(a):d))+'" class="message">'+He(c.gettext.call(a,"Your Disqus account has been created! Learn more about using Disqus on your favorite communities.",{hash:{},data:b}))+'</a>\n<a data-action="onboard" href="#" data-section="'+He((d=a&&a.displayedSection,typeof d===Je?d.apply(a):d))+'" class="btn btn-primary">'+He(c.gettext.call(a,"Get Started",{hash:{},data:b}))+'</a>\n</div>\n</div>\n<a class="dismiss" data-action="close" href="#" title=\''+He(c.gettext.call(a,"Dismiss",{hash:{},data:b}))+'\'>Dismiss <span aria-label="Dismiss" class="cross">×</span></a>\n'}function pc(a,b){var e,f="";return f+="\n",e=Ie.invokePartial(d.postWrapperTop,"postWrapperTop",a,c,d,b),(e||0===e)&&(f+=e),f+="\n\n",e=Ie.invokePartial(d.postUserAvatar,"postUserAvatar",a,c,d,b),(e||0===e)&&(f+=e),f+='\n<div class="post-body">\n<header>\n<span class="post-byline">\n',e=c["if"].call(a,(e=a&&a.post,e=null==e||e===!1?e:e.author,null==e||e===!1?e:e.isRegistered),{hash:{},inverse:Ie.program(210,uc,b),fn:Ie.program(204,qc,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n",e=c["if"].call(a,a&&a.parentPost,{hash:{},inverse:Ie.noop,fn:Ie.program(212,vc,b),data:b}),(e||0===e)&&(f+=e),f+='\n</span>\n\n<span class="post-meta">\n<span class="bullet time-ago-bullet" aria-hidden="true">•</span>\n\n',e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.id),{hash:{},inverse:Ie.program(216,xc,b),fn:Ie.program(214,wc,b),data:b}),(e||0===e)&&(f+=e),f+="\n</span>\n\n",e=c["if"].call(a,a&&a.stateByline,{hash:{},inverse:Ie.noop,fn:Ie.program(218,yc,b),data:b}),(e||0===e)&&(f+=e),f+='\n</header>\n\n\n<div class="post-body-inner">\n\n<div class="post-message-container" data-role="message-container">\n\n<div class="publisher-anchor-color" data-role="message-content">\n<div class="post-message ',e=c["if"].call(a,a&&a.loading,{hash:{},inverse:Ie.noop,fn:Ie.program(220,zc,b),data:b}),(e||0===e)&&(f+=e),f+='"\ndata-role="message" dir="auto">\n',e=c["if"].call(a,c.eq.call(a,(e=a&&a.post,null==e||e===!1?e:e.message),"",{hash:{},data:b}),{hash:{},inverse:Ie.program(224,Bc,b),fn:Ie.program(222,Ac,b),data:b}),(e||0===e)&&(f+=e),f+='\n</div>\n\n<span class="post-media"><ul data-role="post-media-list"></ul></span>\n</div>\n</div>\n<a class="see-more hidden" title="'+He(c.gettext.call(a,"see more",{hash:{},data:b}))+'" data-action="see-more">'+He(c.gettext.call(a,"see more",{hash:{},data:b}))+"</a>\n</div>\n\n<footer>\n",e=Ie.invokePartial(d.postFooter,"postFooter",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</footer>\n</div>\n\n",e=Ie.invokePartial(d.postWrapperBottom,"postWrapperBottom",a,c,d,b),(e||0===e)&&(f+=e),f+="\n\n"}function qc(a,b){var d,e="";return e+='\n<span class="author publisher-anchor-color"><a href="#" data-action="profile" data-user="'+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'" data-role="username">'+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.name,typeof d===Je?d.apply(a):d))+"</a></span>\n",d=c["if"].call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.badge),{hash:{},inverse:Ie.program(207,sc,b),fn:Ie.program(205,rc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function rc(a){var b,c="";return c+='\n<span class="badge" data-type="tracked-badge">'+He((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.badge,typeof b===Je?b.apply(a):b))+"</span>\n"}function sc(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canModerate),{hash:{},inverse:Ie.noop,fn:Ie.program(208,tc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function tc(a,b){var d="";return d+='\n<span class="badge moderator">'+He(c.gettext.call(a,"Mod",{hash:{},data:b}))+"</span>\n"}function uc(a){var b,c="";return c+='\n<span class="author">'+He((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.name,typeof b===Je?b.apply(a):b))+"</span>\n"}function vc(a){var b,c="";return c+='\n<span><a href="#comment-'+He((b=a&&a.parentPost,b=null==b||b===!1?b:b.id,typeof b===Je?b.apply(a):b))+'" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> '+He((b=a&&a.parentPost,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.name,typeof b===Je?b.apply(a):b))+"</a></span>\n"}function wc(a){var b,c="";return c+='\n<a href="#comment-'+He((b=a&&a.post,b=null==b||b===!1?b:b.id,typeof b===Je?b.apply(a):b))+'" data-role="relative-time" class="time-ago" title="'+He((b=a&&a.post,b=null==b||b===!1?b:b.formattedCreatedAt,typeof b===Je?b.apply(a):b))+'">\n'+He((b=a&&a.post,b=null==b||b===!1?b:b.relativeCreatedAt,typeof b===Je?b.apply(a):b))+"\n</a>\n"}function xc(a){var b,c="";return c+='\n<span class="time-ago" data-role="relative-time" title="'+He((b=a&&a.post,b=null==b||b===!1?b:b.formattedCreatedAt,typeof b===Je?b.apply(a):b))+'">\n'+He((b=a&&a.post,b=null==b||b===!1?b:b.relativeCreatedAt,typeof b===Je?b.apply(a):b))+"\n</span>\n"}function yc(a){var b,c="";return c+='\n<span class="state-byline state-byline-'+He((b=a&&a.stateByline,b=null==b||b===!1?b:b.style,typeof b===Je?b.apply(a):b))+'">\n<span class="icon-mobile icon-'+He((b=a&&a.stateByline,b=null==b||b===!1?b:b.icon,typeof b===Je?b.apply(a):b))+'" aria-hidden="true"></span>\n<span class="text">\n'+He((b=a&&a.stateByline,b=null==b||b===!1?b:b.text,typeof b===Je?b.apply(a):b))+"\n</span>\n</span>\n"}function zc(){return"loading"}function Ac(a,b){var d="";return d+="\n<p><i>"+He(c.gettext.call(a,"This comment has no content.",{hash:{},data:b}))+"</i></p>\n"}function Bc(a,b){var d,e="";return e+="\n"+He(c.html.call(a,(d=a&&a.post,null==d||d===!1?d:d.message),{hash:{},data:b}))+"\n"}function Cc(a,b){var e,f="";return f+='\n<div data-role="post-content" class="post-content\n',e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.isRealtime),{hash:{},inverse:Ie.noop,fn:Ie.program(227,Dc,b),data:b}),(e||0===e)&&(f+=e),f+="\n",e=c.if_all.call(a,(e=a&&a.session,null==e||e===!1?e:e.isRegistered),c.eq.call(a,(e=a&&a.post,e=null==e||e===!1?e:e.author,null==e||e===!1?e:e.id),(e=a&&a.session,null==e||e===!1?e:e.id),{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(229,Ec,b),data:b}),(e||0===e)&&(f+=e),f+="\n",e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.isFlaggedByUser),{hash:{},inverse:Ie.noop,fn:Ie.program(231,Fc,b),data:b}),(e||0===e)&&(f+=e),f+='\n">\n',e=Ie.invokePartial(d.postMenu,"postMenu",a,c,d,b),(e||0===e)&&(f+=e),f+='\n<div class="indicator"></div>\n'}function Dc(){return"new"}function Ec(){return"authored-by-session-user"}function Fc(){return"user-reported"}function Gc(){var a="";return a+='\n<div data-role="blacklist-form"></div>\n<div class="reply-form-container" data-role="reply-form"></div>\n</div>\n\n\n<ul data-role="children" class="children"/>\n'}function Hc(a,b){var d,e="";return e+='\n\n<div data-role="post-media">\n\n<a class="media-button media-button-expand publisher-color publisher-border-color" href="'+He((d=a&&a.media,d=null==d||d===!1?d:d.url,typeof d===Je?d.apply(a):d))+'" rel="nofollow" target="_blank" data-action="expand"\ntitle="',d=c["if"].call(a,(d=a&&a.media,null==d||d===!1?d:d.title),{hash:{},inverse:Ie.noop,fn:Ie.program(236,Ic,b),data:b}),(d||0===d)&&(e+=d),e+='">\n',d=c["if"].call(a,(d=a&&a.model,null==d||d===!1?d:d.providerIcon),{hash:{},inverse:Ie.noop,fn:Ie.program(239,Kc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"+He((d=a&&a.model,d=null==d||d===!1?d:d.providerExpandMessage,typeof d===Je?d.apply(a):d))+'\n</a>\n<a class="media-button media-button-contract publisher-color publisher-border-color" href="#" target="_blank" data-action="contract">\n<i class="icon-cancel publisher-background-color"></i> '+He((d=a&&a.model,d=null==d||d===!1?d:d.providerCollapseMessage,typeof d===Je?d.apply(a):d))+'\n</a>\n\n<div class="media-content-loader" data-role="content-loader"></div>\n\n<div data-role="content-placeholder" class="media-content-placeholder"></div>\n</div>\n'}function Ic(a,b){var d,e="";return d=c["if"].call(a,(d=a&&a.media,null==d||d===!1?d:d.providerName),{hash:{},inverse:Ie.noop,fn:Ie.program(237,Jc,b),data:b}),(d||0===d)&&(e+=d),e+=He((d=a&&a.media,d=null==d||d===!1?d:d.title,typeof d===Je?d.apply(a):d))}function Jc(a){var b,c="";return c+=He((b=a&&a.media,b=null==b||b===!1?b:b.providerName,typeof b===Je?b.apply(a):b))+" &ndash; "}function Kc(a){var b,c="";return c+='<i class="'+He((b=a&&a.model,b=null==b||b===!1?b:b.providerIcon,typeof b===Je?b.apply(a):b))+' publisher-background-color"></i>'}function Lc(a){var b,c="";return c+='\n<a href="#" class="media-force-load" data-action="force-load"><i class="'+He((b=a&&a.model,b=null==b||b===!1?b:b.providerIcon,typeof b===Je?b.apply(a):b))+'"></i></a>\n'}function Mc(a,b){var d,e="";return e+='\n<a href="'+He((d=a&&a.imageUrl,typeof d===Je?d.apply(a):d))+'" target="_blank" rel="nofollow">\n\n<img src="'+He((d=a&&a.thumbnailUrl,typeof d===Je?d.apply(a):d))+'" data-post="'+He((d=a&&a.postId,typeof d===Je?d.apply(a):d))+'" ',d=c["if"].call(a,(d=a&&a.model,null==d||d===!1?d:d.deferredHeight),{hash:{},inverse:Ie.noop,fn:Ie.program(244,Nc,b),data:b}),(d||0===d)&&(e+=d),e+="/>\n</a>\n"}function Nc(a){var b,c="";return c+=' height="'+He((b=a&&a.model,b=null==b||b===!1?b:b.deferredHeight,typeof b===Je?b.apply(a):b))+'" '}function Oc(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.model,null==d||d===!1?d:d.deferred),{hash:{},inverse:Ie.program(249,Qc,b),fn:Ie.program(247,Pc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Pc(a){var b,c="";return c+='\n\n<a href="'+He((b=a&&a.href,typeof b===Je?b.apply(a):b))+'" rel="nofollow">'+He((b=a&&a.text,typeof b===Je?b.apply(a):b))+"</a>\n"}function Qc(a,b){var d,e="";return e+='\n\n<a href="'+He((d=a&&a.href,typeof d===Je?d.apply(a):d))+'" class="post-media-link" data-action="expand-collapse-media" rel="nofollow">',d=c["if"].call(a,(d=a&&a.model,null==d||d===!1?d:d.providerIcon),{hash:{},inverse:Ie.noop,fn:Ie.program(250,Rc,b),data:b}),(d||0===d)&&(e+=d),e+=He((d=a&&a.mediaLinkText,typeof d===Je?d.apply(a):d)),d=c["if"].call(a,a&&a.domain,{hash:{},inverse:Ie.noop,fn:Ie.program(252,Sc,b),data:b}),(d||0===d)&&(e+=d),e+="</a>\n"}function Rc(a){var b,c="";return c+='<i class="'+He((b=a&&a.model,b=null==b||b===!1?b:b.providerIcon,typeof b===Je?b.apply(a):b))+'"></i>'}function Sc(a){var b,c="";return c+='<span class="post-media-link-domain"> &mdash; '+He((b=a&&a.domain,typeof b===Je?b.apply(a):b))+"</span>"}function Tc(a){var b,c="";return c+='\n<meta name="twitter:widgets:csp" content="on">\n<blockquote class="twitter-tweet" data-theme="'+He((b=a&&a.theme,typeof b===Je?b.apply(a):b))+'" data-link-color="'+He((b=a&&a.linkColor,typeof b===Je?b.apply(a):b))+'" lang="'+He((b=a&&a.language,typeof b===Je?b.apply(a):b))+'">\n<a href="'+He((b=a&&a.url,typeof b===Je?b.apply(a):b))+'"></a>\n</blockquote>\n<script src="//platform.twitter.com/widgets.js"></script>\n'}function Uc(a,b){var d,e="";return e+='\n<a href="#" class="vote-up ',d=c["if"].call(a,c.gt.call(a,(d=a&&a.post,null==d||d===!1?d:d.userScore),0,{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(257,Vc,b),data:b}),(d||0===d)&&(e+=d),e+=" count-"+He((d=a&&a.post,d=null==d||d===!1?d:d.likes,typeof d===Je?d.apply(a):d))+'" data-action="upvote" title="',d=c.unless.call(a,(d=a&&a.post,null==d||d===!1?d:d.likes),{hash:{},inverse:Ie.noop,fn:Ie.program(259,Wc,b),data:b}),(d||0===d)&&(e+=d),e+='">\n<span class="updatable count" data-role="likes">'+He((d=a&&a.post,d=null==d||d===!1?d:d.likes,typeof d===Je?d.apply(a):d))+'</span>\n<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>\n</a>\n<span role="button" class="vote-down ',d=c["if"].call(a,c.lt.call(a,(d=a&&a.post,null==d||d===!1?d:d.userScore),0,{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(261,Xc,b),data:b}),(d||0===d)&&(e+=d),e+=" count-"+He((d=a&&a.post,d=null==d||d===!1?d:d.dislikes,typeof d===Je?d.apply(a):d))+'" ',d=c["if"].call(a,(d=a&&a.session,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:Ie.noop,fn:Ie.program(263,Yc,b),data:b}),(d||0===d)&&(e+=d),e+=' title="'+He(c.gettext.call(a,"Vote down",{hash:{},data:b}))+'">\n',d=c.unless.call(a,a&&a.hideDownvoteNumber,{hash:{},inverse:Ie.noop,fn:Ie.program(265,Zc,b),data:b}),(d||0===d)&&(e+=d),e+='\n<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>\n',d=c["if"].call(a,(d=a&&a.session,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:Ie.program(269,_c,b),fn:Ie.program(267,$c,b),data:b}),(d||0===d)&&(e+=d),e+="\n</span>\n"
}function Vc(){return"upvoted"}function Wc(a,b){return He(c.gettext.call(a,"Vote up",{hash:{},data:b}))}function Xc(){return"downvoted"}function Yc(){return'href="#" data-action="downvote"'}function Zc(a){var b,c="";return c+='\n<span class="updatable count" data-role="dislikes">'+He((b=a&&a.post,b=null==b||b===!1?b:b.dislikes,typeof b===Je?b.apply(a):b))+"</span>\n"}function $c(a,b){var d="";return d+='\n<span class="tooltip">'+He(c.gettext.call(a,"You must sign in to down-vote this post.",{hash:{},data:b}))+"</span>\n"}function _c(a,b){var d="";return d+='\n<span class="tooltip tooltip-disabled" data-role="downvote-tooltip">\n'+He(c.gettext.call(a,"Voting has changed.",{hash:{},data:b}))+'\n<a class="btn-link" target="_blank" data-action="downvote-tooltip-link" href="http://help.disqus.com/customer/portal/articles/658811-how-voting-works">\n'+He(c.gettext.call(a,"Learn more",{hash:{},data:b}))+"\n</a>\n</span>\n"}function ad(a,b){var d,e="";return e+='\n<ul class="post-menu dropdown" data-role="menu">\n<li class="collapse">\n<a href="#" data-action="collapse" title="'+He(c.gettext.call(a,"Collapse",{hash:{},data:b}))+'"><span>−</span></a>\n</li>\n<li class="expand">\n<a href="#" data-action="collapse" title="'+He(c.gettext.call(a,"Expand",{hash:{},data:b}))+'"><span>+</span></a>\n</li>\n\n',d=c.if_all.call(a,(d=a&&a.post,null==d||d===!1?d:d.id),c.ne.call(a,(d=a&&a.post,null==d||d===!1?d:d.isMinimized),!0,{hash:{},data:b}),c.ne.call(a,(d=a&&a.post,null==d||d===!1?d:d.isDeleted),!0,{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(272,bd,b),data:b}),(d||0===d)&&(e+=d),e+="\n</ul>\n"}function bd(a,b){var d,e="";return e+='\n<li class="',d=c["if"].call(a,(d=a&&a.session,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canModerate),{hash:{},inverse:Ie.noop,fn:Ie.program(273,cd,b),data:b}),(d||0===d)&&(e+=d),e+='"\nrole="menu">\n',d=c["if"].call(a,(d=a&&a.session,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canModerate),{hash:{},inverse:Ie.program(284,id,b),fn:Ie.program(275,dd,b),data:b}),(d||0===d)&&(e+=d),e+="\n</li>\n"}function cd(){return"moderator-menu-options"}function dd(a,b){var d,e="";return e+='\n<a class="dropdown-toggle" data-toggle="dropdown" href="#"><b\nclass="caret moderator-menu-options"></b></a>\n<ul class="dropdown-menu">\n<li><a href="#" data-action="spam">'+He(c.gettext.call(a,"Mark as Spam",{hash:{},data:b}))+'</a></li>\n<li><a href="#" data-action="delete">'+He(c.gettext.call(a,"Delete",{hash:{},data:b}))+'</a> </li>\n<li><a href="#" data-action="blacklist">'+He(c.gettext.call(a,"Blacklist",{hash:{},data:b}))+'</a> </li>\n<li>\n<a href="'+He(c.g.call(a,"urls.moderate",{hash:{},data:b}))+"#/approved/search/id:"+He((d=a&&a.post,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'"\ntarget="_blank">'+He(c.gettext.call(a,"Moderate",{hash:{},data:b}))+'</a>\n</li>\n\n<li class="highlight-toggle">\n<a href="#"\ndata-action="',d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.isHighlighted),{hash:{},inverse:Ie.program(278,fd,b),fn:Ie.program(276,ed,b),data:b}),(d||0===d)&&(e+=d),e+='">\n',d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.isHighlighted),{hash:{},inverse:Ie.program(282,hd,b),fn:Ie.program(280,gd,b),data:b}),(d||0===d)&&(e+=d),e+="\n</a>\n</li>\n</ul>\n"}function ed(){return"unhighlight"}function fd(){return"highlight"}function gd(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"Stop featuring",{hash:{},data:b}))+"\n"}function hd(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"Feature this comment",{hash:{},data:b}))+"\n"}function id(a,b){var d,e="";return e+="\n",d=c.if_all.call(a,(d=a&&a.session,null==d||d===!1?d:d.isRegistered),(d=a&&a.post,null==d||d===!1?d:d.author),c.eq.call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.id),(d=a&&a.session,null==d||d===!1?d:d.id),{hash:{},data:b}),{hash:{},inverse:Ie.program(287,kd,b),fn:Ie.program(285,jd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function jd(a,b){var d="";return d+='\n<a class="dropdown-toggle" data-toggle="dropdown"\nhref="#"><b class="caret"></b></a>\n<ul class="dropdown-menu">\n<li><a href="#" data-action="delete">'+He(c.gettext.call(a,"Delete",{hash:{},data:b}))+'</a></li>\n<li><a href="#" data-action="flag">'+He(c.gettext.call(a,"Flag as inappropriate",{hash:{},data:b}))+"</a></li>\n</ul>\n"}function kd(a,b){var d="";return d+='\n<a class="dropdown-toggle" href="#" data-action="flag"\ndata-role="flag" title="'+He(c.gettext.call(a,"Flag as inappropriate",{hash:{},data:b}))+'">\n<i aria-hidden="true" class="icon icon-flag"></i>\n</a>\n'}function ld(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.id),{hash:{},inverse:Ie.noop,fn:Ie.program(290,md,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function md(a,b){var e,f="";return f+='\n<menu>\n\n<li class="voting" data-role="voting">\n',e=Ie.invokePartial(d.postVotes,"postVotes",a,c,d,b),(e||0===e)&&(f+=e),f+='\n</li>\n<li class="bullet" aria-hidden="true">•</li>\n\n',e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.canBeEdited),{hash:{},inverse:Ie.noop,fn:Ie.program(291,nd,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n",e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.canBeRepliedTo),{hash:{},inverse:Ie.noop,fn:Ie.program(293,od,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n",e=c.unless.call(a,(e=a&&a.post,null==e||e===!1?e:e.isDeleted),{hash:{},inverse:Ie.noop,fn:Ie.program(295,pd,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n</menu>\n"}function nd(a,b){var d="";return d+='\n<li class="edit" data-role="edit-link">\n<a href="#" data-action="edit">\n<i class="icon icon-mobile icon-pencil"></i><span class="text">'+He(c.gettext.call(a,"Edit",{hash:{},data:b}))+'</span></a></li>\n<li class="bullet" aria-hidden="true">•</li>\n'}function od(a,b){var d="";return d+='\n<li class="reply" data-role="reply-link">\n<a href="#" data-action="reply">\n<i class="icon icon-mobile icon-reply"></i><span class="text">'+He(c.gettext.call(a,"Reply",{hash:{},data:b}))+'</span></a></li>\n<li class="bullet" aria-hidden="true">•</li>\n'}function pd(a,b){var d,e="";return e+='\n<li class="share">\n<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">'+He(c.gettext.call(a,"Share",{hash:{},data:b}))+' ›</span></a>\n<ul>\n<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>\n<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>\n<li class="link"><a href="#comment-'+He((d=a&&a.post,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'">'+He(c.gettext.call(a,"Link",{hash:{},data:b}))+'</a></li>\n</ul>\n</li>\n\n<li class="realtime" data-role="realtime-notification:'+He((d=a&&a.post,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'">\n<span style="display:none;" class="realtime-replies"></span>\n<a style="display:none;" href="#" class="btn btn-small"></a>\n\n</li>\n'}function qd(a,b){var d,e="";return e+="\n",d=c.if_all.call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isRegistered),c.ne.call(a,(d=a&&a.post,null==d||d===!1?d:d.isMinimized),!0,{hash:{},data:b}),{hash:{},inverse:Ie.program(300,sd,b),fn:Ie.program(298,rd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function rd(a,b){var d,e="";return e+='\n<div class="avatar hovercard">\n<a href="'+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.profileUrl,typeof d===Je?d.apply(a):d))+'" class="user"\ndata-action="profile" data-user="'+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'">\n<img data-role="user-avatar" data-user="'+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'" src="'+He((d=a&&a.defaultAvatarUrl,typeof d===Je?d.apply(a):d))+'" data-src="'+He((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===Je?d.apply(a):d))+'"\nalt="'+He(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/>\n</a>\n</div>\n'}function sd(a,b){var d,e="";return e+='\n<div class="avatar">\n\n<div class="user"><img src="'+He((d=a&&a.defaultAvatarUrl,typeof d===Je?d.apply(a):d))+'"\nclass="user" alt="'+He(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/></div>\n</div>\n'}function td(a,b){var d="";return d+="\n\n"+He(c.gettext.call(a,"You've featured a comment! This comment will now also appear at the top of the discussion.",{hash:{},data:b}))+"\n"}function ud(a,b){var e,f="";return f+="\n",e=Ie.invokePartial(d.postWrapperTop,"postWrapperTop",a,c,d,b),(e||0===e)&&(f+=e),f+='\n\n<div class="avatar">\n<img data-src="'+He(c.g.call(a,"urls.avatar.generic",{hash:{},data:b}))+'" class="user" alt="'+He(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'" />\n</div>\n<div class="post-body">\n<div class="post-message">\n<p>'+He(c.gettext.call(a,"This comment was deleted.",{hash:{},data:b}))+'</p>\n</div>\n\n<header>\n<div class="post-meta">\n\n'+He(c.gettext.call(a,"This comment was deleted.",{hash:{},data:b}))+"\n</div>\n\n",e=Ie.invokePartial(d.postMenu,"postMenu",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</header>\n</div>\n\n",e=Ie.invokePartial(d.postWrapperBottom,"postWrapperBottom",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function vd(a,b){var e,f="";return f+="\n",e=Ie.invokePartial(d.postWrapperTop,"postWrapperTop",a,c,d,b),(e||0===e)&&(f+=e),f+="\n\n",e=Ie.invokePartial(d.postUserAvatar,"postUserAvatar",a,c,d,b),(e||0===e)&&(f+=e),f+='\n<div class="post-body">\n<div class="post-message publisher-anchor-color">\n',e=c.if_any.call(a,a&&a.created,(e=a&&a.post,null==e||e===!1?e:e.isApproved),{hash:{},inverse:Ie.program(312,zd,b),fn:Ie.program(307,wd,b),data:b}),(e||0===e)&&(f+=e),f+='\n</div>\n\n<header>\n<div class="post-meta">\n\n'+He(c.gettext.call(a,"This comment is awaiting moderation.",{hash:{},data:b}))+"\n</div>\n\n",e=Ie.invokePartial(d.postMenu,"postMenu",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</header>\n</div>\n\n",e=Ie.invokePartial(d.postWrapperBottom,"postWrapperBottom",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function wd(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.isApproved),{hash:{},inverse:Ie.program(310,yd,b),fn:Ie.program(308,xd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function xd(a,b){var d="";return d+="\n<p>"+He(c.gettext.call(a,"Comment score below threshold.",{hash:{},data:b}))+' <a href="#" data-action="reveal">'+He(c.gettext.call(a,"Show comment.",{hash:{},data:b}))+"</a></p>\n"}function yd(a,b){var d="";return d+="\n<p>"+He(c.gettext.call(a,"Your comment is awaiting moderation.",{hash:{},data:b}))+' <a href="#" data-action="reveal">'+He(c.gettext.call(a,"See your comment.",{hash:{},data:b}))+'</a>  <a href="http://help.disqus.com/customer/portal/articles/466223" class="help-icon" title="'+He(c.gettext.call(a,"Why?",{hash:{},data:b}))+'" target="_blank"></a> </p>\n'}function zd(a,b){var d="";return d+="\n\n<p>"+He(c.gettext.call(a,"This comment is awaiting moderation.",{hash:{},data:b}))+' <a href="#" data-action="reveal">'+He(c.gettext.call(a,"Show comment.",{hash:{},data:b}))+"</a></p>\n"}function Ad(a,b){var d="";return d+='\n<a href="#" class="btn btn-small play pause" data-action="realtime:toggle"><span></span>'+He(c.gettext.call(a,"Realtime",{hash:{},data:b}))+"</a>\n"}function Bd(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.comments,1,{hash:{},data:b}),{hash:{},inverse:Ie.program(319,Dd,b),fn:Ie.program(317,Cd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Cd(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"Show One New Comment",{hash:{},data:b}))+"\n"}function Dd(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"Show %(comments)s New Comments",{hash:{comments:a&&a.comments},data:b}))+"\n"}function Ed(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.replies,1,{hash:{},data:b}),{hash:{},inverse:Ie.program(324,Gd,b),fn:Ie.program(322,Fd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Fd(a,b){var d="";return d+='\n<span class="indicator"></span>'+He(c.gettext.call(a,"Show 1 new reply",{hash:{},data:b}))+"\n"}function Gd(a,b){var d="";return d+='\n<span class="indicator"></span>'+He(c.gettext.call(a,"Show %(replies)s new replies",{hash:{replies:a&&a.replies},data:b}))+"\n"}function Hd(a,b){var d,e="";return e+="\n<!doctype html>\n\n<html>\n<style>\nhtml * {\nmargin: 0;\npadding: 0;\ncursor: pointer;\n}\n\ndiv {\ntext-align: center;\nfont-family: \"Helvetica Neue\", Helvetica, sans-serif;\nborder: 2px solid #ccc;\nbackground: #f4f4f4;\nbackground-color: rgba(248, 248, 248, 0.98);\nbackground-repeat: repeat-x;\nbackground-image: -khtml-gradient(linear, left top, left bottom, from(rgba(253, 253, 253, 0.8)), to(rgba(248, 248, 248, 0.98)));\nbackground-image: -moz-linear-gradient(top, rgba(253, 253, 253, 0.8), rgba(248, 248, 248, 0.98));\nbackground-image: -ms-linear-gradient(top, rgba(253, 253, 253, 0.8), rgba(248, 248, 248, 0.98));\nbackground-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, rgba(253, 253, 253, 0.8)), color-stop(100%, rgba(248, 248, 248, 0.98)));\nbackground-image: -webkit-linear-gradient(top, rgba(253, 253, 253, 0.8), rgba(248, 248, 248, 0.98));\nbackground-image: -o-linear-gradient(top, rgba(253, 253, 253, 0.8), rgba(248, 248, 248, 0.98));\nbackground-image: linear-gradient(top, rgba(253, 253, 253, 0.8), rgba(248, 248, 248, 0.98));\nfilter: progid:DXImageTransform.Microsoft.gradient(startColorstr='rgba(253, 253, 253, 0.8)', endColorstr='rgba(248, 248, 248, 0.98)', GradientType=0);\n-webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);\n-moz-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);\nbox-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);\ncolor: #777;\npadding: 7px 0;\nmargin: 0;\nfilter: alpha(opacity=90);\n-khtml-opacity: 0.9;\n-moz-opacity: 0.9;\nopacity: 0.9;\ncursor: pointer;\nfont-size: 13px;\nline-height: 1;\nz-index: 1000;\n}\n\ndiv.north {\nborder-top: 0;\n-webkit-border-radius: 0 0 4px 4px;\n-moz-border-radius: 0 0 4px 4px;\nborder-radius: 0 0 4px 4px;\n}\n\ndiv.south {\nborder-bottom: 0;\n-webkit-border-radius: 4px 4px 0 0;\n-moz-border-radius: 4px 4px 0 0;\nborder-radius: 4px 4px 0 0;\n}\n</style>\n\n<div class=\""+He((d=a&&a.orientation,typeof d===Je?d.apply(a):d))+'" id="message">'+He(c.gettext.call(a,"This text should be here.",{hash:{},data:b}))+"</div>\n</html>\n"}function Id(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.orientation,"north",{hash:{},data:b}),{hash:{},inverse:Ie.program(334,Md,b),fn:Ie.program(329,Jd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Jd(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.num,1,{hash:{},data:b}),{hash:{},inverse:Ie.program(332,Ld,b),fn:Ie.program(330,Kd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Kd(a,b){var d="";return d+="\n<p>"+He(c.gettext.call(a,"One new comment above.",{hash:{},data:b}))+"</p>\n"}function Ld(a,b){var d="";return d+="\n<p>"+He(c.gettext.call(a,"%(num)s new comments above.",{hash:{num:a&&a.num},data:b}))+"</p>\n"}function Md(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.num,1,{hash:{},data:b}),{hash:{},inverse:Ie.program(337,Od,b),fn:Ie.program(335,Nd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Nd(a,b){var d="";return d+="\n<p>"+He(c.gettext.call(a,"One new comment below.",{hash:{},data:b}))+"</p>\n"}function Od(a,b){var d="";return d+="\n<p>"+He(c.gettext.call(a,"%(num)s new comments below.",{hash:{num:a&&a.num},data:b}))+"</p>\n"}function Pd(a,b){var d="";return d+='\n<ul class="suggestions">\n<li class="header">\n<h5>'+He(c.gettext.call(a,"in this conversation",{hash:{},data:b}))+"</h5>\n</li>\n</ul>\n"}function Qd(a,b){var d,e="";return e+='\n<li data-cid="'+He((d=a&&a.cid,typeof d===Je?d.apply(a):d))+'">\n<img src="'+He((d=a&&a.avatar,d=null==d||d===!1?d:d.cache,typeof d===Je?d.apply(a):d))+'" class="avatar">\n<span>'+He(c.any.call(a,a&&a.name,a&&a.username,{hash:{},data:b}))+"</span>\n</li>\n"}function Rd(a,b){var d,e="";return e+='\n<div>\n<div class="avatar">\n',d=c["if"].call(a,(d=a&&a.author,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:Ie.program(346,Td,b),fn:Ie.program(344,Sd,b),data:b}),(d||0===d)&&(e+=d),e+="\n</div>\n\n<div>\n<p>\n<strong>\n",d=c["if"].call(a,(d=a&&a.author,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:Ie.program(350,Vd,b),fn:Ie.program(348,Ud,b),data:b}),(d||0===d)&&(e+=d),e+="\n</strong>\n&mdash; "+He(c.html.call(a,a&&a.message,{hash:{},data:b}))+"\n</p>\n</div>\n</div>\n"}function Sd(a,b){var d,e="";return e+='\n<a href="'+He((d=a&&a.author,d=null==d||d===!1?d:d.profileUrl,typeof d===Je?d.apply(a):d))+'" class="user" data-action="profile" data-user="'+He((d=a&&a.author,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'">\n<img data-src="'+He((d=a&&a.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===Je?d.apply(a):d))+'" alt="'+He(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/>\n</a>\n'}function Td(a,b){var d,e="";return e+='\n<div class="user">\n<img data-src="'+He((d=a&&a.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===Je?d.apply(a):d))+'" class="user" alt="'+He(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/>\n</div>\n'}function Ud(a,b){var d,e="";return e+='\n<a href="'+He((d=a&&a.author,d=null==d||d===!1?d:d.profileUrl,typeof d===Je?d.apply(a):d))+'" class="user" data-action="profile" data-user="'+He((d=a&&a.author,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'">\n'+He(c.any.call(a,(d=a&&a.author,null==d||d===!1?d:d.name),(d=a&&a.author,null==d||d===!1?d:d.username),{hash:{},data:b}))+"</a>\n"}function Vd(a,b){var d,e="";return e+='\n<span class="user">'+He(c.any.call(a,(d=a&&a.author,null==d||d===!1?d:d.name),(d=a&&a.author,null==d||d===!1?d:d.username),{hash:{},data:b}))+"</span>\n"}function Wd(a,b){var e,f="";return f+='\n<li class="top-user">\n<div class="avatar">\n',e=c["if"].call(a,(e=a&&a.user,null==e||e===!1?e:e.isRegistered),{hash:{},inverse:Ie.program(355,Yd,b),fn:Ie.program(353,Xd,b),data:b}),(e||0===e)&&(f+=e),f+='\n</div>\n\n<div class="profile-card-text">\n<h5>\n<span>\n',e=c["if"].call(a,(e=a&&a.user,null==e||e===!1?e:e.isRegistered),{hash:{},inverse:Ie.program(359,$d,b),fn:Ie.program(357,Zd,b),data:b}),(e||0===e)&&(f+=e),f+='\n</span>\n</h5>\n\n<span class="post-count">\n',e=c["if"].call(a,c.eq.call(a,(e=a&&a.user,null==e||e===!1?e:e.numPosts),1,{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(122,xb,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n",e=c["if"].call(a,c.ge.call(a,(e=a&&a.user,null==e||e===!1?e:e.numPosts),2,{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(124,yb,b),data:b}),(e||0===e)&&(f+=e),f+="\n</span>\n\n",e=Ie.invokePartial(d.followButtonSmall,"followButtonSmall",a,c,d,b),(e||0===e)&&(f+=e),f+="\n\n</div>\n</li>\n"}function Xd(a,b){var d,e="";return e+='\n<a href="#" class="user" data-action="profile" data-user="'+He((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'">\n<img data-role="user-avatar" data-user="'+He((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'" data-src="'+He((d=a&&a.user,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===Je?d.apply(a):d))+'" alt="'+He(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/>\n</a>\n'}function Yd(a,b){var d,e="";return e+='\n<div class="user">\n<img data-src="'+He((d=a&&a.user,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===Je?d.apply(a):d))+'" class="user" alt="'+He(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/>\n</div>\n'}function Zd(a,b){var d,e="";return e+='\n<a href="'+He((d=a&&a.user,d=null==d||d===!1?d:d.profileUrl,typeof d===Je?d.apply(a):d))+'" data-action="profile" data-user="'+He((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'" data-role="username">\n'+He(c.any.call(a,(d=a&&a.user,null==d||d===!1?d:d.name),(d=a&&a.user,null==d||d===!1?d:d.username),{hash:{},data:b}))+"</a>\n"}function $d(a,b){var d,e="";return e+="\n"+He(c.any.call(a,(d=a&&a.author,null==d||d===!1?d:d.name),(d=a&&a.author,null==d||d===!1?d:d.username),{hash:{},data:b}))+"\n"}function _d(a,b){var d,e="";return e+='\n<li data-role="thread-'+He((d=a&&a.id,typeof d===Je?d.apply(a):d))+'">\n\n\n\n<h4><span class="publisher-anchor-color"><a href="'+He((d=a&&a.url,typeof d===Je?d.apply(a):d))+'">'+He(c.html.call(a,a&&a.title,{hash:{},data:b}))+'</a></span></h4>\n\n<ul class="meta">\n<li class="likes">\n<a href="'+He((d=a&&a.url,typeof d===Je?d.apply(a):d))+'">\n<span class="icon-star"></span>\n'+He(c.gettext.call(a,"%(numLikes)s starred this",{hash:{numLikes:a&&a.numLikes},data:b}))+"\n</a>\n</li>\n\n",d=c["if"].call(a,c.gt.call(a,a&&a.numPosts,0,{hash:{},data:b}),{hash:{},inverse:Ie.noop,fn:Ie.program(362,ae,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<li class="bullet">•</li>\n\n<li class="time">'+He((d=a&&a.timeAgo,typeof d===Je?d.apply(a):d))+'</li>\n</ul>\n\n<div class="top-thread-post" data-role="top-thread-post">\n\n</div>\n</li>\n'}function ae(a,b){var d,e="";return e+='\n<li class="bullet">•</li>\n\n<li class="comments">\n<a href="'+He((d=a&&a.url,typeof d===Je?d.apply(a):d))+'">\n',d=c["if"].call(a,c.eq.call(a,a&&a.numPosts,1,{hash:{},data:b}),{hash:{},inverse:Ie.program(363,be,b),fn:Ie.program(122,xb,b),data:b}),(d||0===d)&&(e+=d),e+="\n</a>\n</li>\n"}function be(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"%(numPosts)s comments",{hash:{numPosts:a&&a.numPosts},data:b}))+"\n"}function ce(a,b){var d,e="";return e+='\n<div class="tooltip upvoters ',d=c.unless.call(a,(d=a&&a.users,null==d||d===!1?d:d.length),{hash:{},inverse:Ie.noop,fn:Ie.program(366,de,b),data:b}),(d||0===d)&&(e+=d),e+='">\n<ul class="scroll-measure" data-role="content">\n',d=c["if"].call(a,(d=a&&a.users,null==d||d===!1?d:d.length),{hash:{},inverse:Ie.program(371,ge,b),fn:Ie.program(368,ee,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n",d=c["if"].call(a,a&&a.guestCount,{hash:{},inverse:Ie.noop,fn:Ie.program(374,ie,b),data:b}),(d||0===d)&&(e+=d),e+='\n</ul>\n</div>\n<div class="tooltip-point hidden"></div>\n'}function de(){return"guests-only"}function ee(a,b){var d,e="";return e+="\n",d=c.each.call(a,a&&a.users,{hash:{},inverse:Ie.noop,fn:Ie.program(369,fe,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function fe(a,b){var e,f="";return f+="\n",e=Ie.invokePartial(d.upvoter,"upvoter",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function ge(a,b){var d,e="";return e+="\n",d=c["if"].call(a,a&&a.isLoading,{hash:{},inverse:Ie.noop,fn:Ie.program(372,he,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function he(){return'\n<li class="loading"></li>\n'}function ie(a,b){var e,f="";return f+="\n",e=Ie.invokePartial(d.guestUpvoter,"guestUpvoter",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function je(a,b){var d,e="";return e+='\n<li class="user ',d=c["if"].call(a,a&&a.highlight,{hash:{},inverse:Ie.noop,fn:Ie.program(278,fd,b),data:b}),(d||0===d)&&(e+=d),e+='" data-action="profile" data-user="'+He((d=a&&a.id,typeof d===Je?d.apply(a):d))+'">\n\n<a class="avatar" href="#" title="'+He((d=a&&a.name,typeof d===Je?d.apply(a):d))+'">\n<img src="'+He((d=a&&a.avatar,d=null==d||d===!1?d:d.cache,typeof d===Je?d.apply(a):d))+'" alt="'+He(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'" />\n</a>\n<a class="username" href="#" title="'+He((d=a&&a.name,typeof d===Je?d.apply(a):d))+'">\n'+He((d=a&&a.name,typeof d===Je?d.apply(a):d))+"\n</a>\n</li>\n"}function ke(a,b){var d,e="";return e+="\n",d=c["if"].call(a,a&&a.guestCount,{hash:{},inverse:Ie.noop,fn:Ie.program(379,le,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function le(a,b){var e,f="";return f+='\n<li class="user ',e=c["if"].call(a,a&&a.highlight,{hash:{},inverse:Ie.noop,fn:Ie.program(278,fd,b),data:b}),(e||0===e)&&(f+=e),f+='" data-role="guest">\n<span class="avatar" title="',e=Ie.invokePartial(d.guestUpvoterText,"guestUpvoterText",a,c,d,b),(e||0===e)&&(f+=e),f+='">\n<img src="'+He((e=a&&a.guestAvatarUrl,typeof e===Je?e.apply(a):e))+'" alt="'+He(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'" />\n</span>\n<span class="username" title="',e=Ie.invokePartial(d.guestUpvoterText,"guestUpvoterText",a,c,d,b),(e||0===e)&&(f+=e),f+='">\n',e=Ie.invokePartial(d.guestUpvoterText,"guestUpvoterText",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</span>\n</li>\n"}function me(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.gt.call(a,a&&a.guestCount,1,{hash:{},data:b}),{hash:{},inverse:Ie.program(384,oe,b),fn:Ie.program(382,ne,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function ne(a,b){var d="";return d+=" "+He(c.gettext.call(a,"%(guestCount)s Guest Votes",{hash:{guestCount:a&&a.guestCount},data:b}))+" "}function oe(a,b){var d="";return d+=" "+He(c.gettext.call(a,"1 Guest Vote",{hash:{},data:b}))+" "}function pe(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canReply),{hash:{},inverse:Ie.noop,fn:Ie.program(387,qe,b),data:b}),(d||0===d)&&(e+=d),e+='\n<ul class="dropdown-menu">\n',d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:Ie.program(395,ve,b),fn:Ie.program(392,te,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n",d=c["if"].call(a,(d=a&&a.user,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canModerate),{hash:{},inverse:Ie.noop,fn:Ie.program(398,xe,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isGlobalAdmin),{hash:{},inverse:Ie.noop,fn:Ie.program(409,De,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n",d=c.if_all.call(a,(d=a&&a.user,null==d||d===!1?d:d.isRegistered),(d=a&&a.user,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canReply),{hash:{},inverse:Ie.noop,fn:Ie.program(411,Ee,b),data:b}),(d||0===d)&&(e+=d),e+="\n</ul>\n"}function qe(a,b){var d,e="";return e+='\n\n<a href="#" class="dropdown-toggle" data-toggle="dropdown">\n<span class="dropdown-toggle-wrapper">\n\n',d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:Ie.program(390,se,b),fn:Ie.program(388,re,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n</span> <span class="caret"></span>\n</a>\n'}function re(a,b){var d,e="";return e+='\n<span class="avatar">\n<img data-role="user-avatar" data-user="'+He((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'" data-src="'+He((d=a&&a.user,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===Je?d.apply(a):d))+'"/>\n</span>\n<span class="username" data-role="username" data-user="'+He((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'">\n'+He(c.any.call(a,(d=a&&a.user,null==d||d===!1?d:d.name),(d=a&&a.user,null==d||d===!1?d:d.username),{hash:{},data:b}))+"\n</span>\n"}function se(a,b){var d="";return d+="\n<span>\n"+He(c.gettext.call(a,"Login",{hash:{},data:b}))+"\n</span>\n"}function te(a,b){var d,e="";return e+='\n<li>\n<a href="'+He((d=a&&a.user,d=null==d||d===!1?d:d.profileUrl,typeof d===Je?d.apply(a):d))+'" data-role="user-profile-link" data-action="profile" data-user="'+He((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===Je?d.apply(a):d))+'">\n'+He(c.gettext.call(a,"Your Profile",{hash:{},data:b}))+'\n</a>\n</li>\n<li>\n<a href="#" class="media-toggle-on" data-action="toggle-media">'+He(c.gettext.call(a,"Display Media",{hash:{},data:b}))+'</a>\n<a href="#" class="media-toggle-off" data-action="toggle-media">'+He(c.gettext.call(a,"Hide Media",{hash:{},data:b}))+"</a>\n</li>\n",d=c.unless.call(a,(d=a&&a.user,null==d||d===!1?d:d.remote),{hash:{},inverse:Ie.noop,fn:Ie.program(393,ue,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function ue(a,b){var d="";return d+='\n\n<li>\n<a href="'+He(c.g.call(a,"urls.editProfile",{hash:{},data:b}))+'">'+He(c.gettext.call(a,"Edit Settings",{hash:{},data:b}))+"</a>\n</li>\n"}function ve(a,b){var d,e="";return e+="\n\n",d=c["if"].call(a,(d=a&&a.sso,null==d||d===!1?d:d.url),{hash:{},inverse:Ie.noop,fn:Ie.program(396,we,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<li>\n<a href="#" data-action="auth:disqus">Disqus</a>\n</li>\n<li>\n<a href="#" data-action="auth:facebook">Facebook</a>\n</li>\n<li>\n<a href="#" data-action="auth:twitter">Twitter</a>\n</li>\n<li>\n<a href="#" data-action="auth:google">Google</a>\n</li>\n'}function we(a){var b,c="";return c+='\n<li class="sso">\n<a href="#" data-action="auth:sso">'+He((b=a&&a.sso,b=null==b||b===!1?b:b.name,typeof b===Je?b.apply(a):b))+"</a>\n</li>\n"}function xe(a,b){var d,e="";return e+='\n<li data-role="toggle-thread">\n<a href="#" data-action="',d=c["if"].call(a,(d=a&&a.thread,null==d||d===!1?d:d.isClosed),{hash:{},inverse:Ie.program(401,ze,b),fn:Ie.program(399,ye,b),data:b}),(d||0===d)&&(e+=d),e+='-thread">\n',d=c["if"].call(a,(d=a&&a.thread,null==d||d===!1?d:d.isClosed),{hash:{},inverse:Ie.program(405,Be,b),fn:Ie.program(403,Ae,b),data:b}),(d||0===d)&&(e+=d),e+="\n</a>\n</li>\n\n",d=c.unless.call(a,(d=a&&a.user,null==d||d===!1?d:d.isGlobalAdmin),{hash:{},inverse:Ie.noop,fn:Ie.program(407,Ce,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n"}function ye(){return"open"}function ze(){return"close"}function Ae(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"Open Thread",{hash:{},data:b}))+"\n"}function Be(a,b){var d="";return d+="\n"+He(c.gettext.call(a,"Close Thread",{hash:{},data:b}))+"\n"}function Ce(a,b){var d="";return d+='\n<li>\n<a href="http://docs.disqus.com/kb/2012/">'+He(c.gettext.call(a,"Help",{hash:{},data:b}))+"</a>\n</li>\n"}function De(a,b){var d="";return d+='\n<li>\n<a href="#" data-action="debug">'+He(c.gettext.call(a,"Debug",{hash:{},data:b}))+'</a>\n</li>\n\n<li>\n<a href="#" data-action="repair">'+He(c.gettext.call(a,"Repair",{hash:{},data:b}))+"</a>\n</li>\n"}function Ee(a,b){var d,e="";return e+='\n<li>\n<a href="'+He((d=a&&a.user,d=null==d||d===!1?d:d.logoutUrl,typeof d===Je?d.apply(a):d))+'" data-action="logout">'+He(c.gettext.call(a,"Logout",{hash:{},data:b}))+"</a>\n</li>\n"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),d=this.merge(d,a.partials),e=e||{};var Fe,Ge="",He=this.escapeExpression,Ie=this,Je="function";return Fe=c.partial.call(b,"followButton",{hash:{},inverse:Ie.noop,fn:Ie.program(1,f,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"alert",{hash:{},inverse:Ie.noop,fn:Ie.program(12,n,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"blacklist",{hash:{},inverse:Ie.noop,fn:Ie.program(17,q,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"blacklistErrorMessage",{hash:{},inverse:Ie.noop,fn:Ie.program(20,s,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"captcha",{hash:{},inverse:Ie.noop,fn:Ie.program(22,t,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n\n\n",Fe=c.partial.call(b,"communityForum",{hash:{},inverse:Ie.noop,fn:Ie.program(24,u,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"community",{hash:{},inverse:Ie.noop,fn:Ie.program(26,v,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"contextCard",{hash:{},inverse:Ie.noop,fn:Ie.program(28,w,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n\n\n",Fe=c.partial.call(b,"dashboard",{hash:{},inverse:Ie.noop,fn:Ie.program(39,C,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"edit",{hash:{},inverse:Ie.noop,fn:Ie.program(41,D,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"followButtonSmall",{hash:{},inverse:Ie.noop,fn:Ie.program(43,E,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"formUser",{hash:{},inverse:Ie.noop,fn:Ie.program(56,N,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"form",{hash:{},inverse:Ie.noop,fn:Ie.program(58,O,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"loginButtons",{hash:{},inverse:Ie.noop,fn:Ie.program(78,$,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"guestForm",{hash:{},inverse:Ie.noop,fn:Ie.program(88,eb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"audienceSync",{hash:{},inverse:Ie.noop,fn:Ie.program(103,mb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"mediaUpload",{hash:{},inverse:Ie.noop,fn:Ie.program(105,nb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"legacyMediaUpload",{hash:{},inverse:Ie.noop,fn:Ie.program(110,qb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"highlightedPost",{hash:{},inverse:Ie.noop,fn:Ie.program(112,rb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"hovercard",{hash:{},inverse:Ie.noop,fn:Ie.program(114,sb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"hovercardCounters",{hash:{},inverse:Ie.noop,fn:Ie.program(121,wb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"hovercardActions",{hash:{},inverse:Ie.noop,fn:Ie.program(130,Bb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n\n\n",Fe=c.partial.call(b,"layout",{hash:{},inverse:Ie.noop,fn:Ie.program(133,Db,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postSort",{hash:{},inverse:Ie.noop,fn:Ie.program(135,Eb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postCount",{hash:{},inverse:Ie.noop,fn:Ie.program(144,Jb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"topNavigation",{hash:{},inverse:Ie.noop,fn:Ie.program(147,Lb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"threadVotes",{hash:{},inverse:Ie.noop,fn:Ie.program(152,Ob,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"mainNavigation",{hash:{},inverse:Ie.noop,fn:Ie.program(154,Pb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"makerstudiosad",{hash:{},inverse:Ie.noop,fn:Ie.program(156,Qb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"makerstudiosvideo",{hash:{},inverse:Ie.noop,fn:Ie.program(158,Rb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"networkActivity",{hash:{},inverse:Ie.noop,fn:Ie.program(160,Sb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"networkActivityThreadEntry",{hash:{},inverse:Ie.noop,fn:Ie.program(162,Tb,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"networkActivityPostEntry",{hash:{},inverse:Ie.noop,fn:Ie.program(164,Ub,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"networkForumLink",{hash:{},inverse:Ie.noop,fn:Ie.program(174,$b,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"profileLink",{hash:{},inverse:Ie.noop,fn:Ie.program(176,_b,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"notificationMenu",{hash:{},inverse:Ie.noop,fn:Ie.program(181,cc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"notifications",{hash:{},inverse:Ie.noop,fn:Ie.program(187,gc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"notification",{hash:{},inverse:Ie.noop,fn:Ie.program(189,hc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postLink",{hash:{},inverse:Ie.noop,fn:Ie.program(196,lc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"onboard",{hash:{},inverse:Ie.noop,fn:Ie.program(201,oc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"post",{hash:{},inverse:Ie.noop,fn:Ie.program(203,pc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postWrapperTop",{hash:{},inverse:Ie.noop,fn:Ie.program(226,Cc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postWrapperBottom",{hash:{},inverse:Ie.noop,fn:Ie.program(233,Gc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postMedia",{hash:{},inverse:Ie.noop,fn:Ie.program(235,Hc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postMediaPlaceholder",{hash:{},inverse:Ie.noop,fn:Ie.program(241,Lc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postMediaImage",{hash:{},inverse:Ie.noop,fn:Ie.program(243,Mc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postMediaInlineLink",{hash:{},inverse:Ie.noop,fn:Ie.program(246,Oc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postMediaTwitterContent",{hash:{},inverse:Ie.noop,fn:Ie.program(254,Tc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postVotes",{hash:{},inverse:Ie.noop,fn:Ie.program(256,Uc,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postMenu",{hash:{},inverse:Ie.noop,fn:Ie.program(271,ad,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postFooter",{hash:{},inverse:Ie.noop,fn:Ie.program(289,ld,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postUserAvatar",{hash:{},inverse:Ie.noop,fn:Ie.program(297,qd,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"highlightedSuccessMessage",{hash:{},inverse:Ie.noop,fn:Ie.program(302,td,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postDeleted",{hash:{},inverse:Ie.noop,fn:Ie.program(304,ud,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"postMinimized",{hash:{},inverse:Ie.noop,fn:Ie.program(306,vd,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"realtimeToggleButton",{hash:{},inverse:Ie.noop,fn:Ie.program(314,Ad,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"realtimeCommentNotification",{hash:{},inverse:Ie.noop,fn:Ie.program(316,Bd,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"realtimeReplyNotification",{hash:{},inverse:Ie.noop,fn:Ie.program(321,Ed,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"realtimeIndicator",{hash:{},inverse:Ie.noop,fn:Ie.program(326,Hd,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"realtimeIndicatorText",{hash:{},inverse:Ie.noop,fn:Ie.program(328,Id,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"suggestions",{hash:{},inverse:Ie.noop,fn:Ie.program(339,Pd,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"suggestedUser",{hash:{},inverse:Ie.noop,fn:Ie.program(341,Qd,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n\n\n",Fe=c.partial.call(b,"topThreadPost",{hash:{},inverse:Ie.noop,fn:Ie.program(343,Rd,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n\n\n",Fe=c.partial.call(b,"topUser",{hash:{},inverse:Ie.noop,fn:Ie.program(352,Wd,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n\n\n",Fe=c.partial.call(b,"topThread",{hash:{},inverse:Ie.noop,fn:Ie.program(361,_d,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"upvoters",{hash:{},inverse:Ie.noop,fn:Ie.program(365,ce,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"upvoter",{hash:{},inverse:Ie.noop,fn:Ie.program(376,je,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"guestUpvoter",{hash:{},inverse:Ie.noop,fn:Ie.program(378,ke,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"guestUpvoterText",{hash:{},inverse:Ie.noop,fn:Ie.program(381,me,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n\n",Fe=c.partial.call(b,"userMenu",{hash:{},inverse:Ie.noop,fn:Ie.program(386,pe,e),data:e}),(Fe||0===Fe)&&(Ge+=Fe),Ge+="\n"
});